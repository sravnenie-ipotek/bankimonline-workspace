var U=Object.defineProperty;var G=(e,o,n)=>o in e?U(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var F=(e,o,n)=>(G(e,typeof o!="symbol"?o+"":o,n),n);import{r as a}from"./react-vendor-19e41fc0.js";import{u as O}from"./i18n-vendor-5cfd36a0.js";class J{constructor(){F(this,"cache",new Map);F(this,"TTL",5*60*1e3)}set(o,n){const g=Date.now();this.cache.set(o,{data:n,timestamp:g,expires:g+this.TTL})}get(o){const n=this.cache.get(o);return n?Date.now()>n.expires?(this.cache.delete(o),null):n.data:null}clear(){this.cache.clear()}size(){return this.cache.size}}const x=new J,W=(e,o,n="options")=>{const{i18n:g}=O(),[j,k]=a.useState(!0),[c,b]=a.useState(null),[u,$]=a.useState({options:[],placeholder:void 0,label:void 0,loading:!0,error:null}),d=a.useRef(null),A=g.language||"en",f=a.useCallback(async()=>{var h,s,t,p,C,P,T,m,K,S;try{k(!0),b(null),d.current&&d.current.abort(),d.current=new AbortController;const i=`dropdown_${e}_${A}`,w=x.get(i);let r;if(w)console.log(`✅ Cache hit for ${i}`),r=w;else{console.log(`🌐 Fetching dropdown data from API: /api/dropdowns/${e}/${A}`);const y=await fetch(`/api/dropdowns/${e}/${A}`,{signal:d.current.signal});if(!y.ok)throw new Error(`HTTP ${y.status}: ${y.statusText}`);if(r=await y.json(),r.status!=="success")throw new Error(`API Error: ${r.status}`);x.set(i,r),console.log(`💾 Cached dropdown data for ${i}`)}const D=`${e}_${o}`,R=`${D}_ph`,Y=`${D}_label`,H={when_needed:["when"],when:["when_needed"],first_home:["first"],first:["first_home"]};let I=((h=r.options)==null?void 0:h[D])||[],_=((s=r.placeholders)==null?void 0:s[R])||((t=r.placeholders)==null?void 0:t[D]),E=((p=r.labels)==null?void 0:p[Y])||((C=r.labels)==null?void 0:C[D]);if(I.length===0||!_&&!E){const y=H[o]||[];for(const M of y){const v=`${e}_${M}`,q=`${v}_ph`,z=`${v}_label`;if(I.length===0&&(I=((P=r.options)==null?void 0:P[v])||[]),_||(_=((T=r.placeholders)==null?void 0:T[q])||((m=r.placeholders)==null?void 0:m[v])||_),E||(E=((K=r.labels)==null?void 0:K[z])||((S=r.labels)==null?void 0:S[v])||E),I.length>0&&(_||E))break}}const B={options:I,placeholder:_,label:E,loading:!1,error:null};console.log(`🔍 Dropdown data for ${D}:`,{optionsCount:B.options.length,hasPlaceholder:!!B.placeholder,hasLabel:!!B.label,cacheHit:!!w}),$(B)}catch(i){if(i.name==="AbortError"){console.log("Request aborted");return}console.warn(`❌ Dropdown API error for ${e}/${o}:`,i);const w=i instanceof Error?i:new Error("Unknown error");b(w),$({options:[],placeholder:void 0,label:void 0,loading:!1,error:w})}finally{k(!1),d.current=null}},[e,o,A]);a.useEffect(()=>(f(),()=>{d.current&&d.current.abort()}),[f]);const l={...u,loading:j,error:c};return n==="options"&&!j&&!c?l.options:l},X=e=>{const{i18n:o}=O(),[n,g]=a.useState(!0),[j,k]=a.useState(null),[c,b]=a.useState(null),u=a.useRef(null),$=o.language||"en",d=a.useCallback(async()=>{var f;try{g(!0),k(null),u.current&&u.current.abort(),u.current=new AbortController;const l=`dropdown_${e}_${$}`,h=x.get(l);if(h){console.log(`✅ Bulk cache hit for ${l}`),b(h);return}console.log(`🌐 Bulk fetching dropdowns from API: /api/dropdowns/${e}/${$}`);const s=await fetch(`/api/dropdowns/${e}/${$}`,{signal:u.current.signal});if(!s.ok)throw new Error(`HTTP ${s.status}: ${s.statusText}`);const t=await s.json();if(t.status!=="success")throw new Error(`API Error: ${t.status}`);x.set(l,t),b(t),console.log(`✅ Bulk dropdown data loaded for ${e}:`,{dropdowns:((f=t.dropdowns)==null?void 0:f.length)||0,optionGroups:Object.keys(t.options||{}).length,cacheInfo:t.cache_info})}catch(l){if(l.name==="AbortError"){console.log("Bulk request aborted");return}console.warn(`❌ Bulk dropdown API error for ${e}:`,l);const h=l instanceof Error?l:new Error("Unknown error");k(h),b(null)}finally{g(!1),u.current=null}},[e,$]);return a.useEffect(()=>(d(),()=>{u.current&&u.current.abort()}),[d]),{data:c,loading:n,error:j,getDropdownProps:f=>{var C,P,T,m,K,S;if(!c)return{options:[],placeholder:void 0,label:void 0};const l=`${e}_${f}`,h={when_needed:["when"],when:["when_needed"],first_home:["first"],first:["first_home"]};let s=((C=c.options)==null?void 0:C[l])||[],t=(P=c.placeholders)==null?void 0:P[l],p=(T=c.labels)==null?void 0:T[l];if(s.length===0||!t&&!p){const i=h[f]||[];for(const w of i){const r=`${e}_${w}`;if(s.length===0&&(s=((m=c.options)==null?void 0:m[r])||[]),t||(t=((K=c.placeholders)==null?void 0:K[r])||t),p||(p=((S=c.labels)==null?void 0:S[r])||p),s.length>0&&(t||p))break}}return{options:s,placeholder:t,label:p}},refresh:d,clearCache:()=>x.clear()}};export{W as a,X as u};
