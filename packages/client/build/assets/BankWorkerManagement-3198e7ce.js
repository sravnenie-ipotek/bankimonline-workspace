import{j as a}from"./ui-vendor-5a9cd79c.js";import{r as u}from"./react-vendor-19e41fc0.js";import{a as Q,c as C,f as H,F as W,b as $}from"./form-vendor-3025b96d.js";import{c as P}from"./index-b94574b0.js";import{Q as y}from"./components-vendor-e60b5450.js";import{L,b as z,T as I,E,B as j,M as A}from"./index-79a992ab.js";import{F}from"./FormattedInput-eaa8803d.js";import{D as M}from"./DropdownMenu-7fc78a92.js";import{b as k}from"./bankWorkerApi-9bbb88ad.js";import{u as D}from"./i18n-vendor-5cfd36a0.js";import"./state-vendor-2a767ce0.js";import"./utils-vendor-48989965.js";import"./Control-ef834aa1.js";const O="_managementContainer_63ybq_7",G="_header_63ybq_18",J="_tabs_63ybq_27",K="_tab_63ybq_27",U="_tabBadge_63ybq_53",X="_tabContent_63ybq_76",Y="_invitationForm_63ybq_80",Z="_form_63ybq_87",V="_formField_63ybq_92",aa="_fieldLabel_63ybq_97",ea="_messageTextarea_63ybq_102",sa="_submitButton_63ybq_116",ta="_listHeader_63ybq_130",na="_refreshButton_63ybq_136",ia="_emptyState_63ybq_151",oa="_invitationsTable_63ybq_161",ra="_tableHeader_63ybq_167",la="_tableRow_63ybq_182",ca="_email_63ybq_196",da="_bank_63ybq_200",ma="_branch_63ybq_203",ua="_status_63ybq_207",ba="_date_63ybq_211",pa="_statusBadge_63ybq_240",ha="_queueTable_63ybq_270",_a="_workerCard_63ybq_275",va="_workerInfo_63ybq_289",xa="_workerName_63ybq_292",ja="_workerDetails_63ybq_298",ga="_workerEmail_63ybq_303",ya="_registrationDate_63ybq_308",fa="_workerActions_63ybq_313",Na="_approveButton_63ybq_317",qa="_rejectButton_63ybq_318",ka="_approvalModal_63ybq_338",wa="_modalContent_63ybq_338",Ba="_rejectionModal_63ybq_339",Ca="_modalMessage_63ybq_342",Ia="_modalField_63ybq_349",Da="_modalTextarea_63ybq_360",Ta="_modalActions_63ybq_376",Sa={managementContainer:O,header:G,tabs:J,tab:K,"tab--active":"_tab--active_63ybq_48",tabBadge:U,tabContent:X,invitationForm:Y,form:Z,formField:V,fieldLabel:aa,messageTextarea:ea,submitButton:sa,listHeader:ta,refreshButton:na,emptyState:ia,invitationsTable:oa,tableHeader:ra,tableRow:la,email:ca,bank:da,branch:ma,status:ua,date:ba,statusBadge:pa,"statusBadge--success":"_statusBadge--success_63ybq_249","statusBadge--warning":"_statusBadge--warning_63ybq_254","statusBadge--error":"_statusBadge--error_63ybq_259","statusBadge--neutral":"_statusBadge--neutral_63ybq_264",queueTable:ha,workerCard:_a,workerInfo:va,workerName:xa,workerDetails:ja,workerEmail:ga,registrationDate:ya,workerActions:fa,approveButton:Na,rejectButton:qa,approvalModal:ka,modalContent:wa,rejectionModal:Ba,modalMessage:Ca,modalField:Ia,modalTextarea:Da,modalActions:Ta},e=P.bind(Sa),La=({banks:c,onSubmit:d,loading:_})=>{const{t:s,i18n:v}=D(),t=Q({email:C().email(s("validation.email.format")).required(s("validation.email.required")),bankId:C().required(s("validation.bankId.required")),branchId:C().required(s("validation.branchId.required")),message:C().max(500,s("validation.message.max")),expirationDays:H().min(1,s("validation.expirationDays.min")).max(30,s("validation.expirationDays.max")).required(s("validation.expirationDays.required"))});return a.jsxs("div",{className:e("invitationForm"),children:[a.jsx(I,{title:s("admin.invitation.title")}),a.jsx(W,{initialValues:{email:"",bankId:"",branchId:"",message:"",expirationDays:7},validationSchema:t,onSubmit:d,children:({values:l,errors:r,touched:b,setFieldValue:p,isSubmitting:m})=>{const h=c.find(n=>n.id===l.bankId);return a.jsxs($,{className:e("form"),children:[a.jsx("div",{className:e("formField"),children:a.jsx(F,{name:"email",title:s("admin.invitation.fields.email.label"),placeholder:s("admin.invitation.fields.email.placeholder"),value:l.email,handleChange:n=>p("email",n),error:b.email&&r.email})}),a.jsx("div",{className:e("formField"),children:a.jsx(M,{name:"bankId",title:s("admin.invitation.fields.bank.label"),placeholder:s("admin.invitation.fields.bank.placeholder"),options:c.map(n=>({value:n.id,label:n.name})),value:l.bankId,onChange:n=>{p("bankId",n),p("branchId","")},error:b.bankId&&r.bankId})}),h&&a.jsx("div",{className:e("formField"),children:a.jsx(M,{name:"branchId",title:s("admin.invitation.fields.branch.label"),placeholder:s("admin.invitation.fields.branch.placeholder"),options:h.branches.map(n=>({value:n.id,label:v.language==="he"?n.name_he:v.language==="ru"?n.name_ru:n.name_en,subtitle:`${n.branch_code} - ${n.city}`})),value:l.branchId,onChange:n=>p("branchId",n),error:b.branchId&&r.branchId})}),a.jsx("div",{className:e("formField"),children:a.jsx(F,{name:"expirationDays",title:s("admin.invitation.fields.expirationDays.label"),placeholder:s("admin.invitation.fields.expirationDays.placeholder"),value:l.expirationDays,handleChange:n=>p("expirationDays",n),error:b.expirationDays&&r.expirationDays})}),a.jsxs("div",{className:e("formField"),children:[a.jsx("label",{className:e("fieldLabel"),children:s("admin.invitation.fields.message.label")}),a.jsx("textarea",{name:"message",placeholder:s("admin.invitation.fields.message.placeholder"),value:l.message,onChange:n=>p("message",n.target.value),className:e("messageTextarea"),rows:4}),b.message&&r.message&&a.jsx(E,{message:r.message})]}),a.jsx(j,{type:"submit",variant:"primary",size:"full",disabled:_||m,className:e("submitButton"),children:s(_?"common.sending":"admin.invitation.send")})]})}})]})},Aa=({invitations:c,loading:d,onRefresh:_})=>{const{t:s,i18n:v}=D(),t=l=>{const r={pending:{color:"warning",text:s("admin.status.pending")},used:{color:"success",text:s("admin.status.used")},expired:{color:"error",text:s("admin.status.expired")}}[l.toLowerCase()]||{color:"neutral",text:l};return a.jsx("span",{className:e("statusBadge",`statusBadge--${r.color}`),children:r.text})};return a.jsxs("div",{className:e("invitationsList"),children:[a.jsxs("div",{className:e("listHeader"),children:[a.jsx(I,{title:s("admin.invitations.title")}),a.jsx(j,{variant:"secondary",onClick:_,disabled:d,className:e("refreshButton"),children:s(d?"common.refreshing":"common.refresh")})]}),d?a.jsx(L,{}):c.length===0?a.jsx("div",{className:e("emptyState"),children:a.jsx("p",{children:s("admin.invitations.empty")})}):a.jsxs("div",{className:e("invitationsTable"),children:[a.jsxs("div",{className:e("tableHeader"),children:[a.jsx("span",{children:s("admin.invitations.columns.email")}),a.jsx("span",{children:s("admin.invitations.columns.bank")}),a.jsx("span",{children:s("admin.invitations.columns.status")}),a.jsx("span",{children:s("admin.invitations.columns.created")}),a.jsx("span",{children:s("admin.invitations.columns.expires")})]}),c.map(l=>a.jsxs("div",{className:e("tableRow"),children:[a.jsx("span",{className:e("email"),children:l.email}),a.jsxs("span",{className:e("bank"),children:[l.bankName,l.branchName&&a.jsxs("span",{className:e("branch"),children:[" - ",l.branchName]})]}),a.jsx("span",{className:e("status"),children:t(l.status)}),a.jsx("span",{className:e("date"),children:new Date(l.createdAt).toLocaleDateString(v.language)}),a.jsx("span",{className:e("date"),children:new Date(l.expiresAt).toLocaleDateString(v.language)})]},l.id))]})]})},Fa=({queue:c,loading:d,onApprove:_,onReject:s,onRefresh:v})=>{const{t,i18n:l}=D(),[r,b]=u.useState(null),[p,m]=u.useState(null),[h,n]=u.useState(""),[f,w]=u.useState(""),[g,N]=u.useState(!1),B=async o=>{b(o),m("approve"),n("")},q=async o=>{b(o),m("reject"),n(""),w("")},T=async()=>{if(r)try{N(!0),await _(r.id,h),m(null),b(null),y.success(t("admin.approval.success"))}catch(o){y.error(o.message||t("admin.approval.error"))}finally{N(!1)}},S=async()=>{if(!(!r||!f.trim()))try{N(!0),await s(r.id,f,h),m(null),b(null),y.success(t("admin.rejection.success"))}catch(o){y.error(o.message||t("admin.rejection.error"))}finally{N(!1)}};return a.jsxs("div",{className:e("approvalQueue"),children:[a.jsxs("div",{className:e("listHeader"),children:[a.jsx(I,{title:t("admin.approvalQueue.title")}),a.jsx(j,{variant:"secondary",onClick:v,disabled:d,className:e("refreshButton"),children:t(d?"common.refreshing":"common.refresh")})]}),d?a.jsx(L,{}):c.length===0?a.jsx("div",{className:e("emptyState"),children:a.jsx("p",{children:t("admin.approvalQueue.empty")})}):a.jsx("div",{className:e("queueTable"),children:c.map(o=>a.jsxs("div",{className:e("workerCard"),children:[a.jsxs("div",{className:e("workerInfo"),children:[a.jsx("h3",{className:e("workerName"),children:o.fullName}),a.jsxs("p",{className:e("workerDetails"),children:[o.position," • ",o.bankName," • ",o.branchName]}),a.jsx("p",{className:e("workerEmail"),children:o.email}),a.jsxs("p",{className:e("registrationDate"),children:[t("admin.approvalQueue.registeredOn"),": "," ",new Date(o.registrationDate).toLocaleDateString(l.language)]})]}),a.jsxs("div",{className:e("workerActions"),children:[a.jsx(j,{variant:"primary",onClick:()=>B(o),className:e("approveButton"),children:t("admin.actions.approve")}),a.jsx(j,{variant:"secondary",onClick:()=>q(o),className:e("rejectButton"),children:t("admin.actions.reject")})]})]},o.id))}),a.jsx(A,{isVisible:p==="approve",title:t("admin.approval.title"),onCancel:()=>m(null),className:e("approvalModal"),children:a.jsxs("div",{className:e("modalContent"),children:[a.jsx("p",{className:e("modalMessage"),children:t("admin.approval.message",{name:r==null?void 0:r.fullName})}),a.jsxs("div",{className:e("modalField"),children:[a.jsxs("label",{className:e("fieldLabel"),children:[t("admin.approval.comments")," (",t("common.optional"),")"]}),a.jsx("textarea",{value:h,onChange:o=>n(o.target.value),placeholder:t("admin.approval.commentsPlaceholder"),className:e("modalTextarea"),rows:3})]}),a.jsxs("div",{className:e("modalActions"),children:[a.jsx(j,{variant:"secondary",onClick:()=>m(null),disabled:g,children:t("common.cancel")}),a.jsx(j,{variant:"primary",onClick:T,disabled:g,children:t(g?"common.submitting":"admin.actions.approve")})]})]})}),a.jsx(A,{isVisible:p==="reject",title:t("admin.rejection.title"),onCancel:()=>m(null),className:e("rejectionModal"),children:a.jsxs("div",{className:e("modalContent"),children:[a.jsx("p",{className:e("modalMessage"),children:t("admin.rejection.message",{name:r==null?void 0:r.fullName})}),a.jsxs("div",{className:e("modalField"),children:[a.jsxs("label",{className:e("fieldLabel"),children:[t("admin.rejection.reason")," *"]}),a.jsx("textarea",{value:f,onChange:o=>w(o.target.value),placeholder:t("admin.rejection.reasonPlaceholder"),className:e("modalTextarea"),rows:2,required:!0})]}),a.jsxs("div",{className:e("modalField"),children:[a.jsxs("label",{className:e("fieldLabel"),children:[t("admin.rejection.comments")," (",t("common.optional"),")"]}),a.jsx("textarea",{value:h,onChange:o=>n(o.target.value),placeholder:t("admin.rejection.commentsPlaceholder"),className:e("modalTextarea"),rows:3})]}),a.jsxs("div",{className:e("modalActions"),children:[a.jsx(j,{variant:"secondary",onClick:()=>m(null),disabled:g,children:t("common.cancel")}),a.jsx(j,{variant:"primary",onClick:S,disabled:g||!f.trim(),children:t(g?"common.submitting":"admin.actions.reject")})]})]})})]})},Ua=()=>{const{t:c}=D(),[d,_]=u.useState("invitations"),[s,v]=u.useState([]),[t,l]=u.useState([]),[r,b]=u.useState([]),[p,m]=u.useState(!0),[h,n]=u.useState(!1),[f,w]=u.useState(!1);u.useEffect(()=>{g()},[]);const g=async()=>{try{m(!0),await Promise.all([N(),B(),q()])}catch(i){console.error("Error loading initial data:",i)}finally{m(!1)}},N=async()=>{try{const i=await k.getBanks();i.status==="success"&&i.data&&v(i.data)}catch(i){console.error("Error loading banks:",i),y.error(i.message||c("errors.failedToLoadBanks"))}},B=async()=>{try{n(!0);const i=await k.getInvitations({limit:50});i.status==="success"&&i.data&&l(i.data.invitations)}catch(i){console.error("Error loading invitations:",i),y.error(i.message||c("errors.failedToLoadInvitations"))}finally{n(!1)}},q=async()=>{try{w(!0);const i=await k.getApprovalQueue({limit:50});i.status==="success"&&i.data&&b(i.data.queue)}catch(i){console.error("Error loading approval queue:",i),y.error(i.message||c("errors.failedToLoadQueue"))}finally{w(!1)}},T=async i=>{try{const x=await k.sendInvitation(i);if(x.status==="success")y.success(c("admin.invitation.success")),await B();else throw new E(x.message)}catch(x){throw console.error("Error sending invitation:",x),x}},S=async(i,x)=>{await k.approveWorker(i,x),await q()},o=async(i,x,R)=>{await k.rejectWorker(i,x,R),await q()};return p?a.jsx(L,{}):a.jsx(z,{children:a.jsxs("div",{className:e("managementContainer"),children:[a.jsx("div",{className:e("header"),children:a.jsx(I,{title:c("admin.bankWorker.title"),tooltip:c("admin.bankWorker.tooltip")})}),a.jsxs("div",{className:e("tabs"),children:[a.jsxs("button",{className:e("tab",{"tab--active":d==="invitations"}),onClick:()=>_("invitations"),children:[c("admin.tabs.invitations"),t.length>0&&a.jsx("span",{className:e("tabBadge"),children:t.length})]}),a.jsxs("button",{className:e("tab",{"tab--active":d==="queue"}),onClick:()=>_("queue"),children:[c("admin.tabs.approvalQueue"),r.length>0&&a.jsx("span",{className:e("tabBadge"),children:r.length})]})]}),a.jsx("div",{className:e("tabContent"),children:d==="invitations"?a.jsxs("div",{className:e("invitationsTab"),children:[a.jsx(La,{banks:s,onSubmit:T,loading:h}),a.jsx(Aa,{invitations:t,loading:h,onRefresh:B})]}):a.jsx("div",{className:e("queueTab"),children:a.jsx(Fa,{queue:r,loading:f,onApprove:S,onReject:o,onRefresh:q})})})]})})};export{Ua as BankWorkerManagement,Ua as default};
