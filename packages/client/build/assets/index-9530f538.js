import{j as e}from"./ui-vendor-5a9cd79c.js";import{r as S,f as W,b as ye,j as xe,k as ve}from"./react-vendor-19e41fc0.js";import{E,a as U,D as Y,b as ie,A as Ie,T as we,L as qe}from"./index-93cfc651.js";import{P as Me}from"./ProgressBar-5cc8c4aa.js";import{c as Ee,u as j,a as R,k as ne,l as A,m as Ce,d as Ne,n as i,p as Be,q as Ae,r as De,t as Le,v as Te,w as ke,x as Ye,y as Re,z as Ve,A as je,B as $e,N as ze}from"./index-3c2b4d19.js";import{u as ee,F as ae,b as se,a as Z,f as C,c as u,g as be}from"./form-vendor-429348f6.js";import{V as We}from"./VideoPoster-88bb3624.js";import{S as ue,a as Ue,M as He,U as Ge,A as Je,F as Ke,B as Qe,b as Xe,c as Ze,O as et}from"./SourceOfIncomeModal-4909b0c9.js";import{M as tt,U as z,A as re}from"./AddButton-30a50de4.js";import{u as D}from"./i18n-vendor-5cfd36a0.js";import{I as rt,c as k}from"./IncreasePayment-584f8c6c.js";import{C as m}from"./Column-6db41f6f.js";import{R as w}from"./Row-af99fd27.js";import{D as Q}from"./DropdownMenu-40d6d6cb.js";import{F as ot}from"./FormattedInput-87577656.js";import{F as le}from"./FormCaption-d4be29ea.js";import{F as ce}from"./FormContainer-d6464a73.js";import{u as nt}from"./useDropdownData-26d062c8.js";import{D as he}from"./DoubleButtons-abdf8ee0.js";import{R as it}from"./RowTwo-9e512b79.js";import{B as at,P as st,A as lt}from"./PartnerPayMortgage-c28bc69a.js";import{N as ct,B as dt,E as mt,A as pt,T as ut,C as ht,M as gt,I as _t,P as ft}from"./Taxes-259175f6.js";import{C as yt,a as xt,H as wt}from"./HowMuchChildrens-4fd7fa09.js";import{F as jt}from"./FamilyStatus-b4e47cf6.js";import{I as bt}from"./Info-4b447f55.js";import{M as Pt,c as Pe,A as Ot,a as Ft,O as St,b as Oe,g as me}from"./componentsByIncomeSource-a30148d2.js";import"./components-vendor-e60b5450.js";import"./utils-vendor-48989965.js";import"./state-vendor-2a767ce0.js";import"./MortgageParameters-e8aa5285.js";import"./PercentIcon-69cb9491.js";import"./Control-a51b9d21.js";import"./Calendar-bbec0934.js";import"./ShieldCheckIcon-a0d68f8f.js";const vt="_image_1435f_1",It={image:vt,"inner-div":"_inner-div_1435f_8","bold-text":"_bold-text_1435f_16"},oe=Ee.bind(It),qt=()=>{const{t,i18n:o}=D(),{values:r}=ee(),s=(r.priceOfEstate-r.initialFee).toLocaleString("en-US"),p=Math.trunc((r.priceOfEstate-r.initialFee)/r.priceOfEstate*100);return e.jsxs(tt,{style:{marginTop:"2px"},children:[e.jsx("span",{className:oe("margin-sides"),children:t("calc_mortrage_subtext_1")}),e.jsxs("b",{className:oe("bold-text"),children:[s," â‚ª"]}),e.jsx("br",{}),e.jsx("span",{className:oe("margin-sides"),children:t("calc_mortrage_subtext_3")}),e.jsxs("b",{className:oe("bold-text"),children:[isNaN(p)||p<0?0:p,"%"]})]})};function Mt(){const[t,o]=S.useState(51130),[r,s]=S.useState(2654),[p,d]=S.useState({min:4,max:30}),{t:l,i18n:L}=D(),{setFieldValue:M,values:h,errors:x}=ee(),P=j(b=>b.activeField),H=R();S.useEffect(()=>{(async()=>{var g,v,f,c,_,O;try{const y=await k.getAllParameters("mortgage"),F=((f=(v=(g=y.standards)==null?void 0:g.loan_terms)==null?void 0:v.min_years)==null?void 0:f.value)||4,n=((O=(_=(c=y.standards)==null?void 0:c.loan_terms)==null?void 0:_.max_years)==null?void 0:O.value)||30;d({min:F,max:n})}catch(y){console.error("âŒ Error fetching loan term limits:",y)}})()},[]);const V=b=>{H(ne("period")),M("period",b)},N=b=>{H(ne("monthlyPayment")),M("monthlyPayment",b)};return S.useEffect(()=>{(async()=>{try{if(P==="period"){const g=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,h.period);Number.isNaN(g)||M("monthlyPayment",g)}else{const g=await k.calculateLoanPeriod(h.priceOfEstate,h.initialFee,h.monthlyPayment);Number.isNaN(g)||M("period",g)}}catch(g){console.error("âŒ Error calculating mortgage values:",g)}})()},[P,M,h.initialFee,h.monthlyPayment,h.period,h.priceOfEstate]),S.useLayoutEffect(()=>{(async()=>{var g,v,f,c,_,O;try{const y=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,p.min),F=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,p.max);Number.isNaN(y)||o(y),y===0&&o(1),Number.isNaN(F)||s(F)}catch(y){console.error("âŒ Error calculating payment limits:",y);try{const F=await k.getAllParameters("mortgage"),n=((f=(v=(g=F.standards)==null?void 0:g.payment_limits)==null?void 0:v.default_max)==null?void 0:f.value)||51130,a=((O=(_=(c=F.standards)==null?void 0:c.payment_limits)==null?void 0:_.default_min)==null?void 0:O.value)||2654;o(n),s(a)}catch(F){console.error("âŒ Even database fallback failed:",F),o(51130),s(2654)}}})()},[h.initialFee,h.priceOfEstate,p]),e.jsxs(w,{children:[e.jsxs(m,{children:[e.jsx(ue,{disableCurrency:!0,unitsMax:l("calculate_mortgage_period_units_max"),unitsMin:l("calculate_mortgage_period_units_min"),value:h.period,name:"Period",min:p.min,max:p.max,error:x.period,title:l("calculate_mortgage_period"),handleChange:V}),x.period&&e.jsx(E,{error:x.period})]}),e.jsxs(m,{children:[e.jsx(ue,{unitsMax:"â‚ª",unitsMin:"â‚ª",name:"MonthlyPayment",min:r,max:t,error:x.monthlyPayment,title:l("calculate_mortgage_initial_payment"),handleChange:N,value:h.monthlyPayment}),e.jsx(rt,{}),x.monthlyPayment&&e.jsx(E,{error:x.monthlyPayment})]}),e.jsx(m,{})]})}const Et=()=>{const{t,i18n:o}=D(),{getContent:r}=U("mortgage_step1"),s=R(),{data:p,loading:d,error:l,getDropdownProps:L}=nt("mortgage_step1"),[M,h]=S.useState([]),[x,P]=S.useState({}),[H,V]=S.useState(!0);S.useEffect(()=>{const a=async()=>{try{const $=await(await fetch(`/api/get-cities?lang=${o.language}`)).json();if($.status==="success"){const te=$.data.map(G=>({value:G.value,label:G.name}));h(te)}else console.error("Failed to fetch cities:",$.message)}catch(q){console.error("Error fetching cities:",q)}},I=async()=>{var q,$,te,G,ge,_e,fe;try{V(!0);const de=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/api":"https://bankimonline.com/api",B=await(await fetch(`${de}/v1/calculation-parameters?business_path=mortgage`)).json();if(B.status==="success"&&B.data.property_ownership_ltvs){const T={};Object.keys(B.data.property_ownership_ltvs).forEach(K=>{T[K]=B.data.property_ownership_ltvs[K].ltv/100}),P(T),console.info("âœ… LTV ratios loaded from database:",T)}else if(B.status==="error"&&((q=B.data)!=null&&q.property_ownership_ltvs)){const T={};Object.keys(B.data.property_ownership_ltvs).forEach(K=>{T[K]=B.data.property_ownership_ltvs[K].ltv/100}),P(T),console.info("ðŸ“‹ Using fallback LTV ratios (database connection issue):",T)}else throw new E("No LTV data in response")}catch(de){console.warn("âš ï¸ Error fetching LTV ratios from calculation parameters API:",de.message),console.info("ðŸ“‹ Using calculationService fallback values");try{const J=await k.getAllParameters("mortgage");P({no_property:((te=($=J.property_ownership_ltvs)==null?void 0:$.no_property)==null?void 0:te.ltv)/100||.75,has_property:((ge=(G=J.property_ownership_ltvs)==null?void 0:G.has_property)==null?void 0:ge.ltv)/100||.5,selling_property:((fe=(_e=J.property_ownership_ltvs)==null?void 0:_e.selling_property)==null?void 0:fe.ltv)/100||.7})}catch{console.warn("ðŸš¨ CRITICAL: Even calculationService failed, using hardcoded emergency values"),P({no_property:.75,has_property:.5,selling_property:.7})}}finally{V(!1)}};a(),I()},[o.language]);const N=L("when"),b=L("type"),g=L("first"),v=L("property_ownership");d&&console.log("ðŸ”„ Loading dropdown data for mortgage_step1..."),p&&!d&&console.log("âœ… Dropdown data loaded for mortgage_step1:",{whenNeeded:N.options.length,type:b.options.length,firstHome:g.options.length,propertyOwnership:v.options.length});const{setFieldValue:f,values:c,errors:_,touched:O,setFieldTouched:y}=ee(),F=(a,I)=>{if(!a||a===0)return 1;const q=x[I]||x.no_property||.75;return a*q},n=(a,I)=>{if(!a||a===0)return 0;const q=F(a,I);return a-q};return S.useEffect(()=>{if(c.propertyOwnership&&c.priceOfEstate){const a=n(c.priceOfEstate,c.propertyOwnership),I=c.priceOfEstate;c.initialFee<a?(console.log(`[PROPERTY-OWNERSHIP] Adjusting initial payment from ${c.initialFee} to ${a} (min for ${c.propertyOwnership})`),f("initialFee",a)):c.initialFee>I&&(console.log(`[PROPERTY-OWNERSHIP] Adjusting initial payment from ${c.initialFee} to ${I} (max)`),f("initialFee",I))}},[c.propertyOwnership,c.priceOfEstate,c.initialFee,f]),e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(le,{title:r("mortgage_step1.header.title","calculate_mortgage_title")}),e.jsxs(w,{children:[e.jsxs(m,{children:[e.jsx(ot,{handleChange:a=>{s(ne("period")),f("priceOfEstate",a)},name:"PriceOfEstate",title:r("mortgage_step1.field.property_price","calculate_mortgage_price"),value:c.priceOfEstate,placeholder:"1,000,000",error:_.priceOfEstate,"data-testid":"property-price-input"}),_.priceOfEstate&&e.jsx(E,{error:_.priceOfEstate})]}),e.jsx(m,{children:e.jsx(Q,{title:r("mortgage_step1.field.city","calculate_mortgage_city"),data:M,placeholder:r("mortgage_step1.field.city_ph","Select city"),value:c.cityWhereYouBuy,onChange:a=>f("cityWhereYouBuy",a),onBlur:()=>y("cityWhereYouBuy",!0),searchable:!0,searchPlaceholder:r("mortgage_step1.field.search_ph","Search..."),nothingFoundText:r("mortgage_step1.field.nothing_found","Nothing found"),error:O.cityWhereYouBuy&&_.cityWhereYouBuy,dataTestId:"city-dropdown"})}),e.jsxs(m,{children:[e.jsx(Q,{title:N.label||r("mortgage_step1.field.when_needed","calculate_mortgage_when"),data:N.options,placeholder:N.placeholder||r("mortgage_step1.field.when_needed_ph","calculate_mortgage_when_options_ph"),value:c.whenDoYouNeedMoney,onChange:a=>f("whenDoYouNeedMoney",a),onBlur:()=>y("whenDoYouNeedMoney",!0),error:O.whenDoYouNeedMoney&&_.whenDoYouNeedMoney,dataTestId:"when-needed-dropdown",disabled:d}),l&&e.jsx(E,{error:r("error_dropdown_load_failed","Failed to load options. Please refresh the page.")})]})]}),e.jsxs(w,{children:[e.jsxs(m,{children:[e.jsx(ue,{name:"InitialFee",value:c.initialFee,min:n(c.priceOfEstate,c.propertyOwnership),max:c.priceOfEstate||1,title:r("mortgage_step1.field.initial_fee","calculate_mortgage_initial_fee"),handleChange:a=>{s(ne("period")),f("initialFee",a)},tooltip:r("mortgage_step1.field.initial_payment_tooltip","Minimum down payment depends on property ownership status"),error:_.initialFee,disableRangeValues:!0,"data-testid":"initial-fee-input"}),e.jsx(qt,{}),_.initialFee&&e.jsx(E,{error:_.initialFee})]}),e.jsxs(m,{children:[e.jsx(Q,{title:b.label||r("mortgage_step1.field.type","calculate_mortgage_type"),data:b.options,placeholder:b.placeholder||r("mortgage_step1.field.type_ph","calculate_mortgage_type_ph"),value:c.typeSelect,onChange:a=>f("typeSelect",a),onBlur:()=>y("typeSelect",!0),error:O.typeSelect&&_.typeSelect,dataTestId:"property-type-dropdown",disabled:d}),l&&e.jsx(E,{error:r("error_dropdown_load_failed","Failed to load type options. Please refresh the page.")})]}),e.jsxs(m,{children:[e.jsx(Q,{title:g.label||r("mortgage_step1.field.first_home","calculate_mortgage_first"),data:g.options,placeholder:g.placeholder||r("mortgage_step1.field.first_home_ph","calculate_mortgage_first_ph"),value:c.willBeYourFirst,onChange:a=>f("willBeYourFirst",a),onBlur:()=>y("willBeYourFirst",!0),error:O.willBeYourFirst&&_.willBeYourFirst,dataTestId:"first-home-dropdown",disabled:d}),l&&e.jsx(E,{error:r("error_dropdown_load_failed","Failed to load first home options. Please refresh the page.")})]})]}),e.jsxs(w,{children:[e.jsxs(m,{children:[e.jsx(Q,{title:v.label||r("mortgage_step1.field.property_ownership","calculate_mortgage_property_ownership"),data:v.options,placeholder:v.placeholder||r("mortgage_step1.field.property_ownership_ph","calculate_mortgage_property_ownership_ph"),value:c.propertyOwnership,onChange:a=>f("propertyOwnership",a),onBlur:()=>y("propertyOwnership",!0),error:O.propertyOwnership&&_.propertyOwnership,dataTestId:"property-ownership-dropdown",disabled:d}),l&&e.jsx(E,{error:r("error_dropdown_load_failed","Failed to load property ownership options. Please refresh the page.")})]}),e.jsx(m,{}),e.jsx(m,{})]}),e.jsx(Y,{}),e.jsx(Mt,{})]})})},Ct=()=>Z().shape({priceOfEstate:C().max(1e7,i("error_max_price",'×¢×¨×š ×”× ×›×¡ ×”×ž×§×¡×™×ž×œ×™ ×”×•× 10,000,000 ×©"×—')).required(i("error_property_value_required","×¢×¨×š ×”× ×›×¡ × ×“×¨×©")),cityWhereYouBuy:u().required(i("error_city_required","×¢×™×¨ × ×“×¨×©×ª")),whenDoYouNeedMoney:u().required(i("error_when_need_mortgage","×™×© ×œ×‘×—×•×¨ ×ž×ª×™ ×ª×–×“×§×§ ×œ×ž×©×›× ×ª×")),initialFee:C().test("initial-payment-percentage",i("error_initial_fee","×ª×©×œ×•× ×¨××©×•× ×™ ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 75% ×ž×¢×¨×š ×”× ×›×¡"),function(t){const o=this.parent.priceOfEstate||0;return Nt(o,t)}).required(i("error_initial_payment_required","×ª×©×œ×•× ×¨××©×•× ×™ × ×“×¨×©")),typeSelect:u().required(i("error_mortgage_type_required","×¡×•×’ ×ž×©×›× ×ª×” × ×“×¨×©")),willBeYourFirst:u().required(i("error_first_home_required","×× × ×¦×™×™×Ÿ ×× ×–×” ×”×‘×™×ª ×”×¨××©×•×Ÿ ×©×œ×š")),propertyOwnership:u().required(i("error_property_ownership_required","×¡×˜×˜×•×¡ ×‘×¢×œ×•×ª ×¢×œ × ×›×¡ × ×“×¨×©")),period:C().min(4,i("error_min_period","×ª×§×•×¤×” ×ž×™× ×™×ž×œ×™×ª ×”×™× 4 ×©× ×™×")).max(30,i("error_max_period","×ª×§×•×¤×” ×ž×§×¡×™×ž×œ×™×ª ×”×™× 30 ×©× ×”")).required(i("error_period_required","×ª×§×•×¤×ª ×”×ž×©×›× ×ª×” × ×“×¨×©×ª")),monthlyPayment:C().min(2654,i("error_min_monthly_payment",'×ª×©×œ×•× ×—×•×“×©×™ ×ž×™× ×™×ž×œ×™ ×”×•× 2,664 ×©"×—')).required(i("error_monthly_payment_required","×ª×©×œ×•× ×—×•×“×©×™ × ×“×¨×©"))});function Nt(t,o){const r=t*.25;return typeof o>"u"?!1:o>=r}const Bt=()=>{D();const{getContent:t}=U("mortgage_step1"),o=R(),r=W(),s=j(l=>l.mortgage),p=j(l=>l.login.isLogin),d={priceOfEstate:s.priceOfEstate||1e6,cityWhereYouBuy:s.cityWhereYouBuy||"",whenDoYouNeedMoney:s.whenDoYouNeedMoney||"",initialFee:s.initialFee||5e5,typeSelect:s.typeSelect||"",willBeYourFirst:s.willBeYourFirst||"",propertyOwnership:s.propertyOwnership||"",period:s.period||4,monthlyPayment:s.monthlyPayment||11514};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{initialValues:d,validationSchema:Ct(),validateOnMount:!0,onSubmit:l=>{o(A(l)),p?r("/services/calculate-mortgage/2"):(o(Ce()),o(Ne("phoneVerification")))},children:e.jsxs(se,{children:[e.jsxs(ie,{children:[e.jsx(We,{title:t("video_calculate_mortgage_title","video_calculate_mortgage_title"),text:t("show_offers","show_offers"),size:"small"}),e.jsx(Et,{})]}),e.jsx(Ue,{})]})}),e.jsx(He,{}),e.jsx(Ie,{})]})},At=()=>{D();const{getContent:t}=U("mortgage_step4"),o=j(s=>s.login.loginData),r=j(s=>s.mortgage);return e.jsxs(ce,{children:[e.jsx(le,{title:t("calculate_mortgage_final","calculate_mortgage_final")}),e.jsx(Ge,{cost:r.priceOfEstate,initialPayment:r.initialFee,period:r.period,nameSurname:o==null?void 0:o.nameSurname,phoneNumber:o==null?void 0:o.phoneNumber}),e.jsx(Je,{text:t("calculate_mortgage_warning","calculate_mortgage_warning")}),e.jsx(w,{children:e.jsx(Ke,{})}),e.jsx(Qe,{})]})},Dt={selectedBank:"",selectedOffer:null},Lt=Z().shape({selectedBank:u(),selectedOffer:Z().nullable()}),Tt=()=>{const t=R(),o=W();return j(r=>r.login.loginData),j(r=>r.login.isLogin),e.jsx(ae,{initialValues:Dt,validationSchema:Lt,validateOnMount:!0,onSubmit:r=>{console.log("Saving mortgage data and proceeding...",r),t(A(r)),console.log("Proceeding to application submission (auth bypassed for testing)"),o("/services/application-submitted")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx(At,{})}),e.jsx(he,{})]})})},kt=()=>{D();const{getContent:t}=U("mortgage_step2"),{values:o}=ee(),r=j(s=>s.login.loginData);return e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(le,{title:t("mortgage_step2_title","Personal Details")}),e.jsxs(it,{children:[e.jsx(bt,{}),e.jsx(z,{name:r==null?void 0:r.nameSurname,phone:r==null?void 0:r.phoneNumber})]}),e.jsxs(w,{children:[e.jsx(ct,{}),e.jsx(dt,{}),e.jsx(mt,{})]}),e.jsxs(w,{children:[e.jsxs(m,{style:{gap:"2rem"},children:[e.jsx(pt,{}),o.additionalCitizenships==="yes"&&e.jsx(yt,{})]}),e.jsxs(m,{style:{gap:"2rem"},children:[e.jsx(ut,{}),o.taxes==="yes"&&e.jsx(xt,{})]}),e.jsxs(m,{style:{gap:"2rem"},children:[e.jsx(ht,{}),o.childrens==="yes"&&e.jsx(wt,{})]})]}),e.jsx(Y,{}),e.jsxs(w,{children:[e.jsx(gt,{}),e.jsx(_t,{}),e.jsx(ft,{})]}),e.jsx(Y,{}),e.jsxs(w,{children:[e.jsx(at,{}),e.jsx(m,{}),e.jsx(m,{})]}),e.jsx(Y,{}),e.jsxs(w,{children:[e.jsx(jt,{}),e.jsx(m,{children:o.familyStatus==="option_2"&&e.jsx(st,{})}),e.jsx(m,{children:o.partnerPayMortgage==="yes"&&o.familyStatus==="option_2"&&e.jsx(lt,{})})]})]})})},Se=()=>Z().shape({nameSurname:u().required(i("error_name_surname","Please enter your name and surname")),birthday:u().required(i("error_date","Please enter a valid date")),education:u().required(i("error_education_required","Education is required")),additionalCitizenships:u().required(i("error_citizenship_required","Citizenship information is required")),citizenshipsDropdown:be().when("additionalCitizenships",{is:"yes",then:t=>t.min(1,i("error_citizenship_countries_required","Please select at least one citizenship country")),otherwise:t=>t.min(0)}),taxes:u().required(i("error_taxes_required","Tax payment information is required")),countriesPayTaxes:be().when("taxes",{is:"yes",then:t=>t.min(1,i("error_tax_countries_required","Please select at least one tax country")),otherwise:t=>t.min(0)}),childrens:u().required(i("error_children_required","Children information is required")),howMuchChildrens:C().required(i("error_children_count_required","Number of children is required")),medicalInsurance:u().required(i("error_medical_insurance_required","Medical insurance information is required")),isForeigner:u().required(i("error_foreigner_required","Foreigner status is required")),publicPerson:u().required(i("error_public_person_required","Public person status is required")),borrowers:C().min(1,i("error_quantity_borrowers","At least one borrower is required")).required(i("error_quantity_borrowers","Number of borrowers is required")),familyStatus:u().required(i("error_family_status_required","Family status is required")),partnerPayMortgage:u().when("familyStatus",{is:"Married",then:t=>t.required(i("error_partner_mortgage_required","Partner mortgage information is required")),otherwise:t=>t.notRequired()})});Se();const Yt=()=>{const t=R(),o=W(),r=j(d=>d.mortgage),p={nameSurname:j(d=>d.login.loginData).nameSurname||r.nameSurname||"",birthday:r.birthday||new Date(new Date().setFullYear(new Date().getFullYear()-18)).getTime(),education:r.education||"",additionalCitizenships:r.additionalCitizenships||null,citizenshipsDropdown:r.citizenshipsDropdown||[],taxes:r.taxes||null,countriesPayTaxes:r.countriesPayTaxes||[],childrens:r.childrens||null,howMuchChildrens:r.howMuchChildrens||1,medicalInsurance:r.medicalInsurance||null,isForeigner:r.isForeigner||null,publicPerson:r.publicPerson||null,borrowers:r.borrowers||null,familyStatus:r.familyStatus||"",partnerPayMortgage:r.partnerPayMortgage||null,addPartner:r.addPartner||""};return e.jsx(ae,{initialValues:p,validationSchema:Se(),validateOnMount:!0,onSubmit:d=>{t(A(d)),o("/services/calculate-mortgage/3")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx(kt,{})}),e.jsx(he,{})]})})},Fe=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="1"||o.includes("no_additional")||o.includes("no additional")||o.includes("none")},Rt=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o.includes("no_obligation")||o.includes("no obligation")||o.includes("none")},Vt=()=>{D();const{getContent:t}=U("mortgage_step3"),o=W(),{values:r}=ee(),{mainSourceOfIncome:s,additionalIncome:p,obligation:d}=r,l=R(),L=j(n=>n.borrowers.sourceOfIncomeModal),M=j(n=>n.borrowers.additionalIncomeModal),h=j(n=>n.borrowers.obligationModal),x=j(n=>n.otherBorrowers.otherBorrowers),P=j(n=>n.login.loginData),H=()=>{l(A(r)),l(Be())},V=()=>{l(A(r)),l(Ae())},N=()=>{l(A(r)),l(De())},b=n=>{l(Le({id:n}))},g=n=>{l(Te({id:n}))},v=n=>{l(ke({id:n}))},f=n=>{l(Ye(n))},c=n=>{l(Re(n))},_=n=>{l(Ve(n))},O=n=>{l(je(n));const I=!x.some(q=>q.id===n)?me(x):n;o({pathname:"/services/other-borrowers/1/",search:xe({pageId:String(I)}).toString()})},y=()=>{l(je(me(x))),l(A(r)),o({pathname:"/services/other-borrowers/1/",search:xe({pageId:me(x).toString()}).toString()})},F=n=>{l($e(n))};return e.jsxs(ce,{children:[e.jsx(le,{title:t("mortgage_step3_title","Income & Employment Information")}),e.jsx(z,{name:P==null?void 0:P.nameSurname,phone:P==null?void 0:P.phoneNumber}),e.jsxs(w,{children:[e.jsx(Pt,{}),Pe[s]&&Pe[s].map((n,a)=>e.jsx(ye.Fragment,{children:n},a))]}),e.jsx(w,{children:e.jsx(m,{children:s&&e.jsxs(e.Fragment,{children:[L.map(n=>e.jsx(z,{onEdit:()=>f(n.id),onDelete:()=>b(n.id),enableEdit:!0,name:`${t("source_of_income","source_of_income")}${n.id+1}`},n.id)),e.jsx(re,{onClick:H,color:"#FBE54D",value:t("add_place_to_work","add_place_to_work"),variant:"none"})]})})}),e.jsx(Y,{}),e.jsxs(w,{children:[e.jsx(Ot,{}),p&&!Fe(p)&&e.jsx(Ft,{}),e.jsx(m,{})]}),p&&!Fe(p)&&e.jsx(w,{children:e.jsxs(m,{children:[M.map(n=>e.jsx(z,{onEdit:()=>c(n.id),onDelete:()=>g(n.id),enableEdit:!0,name:`${t("additional_source_of_income","additional_source_of_income")}${n.id+1}`},n.id)),e.jsx(re,{onClick:V,color:"#FBE54D",value:t("add_additional_source_of_income","add_additional_source_of_income"),variant:"none"})]})}),e.jsx(Y,{}),e.jsxs(w,{children:[e.jsx(St,{}),Oe[d]&&Oe[d].map((n,a)=>e.jsx(ye.Fragment,{children:n},a)),e.jsx(m,{})]}),d&&!Rt(d)&&e.jsx(w,{children:e.jsxs(m,{children:[h.map(n=>e.jsx(z,{onEdit:()=>_(n.id),onDelete:()=>v(n.id),enableEdit:!0,name:`${t("obligation","obligation")}${n.id+1}`},n.id)),e.jsx(re,{onClick:N,color:"#FBE54D",value:t("add_obligation","add_obligation"),variant:"none"})]})}),e.jsx(Y,{}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[x&&e.jsx(we,{title:t("borrower","borrower")}),e.jsxs(w,{style:{columnGap:"2rem"},children:[x.map(n=>e.jsx(m,{children:e.jsx(z,{onEdit:()=>O(n.id),onDelete:()=>F(n.id),enableEdit:!0,name:n.nameSurname},n.id)},n.id)),!x&&e.jsx(we,{title:t("borrower","borrower")}),e.jsx(m,{children:e.jsx(re,{value:t("add_borrower","add_borrower"),onClick:y,style:{height:"3.5rem",borderRadius:"0.25rem",padding:"0",width:"13.125rem"}})}),e.jsx(m,{})]})]})]})},X=t=>{if(!t)return!1;const o=t.toLowerCase();return o.includes("unemployed")||o.includes("no_income")||o.includes("no income")||o.includes("option_5")||o.includes("option_6")||o==="app.mortgage.step3.main_source_income_option_5"||o==="app.mortgage.step3.main_source_income_option_6"||o==="other"||o==="unpaid_leave"},$t=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="1"||o.includes("no_additional")||o.includes("no additional")||o.includes("none")},pe=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="no_obligations"||o.includes("no_obligation")||o.includes("no obligation")||o.includes("none")},zt=Z().shape({mainSourceOfIncome:u().required(i("error_select_answer","Please select an answer")).test("not-empty",i("error_select_answer","Please select an answer"),t=>t!=null&&t!==""),monthlyIncome:C().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),startDate:u().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_date","Please enter a valid date")),otherwise:t=>t.notRequired()}),fieldOfActivity:u().when("mainSourceOfIncome",{is:t=>t!=null&&t!==""&&!X(t),then:t=>t.required(i("error_select_field_of_activity","Please select field of activity")),otherwise:t=>t.notRequired()}),profession:u().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),companyName:u().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),additionalIncome:u().required(i("error_select_one_of_the_options","Please select one of the options")).test("not-empty",i("error_select_one_of_the_options","Please select one of the options"),t=>t!=null&&t!==""),additionalIncomeAmount:C().when("additionalIncome",{is:t=>t!=null&&t!==""&&!$t(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),obligation:u().required(i("error_select_one_of_the_options","Please select one of the options")),bank:u().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_select_bank","Please select a bank")),otherwise:t=>t.notRequired()}),monthlyPaymentForAnotherBank:C().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),endDate:u().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_date","Please enter a valid date")),otherwise:t=>t.notRequired()})}),Wt=()=>{const t=R(),o=W(),r=j(p=>p.mortgage),s={mainSourceOfIncome:r.mainSourceOfIncome||"",monthlyIncome:r.monthlyIncome||null,startDate:r.startDate||new Date().getTime(),fieldOfActivity:r.fieldOfActivity||"",profession:r.profession||"",companyName:r.companyName||"",additionalIncome:r.additionalIncome||"",additionalIncomeAmount:r.additionalIncomeAmount||null,obligation:r.obligation||"option_1",bank:r.bank||"",monthlyPaymentForAnotherBank:r.monthlyPaymentForAnotherBank||null,endDate:r.endDate||new Date().getTime(),amountIncomeCurrentYear:r.amountIncomeCurrentYear||null,noIncome:r.noIncome||new Date().getTime()};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{initialValues:s,validationSchema:zt,validateOnMount:!0,onSubmit:p=>{t(A(p)),o("/services/calculate-mortgage/4")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx(Vt,{})}),e.jsx(he,{})]})}),e.jsx(Xe,{}),e.jsx(Ze,{}),e.jsx(et,{})]})},Ut=()=>{const{stepNumber:t}=ve();D();const{getContent:o}=U("mortgage_calculation"),r=W(),s=j(l=>l.login.isLogin);S.useEffect(()=>{!s&&t!=="1"&&r("/services/calculate-mortgage/1")},[s,t,r]);const p=[o("mobile_step_1","mobile_step_1"),o("mobile_step_2","mobile_step_2"),o("mobile_step_3","mobile_step_3"),o("mobile_step_4","mobile_step_4")];let d;switch(t){case"1":d=e.jsx(Bt,{});break;case"2":d=e.jsx(Yt,{});break;case"3":d=e.jsx(Wt,{});break;case"4":d=e.jsx(Tt,{});break;default:d=e.jsx(ze,{type:"NOT_FOUND"});break}return e.jsxs(e.Fragment,{children:[t!=="4"&&e.jsx(Me,{progress:t,data:p}),e.jsx(S.Suspense,{fallback:e.jsx(qe,{}),children:d})]})},vr=Ut;export{vr as CalculateMortgage};
