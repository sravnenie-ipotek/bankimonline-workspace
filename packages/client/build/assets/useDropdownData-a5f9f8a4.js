var B=Object.defineProperty;var q=(e,r,o)=>r in e?B(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o;var F=(e,r,o)=>(q(e,typeof r!="symbol"?r+"":r,o),o);import{r as l}from"./react-vendor-19e41fc0.js";import{u as O}from"./i18n-vendor-5cfd36a0.js";class G{constructor(){F(this,"cache",new Map);F(this,"TTL",5*60*1e3)}set(r,o){const w=Date.now();this.cache.set(r,{data:o,timestamp:w,expires:w+this.TTL})}get(r){const o=this.cache.get(r);return o?Date.now()>o.expires?(this.cache.delete(r),null):o.data:null}clear(){this.cache.clear()}size(){return this.cache.size}}const x=new G,W=(e,r,o="options")=>{const{i18n:w}=O(),[I,y]=l.useState(!0),[a,g]=l.useState(null),[i,$]=l.useState({options:[],placeholder:void 0,label:void 0,loading:!0,error:null}),c=l.useRef(null),j=w.language||"en",n=l.useCallback(async()=>{var d,s,h,f,T,A,K,S,C,P;try{y(!0),g(null),c.current&&c.current.abort(),c.current=new AbortController;const p=`dropdown_${e}_${j}`,b=x.get(p);let t;if(b)t=b;else{const E=await fetch(`/api/dropdowns/${e}/${j}`,{signal:c.current.signal});if(!E.ok)throw new Error(`HTTP ${E.status}: ${E.statusText}`);if(t=await E.json(),t.status!=="success")throw new Error(`API Error: ${t.status}`);x.set(p,t)}const k=`${e}_${r}`,R=`${k}_ph`,Y=`${k}_label`,M={when_needed:["when"],when:["when_needed"],first_home:["first"],first:["first_home"]};let m=((d=t.options)==null?void 0:d[k])||[],D=((s=t.placeholders)==null?void 0:s[R])||((h=t.placeholders)==null?void 0:h[k]),_=((f=t.labels)==null?void 0:f[Y])||((T=t.labels)==null?void 0:T[k]);if(m.length===0||!D&&!_){const E=M[r]||[];for(const z of E){const v=`${e}_${z}`,H=`${v}_ph`,U=`${v}_label`;if(m.length===0&&(m=((A=t.options)==null?void 0:A[v])||[]),D||(D=((K=t.placeholders)==null?void 0:K[H])||((S=t.placeholders)==null?void 0:S[v])||D),_||(_=((C=t.labels)==null?void 0:C[U])||((P=t.labels)==null?void 0:P[v])||_),m.length>0&&(D||_))break}}$({options:m,placeholder:D,label:_,loading:!1,error:null})}catch(p){if(p.name==="AbortError")return;console.warn(`❌ Dropdown API error for ${e}/${r}:`,p);const b=p instanceof Error?p:new Error("Unknown error");g(b),$({options:[],placeholder:void 0,label:void 0,loading:!1,error:b})}finally{y(!1),c.current=null}},[e,r,j]);l.useEffect(()=>(n(),()=>{c.current&&c.current.abort()}),[n]);const u={...i,loading:I,error:a};return o==="options"&&!I&&!a?u.options:u},X=e=>{const{i18n:r}=O(),[o,w]=l.useState(!0),[I,y]=l.useState(null),[a,g]=l.useState(null),i=l.useRef(null),$=r.language||"en",c=l.useCallback(async()=>{try{w(!0),y(null),i.current&&i.current.abort(),i.current=new AbortController;const n=`dropdown_${e}_${$}`,u=x.get(n);if(u){g(u);return}const d=await fetch(`/api/dropdowns/${e}/${$}`,{signal:i.current.signal});if(!d.ok)throw new Error(`HTTP ${d.status}: ${d.statusText}`);const s=await d.json();if(s.status!=="success")throw new Error(`API Error: ${s.status}`);x.set(n,s),g(s)}catch(n){if(n.name==="AbortError")return;console.warn(`❌ Bulk dropdown API error for ${e}:`,n);const u=n instanceof Error?n:new Error("Unknown error");y(u),g(null)}finally{w(!1),i.current=null}},[e,$]);return l.useEffect(()=>(c(),()=>{i.current&&i.current.abort()}),[c]),{data:a,loading:o,error:I,getDropdownProps:n=>{var T,A,K,S,C,P;if(!a)return{options:[],placeholder:void 0,label:void 0};const u=`${e}_${n}`,d={when_needed:["when"],when:["when_needed"],first_home:["first"],first:["first_home"]};let s=((T=a.options)==null?void 0:T[u])||[],h=(A=a.placeholders)==null?void 0:A[u],f=(K=a.labels)==null?void 0:K[u];if(s.length===0||!h&&!f){const p=d[n]||[];for(const b of p){const t=`${e}_${b}`;if(s.length===0&&(s=((S=a.options)==null?void 0:S[t])||[]),h||(h=((C=a.placeholders)==null?void 0:C[t])||h),f||(f=((P=a.labels)==null?void 0:P[t])||f),s.length>0&&(h||f))break}}return{options:s,placeholder:h,label:f}},refresh:c,clearCache:()=>x.clear()}};export{W as a,X as u};
