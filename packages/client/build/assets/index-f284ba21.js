import{j as e}from"./ui-vendor-5a9cd79c.js";import{r as I,f as W,b as ye,j as xe,k as ve}from"./react-vendor-19e41fc0.js";import{E as M,a as U,D as R,b as ie,A as Ie,T as we,L as qe}from"./index-edeff406.js";import{P as Ee}from"./ProgressBar-fde3ea89.js";import{c as Me,u as j,a as Y,k as ne,l as A,m as Ce,d as Ne,n as i,p as Be,q as Ae,r as De,t as Le,v as Te,w as ke,x as Re,y as Ye,z as Ve,A as je,B as $e,N as ze}from"./index-bc53121f.js";import{u as ee,F as ae,b as se,a as Z,f as C,c as u,g as be}from"./form-vendor-429348f6.js";import{V as We}from"./VideoPoster-aa40ed31.js";import{S as ue,a as Ue,M as He,U as Ge,A as Ke,F as Je,B as Qe,b as Xe,c as Ze,O as et}from"./SourceOfIncomeModal-19002273.js";import{M as tt,U as z,A as oe}from"./AddButton-9bc99600.js";import{u as D}from"./i18n-vendor-5cfd36a0.js";import{I as ot,c as k}from"./IncreasePayment-c8ed01ee.js";import{C as m}from"./Column-b52dd59a.js";import{R as w}from"./Row-69bcb767.js";import{D as Q}from"./DropdownMenu-c93145d6.js";import{F as rt}from"./FormattedInput-d86805f8.js";import{F as le}from"./FormCaption-6b61470d.js";import{F as ce}from"./FormContainer-9a7a5b29.js";import{u as nt}from"./useDropdownData-1abe74c0.js";import{D as he}from"./DoubleButtons-3f20ba9f.js";import{R as it}from"./RowTwo-8e3b11d2.js";import{B as at,P as st,A as lt}from"./PartnerPayMortgage-049556f7.js";import{N as ct,B as dt,E as mt,A as pt,T as ut,C as ht,M as _t,I as gt,P as ft}from"./Taxes-d786bc93.js";import{C as yt,a as xt,H as wt}from"./HowMuchChildrens-9060e1e8.js";import{F as jt}from"./FamilyStatus-4386c1d9.js";import{I as bt}from"./Info-173466ba.js";import{M as Pt,c as Pe,A as Ot,a as St,O as Ft,b as Oe,g as me}from"./componentsByIncomeSource-e02feca6.js";import"./components-vendor-e60b5450.js";import"./utils-vendor-48989965.js";import"./state-vendor-2a767ce0.js";import"./MortgageParameters-601395ac.js";import"./PercentIcon-69cb9491.js";import"./Control-ac74aeaf.js";import"./Calendar-2ac6e5e2.js";import"./ShieldCheckIcon-a0d68f8f.js";const vt="_image_1435f_1",It={image:vt,"inner-div":"_inner-div_1435f_8","bold-text":"_bold-text_1435f_16"},re=Me.bind(It),qt=()=>{const{t,i18n:r}=D(),{values:o}=ee(),l=(o.priceOfEstate-o.initialFee).toLocaleString("en-US"),p=Math.trunc((o.priceOfEstate-o.initialFee)/o.priceOfEstate*100);return e.jsxs(tt,{style:{marginTop:"2px"},children:[e.jsx("span",{className:re("margin-sides"),children:t("calc_mortrage_subtext_1")}),e.jsxs("b",{className:re("bold-text"),children:[l," â‚ª"]}),e.jsx("br",{}),e.jsx("span",{className:re("margin-sides"),children:t("calc_mortrage_subtext_3")}),e.jsxs("b",{className:re("bold-text"),children:[isNaN(p)||p<0?0:p,"%"]})]})};function Et(){const[t,r]=I.useState(51130),[o,l]=I.useState(2654),[p,d]=I.useState({min:4,max:30}),{t:s,i18n:L}=D(),{setFieldValue:E,values:h,errors:x}=ee(),P=j(b=>b.activeField),H=Y();I.useEffect(()=>{(async()=>{var _,q,f,c,g,O;try{const y=await k.getAllParameters("mortgage"),S=((f=(q=(_=y.standards)==null?void 0:_.loan_terms)==null?void 0:q.min_years)==null?void 0:f.value)||4,n=((O=(g=(c=y.standards)==null?void 0:c.loan_terms)==null?void 0:g.max_years)==null?void 0:O.value)||30;d({min:S,max:n})}catch(y){console.error("âŒ Error fetching loan term limits:",y)}})()},[]);const V=b=>{H(ne("period")),E("period",b)},N=b=>{H(ne("monthlyPayment")),E("monthlyPayment",b)};return I.useEffect(()=>{(async()=>{try{if(P==="period"){const _=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,h.period);Number.isNaN(_)||E("monthlyPayment",_)}else{const _=await k.calculateLoanPeriod(h.priceOfEstate,h.initialFee,h.monthlyPayment);Number.isNaN(_)||E("period",_)}}catch(_){console.error("âŒ Error calculating mortgage values:",_)}})()},[P,E,h.initialFee,h.monthlyPayment,h.period,h.priceOfEstate]),I.useLayoutEffect(()=>{(async()=>{var _,q,f,c,g,O;try{const y=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,p.min),S=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,p.max);Number.isNaN(y)||r(y),y===0&&r(1),Number.isNaN(S)||l(S)}catch(y){console.error("âŒ Error calculating payment limits:",y);try{const S=await k.getAllParameters("mortgage"),n=((f=(q=(_=S.standards)==null?void 0:_.payment_limits)==null?void 0:q.default_max)==null?void 0:f.value)||51130,a=((O=(g=(c=S.standards)==null?void 0:c.payment_limits)==null?void 0:g.default_min)==null?void 0:O.value)||2654;r(n),l(a)}catch(S){console.error("âŒ Even database fallback failed:",S),r(51130),l(2654)}}})()},[h.initialFee,h.priceOfEstate,p]),e.jsxs(w,{children:[e.jsxs(m,{children:[e.jsx(ue,{disableCurrency:!0,unitsMax:s("calculate_mortgage_period_units_max"),unitsMin:s("calculate_mortgage_period_units_min"),value:h.period,name:"Period",min:p.min,max:p.max,error:x.period,title:s("calculate_mortgage_period"),handleChange:V}),x.period&&e.jsx(M,{error:x.period})]}),e.jsxs(m,{children:[e.jsx(ue,{unitsMax:"â‚ª",unitsMin:"â‚ª",name:"MonthlyPayment",min:o,max:t,error:x.monthlyPayment,title:s("calculate_mortgage_initial_payment"),handleChange:N,value:h.monthlyPayment}),e.jsx(ot,{}),x.monthlyPayment&&e.jsx(M,{error:x.monthlyPayment})]}),e.jsx(m,{})]})}const Mt=()=>{const{t,i18n:r}=D(),{getContent:o}=U("mortgage_step1"),l=Y(),{data:p,loading:d,error:s,getDropdownProps:L}=nt("mortgage_step1"),[E,h]=I.useState([]),[x,P]=I.useState({}),[H,V]=I.useState(!0);I.useEffect(()=>{const a=async()=>{try{const $=await(await fetch(`/api/get-cities?lang=${r.language}`)).json();if($.status==="success"){const te=$.data.map(G=>({value:G.value,label:G.name}));h(te)}else console.error("Failed to fetch cities:",$.message)}catch(v){console.error("Error fetching cities:",v)}},F=async()=>{var v,$,te,G,_e,ge,fe;try{V(!0);const de=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/api":{}.VITE_NODE_API_BASE_URL||"https://bankimonline.com/api",B=await(await fetch(`${de}/v1/calculation-parameters?business_path=mortgage`)).json();if(B.status==="success"&&B.data.property_ownership_ltvs){const T={};Object.keys(B.data.property_ownership_ltvs).forEach(J=>{T[J]=B.data.property_ownership_ltvs[J].ltv/100}),P(T),console.info("âœ… LTV ratios loaded from database:",T)}else if(B.status==="error"&&((v=B.data)!=null&&v.property_ownership_ltvs)){const T={};Object.keys(B.data.property_ownership_ltvs).forEach(J=>{T[J]=B.data.property_ownership_ltvs[J].ltv/100}),P(T),console.info("ðŸ“‹ Using fallback LTV ratios (database connection issue):",T)}else throw new M("No LTV data in response")}catch(de){console.warn("âš ï¸ Error fetching LTV ratios from calculation parameters API:",de.message),console.info("ðŸ“‹ Using calculationService fallback values");try{const K=await k.getAllParameters("mortgage");P({no_property:((te=($=K.property_ownership_ltvs)==null?void 0:$.no_property)==null?void 0:te.ltv)/100||.75,has_property:((_e=(G=K.property_ownership_ltvs)==null?void 0:G.has_property)==null?void 0:_e.ltv)/100||.5,selling_property:((fe=(ge=K.property_ownership_ltvs)==null?void 0:ge.selling_property)==null?void 0:fe.ltv)/100||.7})}catch{console.warn("ðŸš¨ CRITICAL: Even calculationService failed, using hardcoded emergency values"),P({no_property:.75,has_property:.5,selling_property:.7})}}finally{V(!1)}};a(),F()},[r.language]);const N=L("when_needed"),b=L("type"),_=L("first_home"),q=L("property_ownership");d&&console.log("ðŸ”„ Loading dropdown data for mortgage_step1..."),p&&!d&&console.log("âœ… Dropdown data loaded for mortgage_step1:",{whenNeeded:N.options.length,type:b.options.length,firstHome:_.options.length,propertyOwnership:q.options.length});const{setFieldValue:f,values:c,errors:g,touched:O,setFieldTouched:y}=ee(),S=(a,F)=>{if(!a||a===0)return 1;const v=x[F]||x.no_property||.75;return a*v},n=(a,F)=>{if(!a||a===0)return 0;const v=S(a,F);return a-v};return I.useEffect(()=>{if(c.propertyOwnership&&c.priceOfEstate){const a=n(c.priceOfEstate,c.propertyOwnership),F=c.priceOfEstate;c.initialFee<a?(console.log(`[PROPERTY-OWNERSHIP] Adjusting initial payment from ${c.initialFee} to ${a} (min for ${c.propertyOwnership})`),f("initialFee",a)):c.initialFee>F&&(console.log(`[PROPERTY-OWNERSHIP] Adjusting initial payment from ${c.initialFee} to ${F} (max)`),f("initialFee",F))}},[c.propertyOwnership,c.priceOfEstate,c.initialFee,f]),e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(le,{title:o("mortgage_step1.header.title","calculate_mortgage_title")}),e.jsxs(w,{children:[e.jsxs(m,{children:[e.jsx(rt,{handleChange:a=>{l(ne("period")),f("priceOfEstate",a)},name:"PriceOfEstate",title:o("mortgage_step1.field.property_price","calculate_mortgage_price"),value:c.priceOfEstate,placeholder:"1,000,000",error:g.priceOfEstate,"data-testid":"property-price-input"}),g.priceOfEstate&&e.jsx(M,{error:g.priceOfEstate})]}),e.jsx(m,{children:e.jsx(Q,{title:o("mortgage_step1.field.city","calculate_mortgage_city"),data:E,placeholder:o("mortgage_step1.field.city_ph","Select city"),value:c.cityWhereYouBuy,onChange:a=>f("cityWhereYouBuy",a),onBlur:()=>y("cityWhereYouBuy",!0),searchable:!0,searchPlaceholder:o("mortgage_step1.field.search_ph","Search..."),nothingFoundText:o("mortgage_step1.field.nothing_found","Nothing found"),error:O.cityWhereYouBuy&&g.cityWhereYouBuy,dataTestId:"city-dropdown"})}),e.jsxs(m,{children:[e.jsx(Q,{title:N.label||o("mortgage_step1.field.when_needed","calculate_mortgage_when"),data:N.options,placeholder:N.placeholder||o("mortgage_step1.field.when_needed_ph","calculate_mortgage_when_options_ph"),value:c.whenDoYouNeedMoney,onChange:a=>f("whenDoYouNeedMoney",a),onBlur:()=>y("whenDoYouNeedMoney",!0),error:O.whenDoYouNeedMoney&&g.whenDoYouNeedMoney,dataTestId:"when-needed-dropdown",disabled:d}),s&&e.jsx(M,{error:o("error_dropdown_load_failed","Failed to load options. Please refresh the page.")})]})]}),e.jsxs(w,{children:[e.jsxs(m,{children:[e.jsx(ue,{name:"InitialFee",value:c.initialFee,min:n(c.priceOfEstate,c.propertyOwnership),max:c.priceOfEstate||1,title:o("mortgage_step1.field.initial_fee","calculate_mortgage_initial_fee"),handleChange:a=>{l(ne("period")),f("initialFee",a)},tooltip:o("mortgage_step1.field.initial_payment_tooltip","Minimum down payment depends on property ownership status"),error:g.initialFee,disableRangeValues:!0,"data-testid":"initial-fee-input"}),e.jsx(qt,{}),g.initialFee&&e.jsx(M,{error:g.initialFee})]}),e.jsxs(m,{children:[e.jsx(Q,{title:b.label||o("mortgage_step1.field.type","calculate_mortgage_type"),data:b.options,placeholder:b.placeholder||o("mortgage_step1.field.type_ph","calculate_mortgage_type_ph"),value:c.typeSelect,onChange:a=>f("typeSelect",a),onBlur:()=>y("typeSelect",!0),error:O.typeSelect&&g.typeSelect,dataTestId:"property-type-dropdown",disabled:d}),s&&e.jsx(M,{error:o("error_dropdown_load_failed","Failed to load type options. Please refresh the page.")})]}),e.jsxs(m,{children:[e.jsx(Q,{title:_.label||o("mortgage_step1.field.first_home","calculate_mortgage_first"),data:_.options,placeholder:_.placeholder||o("mortgage_step1.field.first_home_ph","calculate_mortgage_first_ph"),value:c.willBeYourFirst,onChange:a=>f("willBeYourFirst",a),onBlur:()=>y("willBeYourFirst",!0),error:O.willBeYourFirst&&g.willBeYourFirst,dataTestId:"first-home-dropdown",disabled:d}),s&&e.jsx(M,{error:o("error_dropdown_load_failed","Failed to load first home options. Please refresh the page.")})]})]}),e.jsxs(w,{children:[e.jsxs(m,{children:[e.jsx(Q,{title:q.label||o("mortgage_step1.field.property_ownership","calculate_mortgage_property_ownership"),data:q.options,placeholder:q.placeholder||o("mortgage_step1.field.property_ownership_ph","calculate_mortgage_property_ownership_ph"),value:c.propertyOwnership,onChange:a=>f("propertyOwnership",a),onBlur:()=>y("propertyOwnership",!0),error:O.propertyOwnership&&g.propertyOwnership,dataTestId:"property-ownership-dropdown",disabled:d}),s&&e.jsx(M,{error:o("error_dropdown_load_failed","Failed to load property ownership options. Please refresh the page.")})]}),e.jsx(m,{}),e.jsx(m,{})]}),e.jsx(R,{}),e.jsx(Et,{})]})})},Ct=()=>Z().shape({priceOfEstate:C().max(1e7,i("error_max_price",'×¢×¨×š ×”× ×›×¡ ×”×ž×§×¡×™×ž×œ×™ ×”×•× 10,000,000 ×©"×—')).required(i("error_property_value_required","×¢×¨×š ×”× ×›×¡ × ×“×¨×©")),cityWhereYouBuy:u().required(i("error_city_required","×¢×™×¨ × ×“×¨×©×ª")),whenDoYouNeedMoney:u().required(i("error_when_need_mortgage","×™×© ×œ×‘×—×•×¨ ×ž×ª×™ ×ª×–×“×§×§ ×œ×ž×©×›× ×ª×")),initialFee:C().test("initial-payment-percentage",i("error_initial_fee","×ª×©×œ×•× ×¨××©×•× ×™ ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 75% ×ž×¢×¨×š ×”× ×›×¡"),function(t){const r=this.parent.priceOfEstate||0;return Nt(r,t)}).required(i("error_initial_payment_required","×ª×©×œ×•× ×¨××©×•× ×™ × ×“×¨×©")),typeSelect:u().required(i("error_mortgage_type_required","×¡×•×’ ×ž×©×›× ×ª×” × ×“×¨×©")),willBeYourFirst:u().required(i("error_first_home_required","×× × ×¦×™×™×Ÿ ×× ×–×” ×”×‘×™×ª ×”×¨××©×•×Ÿ ×©×œ×š")),propertyOwnership:u().required(i("error_property_ownership_required","×¡×˜×˜×•×¡ ×‘×¢×œ×•×ª ×¢×œ × ×›×¡ × ×“×¨×©")),period:C().min(4,i("error_min_period","×ª×§×•×¤×” ×ž×™× ×™×ž×œ×™×ª ×”×™× 4 ×©× ×™×")).max(30,i("error_max_period","×ª×§×•×¤×” ×ž×§×¡×™×ž×œ×™×ª ×”×™× 30 ×©× ×”")).required(i("error_period_required","×ª×§×•×¤×ª ×”×ž×©×›× ×ª×” × ×“×¨×©×ª")),monthlyPayment:C().min(2654,i("error_min_monthly_payment",'×ª×©×œ×•× ×—×•×“×©×™ ×ž×™× ×™×ž×œ×™ ×”×•× 2,664 ×©"×—')).required(i("error_monthly_payment_required","×ª×©×œ×•× ×—×•×“×©×™ × ×“×¨×©"))});function Nt(t,r){const o=t*.25;return typeof r>"u"?!1:r>=o}const Bt=()=>{D();const{getContent:t}=U("mortgage_step1"),r=Y(),o=W(),l=j(s=>s.mortgage),p=j(s=>s.login.isLogin),d={priceOfEstate:l.priceOfEstate||1e6,cityWhereYouBuy:l.cityWhereYouBuy||"",whenDoYouNeedMoney:l.whenDoYouNeedMoney||"",initialFee:l.initialFee||5e5,typeSelect:l.typeSelect||"",willBeYourFirst:l.willBeYourFirst||"",propertyOwnership:l.propertyOwnership||"",period:l.period||4,monthlyPayment:l.monthlyPayment||11514};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{initialValues:d,validationSchema:Ct(),validateOnMount:!0,onSubmit:s=>{r(A(s)),p?o("/services/calculate-mortgage/2"):(r(Ce()),r(Ne("phoneVerification")))},children:e.jsxs(se,{children:[e.jsxs(ie,{children:[e.jsx(We,{title:t("video_calculate_mortgage_title","video_calculate_mortgage_title"),text:t("show_offers","show_offers"),size:"small"}),e.jsx(Mt,{})]}),e.jsx(Ue,{})]})}),e.jsx(He,{}),e.jsx(Ie,{})]})},At=()=>{D();const{getContent:t}=U("mortgage_step4"),r=j(l=>l.login.loginData),o=j(l=>l.mortgage);return e.jsxs(ce,{children:[e.jsx(le,{title:t("calculate_mortgage_final","calculate_mortgage_final")}),e.jsx(Ge,{cost:o.priceOfEstate,initialPayment:o.initialFee,period:o.period,nameSurname:r==null?void 0:r.nameSurname,phoneNumber:r==null?void 0:r.phoneNumber}),e.jsx(Ke,{text:t("calculate_mortgage_warning","calculate_mortgage_warning")}),e.jsx(w,{children:e.jsx(Je,{})}),e.jsx(Qe,{})]})},Dt={selectedBank:"",selectedOffer:null},Lt=Z().shape({selectedBank:u(),selectedOffer:Z().nullable()}),Tt=()=>{const t=Y(),r=W();return j(o=>o.login.loginData),j(o=>o.login.isLogin),e.jsx(ae,{initialValues:Dt,validationSchema:Lt,validateOnMount:!0,onSubmit:o=>{console.log("Saving mortgage data and proceeding...",o),t(A(o)),console.log("Proceeding to application submission (auth bypassed for testing)"),r("/services/application-submitted")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx(At,{})}),e.jsx(he,{})]})})},kt=()=>{D();const{getContent:t}=U("mortgage_step2"),{values:r}=ee(),o=j(l=>l.login.loginData);return e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(le,{title:t("mortgage_step2_title","Personal Details")}),e.jsxs(it,{children:[e.jsx(bt,{}),e.jsx(z,{name:o==null?void 0:o.nameSurname,phone:o==null?void 0:o.phoneNumber})]}),e.jsxs(w,{children:[e.jsx(ct,{}),e.jsx(dt,{}),e.jsx(mt,{})]}),e.jsxs(w,{children:[e.jsxs(m,{style:{gap:"2rem"},children:[e.jsx(pt,{}),r.additionalCitizenships==="yes"&&e.jsx(yt,{})]}),e.jsxs(m,{style:{gap:"2rem"},children:[e.jsx(ut,{}),r.taxes==="yes"&&e.jsx(xt,{})]}),e.jsxs(m,{style:{gap:"2rem"},children:[e.jsx(ht,{}),r.childrens==="yes"&&e.jsx(wt,{})]})]}),e.jsx(R,{}),e.jsxs(w,{children:[e.jsx(_t,{}),e.jsx(gt,{}),e.jsx(ft,{})]}),e.jsx(R,{}),e.jsxs(w,{children:[e.jsx(at,{}),e.jsx(m,{}),e.jsx(m,{})]}),e.jsx(R,{}),e.jsxs(w,{children:[e.jsx(jt,{}),e.jsx(m,{children:r.familyStatus==="option_2"&&e.jsx(st,{})}),e.jsx(m,{children:r.partnerPayMortgage==="yes"&&r.familyStatus==="option_2"&&e.jsx(lt,{})})]})]})})},Fe=()=>Z().shape({nameSurname:u().required(i("error_name_surname","Please enter your name and surname")),birthday:u().required(i("error_date","Please enter a valid date")),education:u().required(i("error_education_required","Education is required")),additionalCitizenships:u().required(i("error_citizenship_required","Citizenship information is required")),citizenshipsDropdown:be().when("additionalCitizenships",{is:"yes",then:t=>t.min(1,i("error_citizenship_countries_required","Please select at least one citizenship country")),otherwise:t=>t.min(0)}),taxes:u().required(i("error_taxes_required","Tax payment information is required")),countriesPayTaxes:be().when("taxes",{is:"yes",then:t=>t.min(1,i("error_tax_countries_required","Please select at least one tax country")),otherwise:t=>t.min(0)}),childrens:u().required(i("error_children_required","Children information is required")),howMuchChildrens:C().required(i("error_children_count_required","Number of children is required")),medicalInsurance:u().required(i("error_medical_insurance_required","Medical insurance information is required")),isForeigner:u().required(i("error_foreigner_required","Foreigner status is required")),publicPerson:u().required(i("error_public_person_required","Public person status is required")),borrowers:C().min(1,i("error_quantity_borrowers","At least one borrower is required")).required(i("error_quantity_borrowers","Number of borrowers is required")),familyStatus:u().required(i("error_family_status_required","Family status is required")),partnerPayMortgage:u().when("familyStatus",{is:"Married",then:t=>t.required(i("error_partner_mortgage_required","Partner mortgage information is required")),otherwise:t=>t.notRequired()})});Fe();const Rt=()=>{const t=Y(),r=W(),o=j(d=>d.mortgage),p={nameSurname:j(d=>d.login.loginData).nameSurname||o.nameSurname||"",birthday:o.birthday||new Date(new Date().setFullYear(new Date().getFullYear()-18)).getTime(),education:o.education||"",additionalCitizenships:o.additionalCitizenships||null,citizenshipsDropdown:o.citizenshipsDropdown||[],taxes:o.taxes||null,countriesPayTaxes:o.countriesPayTaxes||[],childrens:o.childrens||null,howMuchChildrens:o.howMuchChildrens||1,medicalInsurance:o.medicalInsurance||null,isForeigner:o.isForeigner||null,publicPerson:o.publicPerson||null,borrowers:o.borrowers||null,familyStatus:o.familyStatus||"",partnerPayMortgage:o.partnerPayMortgage||null,addPartner:o.addPartner||""};return e.jsx(ae,{initialValues:p,validationSchema:Fe(),validateOnMount:!0,onSubmit:d=>{t(A(d)),r("/services/calculate-mortgage/3")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx(kt,{})}),e.jsx(he,{})]})})},Se=t=>{if(!t)return!1;const r=t.toLowerCase();return r==="option_1"||r==="1"||r.includes("no_additional")||r.includes("no additional")||r.includes("none")},Yt=t=>{if(!t)return!1;const r=t.toLowerCase();return r==="option_1"||r.includes("no_obligation")||r.includes("no obligation")||r.includes("none")},Vt=()=>{D();const{getContent:t}=U("mortgage_step3"),r=W(),{values:o}=ee(),{mainSourceOfIncome:l,additionalIncome:p,obligation:d}=o,s=Y(),L=j(n=>n.borrowers.sourceOfIncomeModal),E=j(n=>n.borrowers.additionalIncomeModal),h=j(n=>n.borrowers.obligationModal),x=j(n=>n.otherBorrowers.otherBorrowers),P=j(n=>n.login.loginData),H=()=>{s(A(o)),s(Be())},V=()=>{s(A(o)),s(Ae())},N=()=>{s(A(o)),s(De())},b=n=>{s(Le({id:n}))},_=n=>{s(Te({id:n}))},q=n=>{s(ke({id:n}))},f=n=>{s(Re(n))},c=n=>{s(Ye(n))},g=n=>{s(Ve(n))},O=n=>{s(je(n));const F=!x.some(v=>v.id===n)?me(x):n;r({pathname:"/services/other-borrowers/1/",search:xe({pageId:String(F)}).toString()})},y=()=>{s(je(me(x))),s(A(o)),r({pathname:"/services/other-borrowers/1/",search:xe({pageId:me(x).toString()}).toString()})},S=n=>{s($e(n))};return e.jsxs(ce,{children:[e.jsx(le,{title:t("mortgage_step3_title","Income & Employment Information")}),e.jsx(z,{name:P==null?void 0:P.nameSurname,phone:P==null?void 0:P.phoneNumber}),e.jsxs(w,{children:[e.jsx(Pt,{}),(()=>{const a={employee:"employee",selfemployed:"selfemployed",pension:"pension",student:"student",unemployed:"unemployed",unpaid_leave:"unpaid_leave",other:"other",1:"employee",2:"selfemployed",3:"selfemployed",4:"pension",5:"student",6:"unemployed",7:"other",option_1:"employee",option_2:"selfemployed",option_3:"selfemployed",option_4:"pension",option_5:"student",option_6:"unemployed",option_7:"other"}[String(l)]||"";return a&&Pe[a]?Pe[a].map((F,v)=>e.jsx(ye.Fragment,{children:F},v)):null})()]}),e.jsx(w,{children:e.jsx(m,{children:l&&e.jsxs(e.Fragment,{children:[L.map(n=>e.jsx(z,{onEdit:()=>f(n.id),onDelete:()=>b(n.id),enableEdit:!0,name:`${t("source_of_income","source_of_income")}${n.id+1}`},n.id)),e.jsx(oe,{onClick:H,color:"#FBE54D",value:t("add_place_to_work","add_place_to_work"),variant:"none"})]})})}),e.jsx(R,{}),e.jsxs(w,{children:[e.jsx(Ot,{}),p&&!Se(p)&&e.jsx(St,{}),e.jsx(m,{})]}),p&&!Se(p)&&e.jsx(w,{children:e.jsxs(m,{children:[E.map(n=>e.jsx(z,{onEdit:()=>c(n.id),onDelete:()=>_(n.id),enableEdit:!0,name:`${t("additional_source_of_income","additional_source_of_income")}${n.id+1}`},n.id)),e.jsx(oe,{onClick:V,color:"#FBE54D",value:t("add_additional_source_of_income","add_additional_source_of_income"),variant:"none"})]})}),e.jsx(R,{}),e.jsxs(w,{children:[e.jsx(Ft,{}),Oe[d]&&Oe[d].map((n,a)=>e.jsx(ye.Fragment,{children:n},a)),e.jsx(m,{})]}),d&&!Yt(d)&&e.jsx(w,{children:e.jsxs(m,{children:[h.map(n=>e.jsx(z,{onEdit:()=>g(n.id),onDelete:()=>q(n.id),enableEdit:!0,name:`${t("obligation","obligation")}${n.id+1}`},n.id)),e.jsx(oe,{onClick:N,color:"#FBE54D",value:t("add_obligation","add_obligation"),variant:"none"})]})}),e.jsx(R,{}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[x&&e.jsx(we,{title:t("borrower","borrower")}),e.jsxs(w,{style:{columnGap:"2rem"},children:[x.map(n=>e.jsx(m,{children:e.jsx(z,{onEdit:()=>O(n.id),onDelete:()=>S(n.id),enableEdit:!0,name:n.nameSurname},n.id)},n.id)),!x&&e.jsx(we,{title:t("borrower","borrower")}),e.jsx(m,{children:e.jsx(oe,{value:t("add_borrower","add_borrower"),onClick:y,style:{height:"3.5rem",borderRadius:"0.25rem",padding:"0",width:"13.125rem"}})}),e.jsx(m,{})]})]})]})},X=t=>{if(!t)return!1;const r=t.toLowerCase();return r.includes("unemployed")||r.includes("no_income")||r.includes("no income")||r.includes("option_5")||r.includes("option_6")||r==="app.mortgage.step3.main_source_income_option_5"||r==="app.mortgage.step3.main_source_income_option_6"||r==="other"||r==="unpaid_leave"},$t=t=>{if(!t)return!1;const r=t.toLowerCase();return r==="option_1"||r==="1"||r.includes("no_additional")||r.includes("no additional")||r.includes("none")},pe=t=>{if(!t)return!1;const r=t.toLowerCase();return r==="option_1"||r==="no_obligations"||r.includes("no_obligation")||r.includes("no obligation")||r.includes("none")},zt=Z().shape({mainSourceOfIncome:u().required(i("error_select_answer","Please select an answer")).test("not-empty",i("error_select_answer","Please select an answer"),t=>t!=null&&t!==""),monthlyIncome:C().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),startDate:u().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_date","Please enter a valid date")),otherwise:t=>t.notRequired()}),fieldOfActivity:u().when("mainSourceOfIncome",{is:t=>t!=null&&t!==""&&!X(t),then:t=>t.required(i("error_select_field_of_activity","Please select field of activity")),otherwise:t=>t.notRequired()}),profession:u().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),companyName:u().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),additionalIncome:u().required(i("error_select_one_of_the_options","Please select one of the options")).test("not-empty",i("error_select_one_of_the_options","Please select one of the options"),t=>t!=null&&t!==""),additionalIncomeAmount:C().when("additionalIncome",{is:t=>t!=null&&t!==""&&!$t(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),obligation:u().required(i("error_select_one_of_the_options","Please select one of the options")),bank:u().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_select_bank","Please select a bank")),otherwise:t=>t.notRequired()}),monthlyPaymentForAnotherBank:C().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),endDate:u().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_date","Please enter a valid date")),otherwise:t=>t.notRequired()})}),Wt=()=>{const t=Y(),r=W(),o=j(p=>p.mortgage),l={mainSourceOfIncome:o.mainSourceOfIncome||"",monthlyIncome:o.monthlyIncome||null,startDate:o.startDate||new Date().getTime(),fieldOfActivity:o.fieldOfActivity||"",profession:o.profession||"",companyName:o.companyName||"",additionalIncome:o.additionalIncome||"",additionalIncomeAmount:o.additionalIncomeAmount||null,obligation:o.obligation||"option_1",bank:o.bank||"",monthlyPaymentForAnotherBank:o.monthlyPaymentForAnotherBank||null,endDate:o.endDate||new Date().getTime(),amountIncomeCurrentYear:o.amountIncomeCurrentYear||null,noIncome:o.noIncome||new Date().getTime()};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{initialValues:l,validationSchema:zt,validateOnMount:!0,onSubmit:p=>{t(A(p)),r("/services/calculate-mortgage/4")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx(Vt,{})}),e.jsx(he,{})]})}),e.jsx(Xe,{}),e.jsx(Ze,{}),e.jsx(et,{})]})},Ut=()=>{const{stepNumber:t}=ve();D();const{getContent:r}=U("mortgage_calculation"),o=W(),l=j(s=>s.login.isLogin);I.useEffect(()=>{!l&&t!=="1"&&o("/services/calculate-mortgage/1")},[l,t,o]);const p=[r("mobile_step_1","mobile_step_1"),r("mobile_step_2","mobile_step_2"),r("mobile_step_3","mobile_step_3"),r("mobile_step_4","mobile_step_4")];let d;switch(t){case"1":d=e.jsx(Bt,{});break;case"2":d=e.jsx(Rt,{});break;case"3":d=e.jsx(Wt,{});break;case"4":d=e.jsx(Tt,{});break;default:d=e.jsx(ze,{type:"NOT_FOUND"});break}return e.jsxs(e.Fragment,{children:[t!=="4"&&e.jsx(Ee,{progress:t,data:p}),e.jsx(I.Suspense,{fallback:e.jsx(qe,{}),children:d})]})},Io=Ut;export{Io as CalculateMortgage};
