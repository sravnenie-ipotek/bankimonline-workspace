import{j as e}from"./ui-vendor-5a9cd79c.js";import{r as I,f as U,b as ye,j as xe,k as Ie}from"./react-vendor-19e41fc0.js";import{E,a as W,D as V,b as ie,A as qe,T as we,L as Me}from"./index-ec77e4e1.js";import{P as Ee}from"./ProgressBar-c25c4642.js";import{c as Ce,u as j,a as Y,k as ne,l as B,m as Ne,d as Be,n as i,p as Ae,q as De,r as Le,t as Te,v as ke,w as Ve,x as Ye,y as Re,z as $e,A as je,B as ze,N as Ue}from"./index-3dbb29a1.js";import{u as ee,F as ae,b as se,a as Z,f as C,c as u,g as be,h as Pe}from"./form-vendor-3025b96d.js";import{V as We}from"./VideoPoster-63efecc0.js";import{S as ue,a as He,M as Ge,U as Ke,A as Je,F as Qe,B as Xe,b as Ze,c as et,O as tt}from"./SourceOfIncomeModal-44993339.js";import{M as rt,U as z,A as re}from"./AddButton-624a4d56.js";import{u as A}from"./i18n-vendor-5cfd36a0.js";import{I as ot,c as k}from"./IncreasePayment-378ce087.js";import{C as d}from"./Column-054126c6.js";import{R as w}from"./Row-944e2cc4.js";import{D as Q}from"./DropdownMenu-152071fc.js";import{F as nt}from"./FormattedInput-dc439110.js";import{F as le}from"./FormCaption-5b90235c.js";import{F as ce}from"./FormContainer-cd033bd5.js";import{u as it}from"./useDropdownData-a5f9f8a4.js";import{D as he}from"./DoubleButtons-4cdc262f.js";import{R as at}from"./RowTwo-660caefb.js";import{B as st,P as lt,A as ct}from"./PartnerPayMortgage-53724cb3.js";import{N as dt,B as mt,E as pt,A as ut,T as ht,C as _t,M as gt,I as ft,P as yt}from"./Taxes-fb0fa6c9.js";import{C as xt,a as wt,H as jt}from"./HowMuchChildrens-e79d8650.js";import{F as bt}from"./FamilyStatus-3e8103ca.js";import{I as Pt}from"./Info-d0d8945b.js";import{M as Ot,c as Oe,A as vt,a as Ft,O as St,b as ve,g as me}from"./componentsByIncomeSource-e4b395a9.js";import"./components-vendor-e60b5450.js";import"./utils-vendor-48989965.js";import"./state-vendor-2a767ce0.js";import"./MortgageParameters-e63991ea.js";import"./PercentIcon-69cb9491.js";import"./Control-b84f50cd.js";import"./Calendar-9efeb91f.js";import"./ShieldCheckIcon-a0d68f8f.js";const It="_image_1435f_1",qt={image:It,"inner-div":"_inner-div_1435f_8","bold-text":"_bold-text_1435f_16"},oe=Ce.bind(qt),Mt=()=>{const{t,i18n:o}=A(),{values:r}=ee(),l=(r.priceOfEstate-r.initialFee).toLocaleString("en-US"),p=Math.trunc((r.priceOfEstate-r.initialFee)/r.priceOfEstate*100);return e.jsxs(rt,{style:{marginTop:"2px"},children:[e.jsx("span",{className:oe("margin-sides"),children:t("calc_mortrage_subtext_1")}),e.jsxs("b",{className:oe("bold-text"),children:[l," â‚ª"]}),e.jsx("br",{}),e.jsx("span",{className:oe("margin-sides"),children:t("calc_mortrage_subtext_3")}),e.jsxs("b",{className:oe("bold-text"),children:[isNaN(p)||p<0?0:p,"%"]})]})};function Et(){const[t,o]=I.useState(51130),[r,l]=I.useState(2654),[p,m]=I.useState({min:4,max:30}),{t:s,i18n:D}=A(),{setFieldValue:M,values:h,errors:x}=ee(),b=j(P=>P.activeField),H=Y();I.useEffect(()=>{(async()=>{var _,q,f,c,g,O;try{const y=await k.getAllParameters("mortgage"),v=((f=(q=(_=y.standards)==null?void 0:_.loan_terms)==null?void 0:q.min_years)==null?void 0:f.value)||4,n=((O=(g=(c=y.standards)==null?void 0:c.loan_terms)==null?void 0:g.max_years)==null?void 0:O.value)||30;m({min:v,max:n})}catch(y){console.error("âŒ Error fetching loan term limits:",y)}})()},[]);const R=P=>{H(ne("period")),M("period",P)},L=P=>{H(ne("monthlyPayment")),M("monthlyPayment",P)};return I.useEffect(()=>{(async()=>{try{if(b==="period"){const _=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,h.period);Number.isNaN(_)||M("monthlyPayment",_)}else{const _=await k.calculateLoanPeriod(h.priceOfEstate,h.initialFee,h.monthlyPayment);Number.isNaN(_)||M("period",_)}}catch(_){console.error("âŒ Error calculating mortgage values:",_)}})()},[b,M,h.initialFee,h.monthlyPayment,h.period,h.priceOfEstate]),I.useLayoutEffect(()=>{(async()=>{var _,q,f,c,g,O;try{const y=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,p.min),v=await k.calculateMortgagePayment(h.priceOfEstate,h.initialFee,p.max);Number.isNaN(y)||o(y),y===0&&o(1),Number.isNaN(v)||l(v)}catch(y){console.error("âŒ Error calculating payment limits:",y);try{const v=await k.getAllParameters("mortgage"),n=((f=(q=(_=v.standards)==null?void 0:_.payment_limits)==null?void 0:q.default_max)==null?void 0:f.value)||51130,a=((O=(g=(c=v.standards)==null?void 0:c.payment_limits)==null?void 0:g.default_min)==null?void 0:O.value)||2654;o(n),l(a)}catch(v){console.error("âŒ Even database fallback failed:",v),o(51130),l(2654)}}})()},[h.initialFee,h.priceOfEstate,p]),e.jsxs(w,{children:[e.jsxs(d,{children:[e.jsx(ue,{disableCurrency:!0,unitsMax:s("calculate_mortgage_period_units_max"),unitsMin:s("calculate_mortgage_period_units_min"),value:h.period,name:"Period",min:p.min,max:p.max,error:x.period,title:s("calculate_mortgage_period"),handleChange:R}),x.period&&e.jsx(E,{error:x.period})]}),e.jsxs(d,{children:[e.jsx(ue,{unitsMax:"â‚ª",unitsMin:"â‚ª",name:"MonthlyPayment",min:r,max:t,error:x.monthlyPayment,title:s("calculate_mortgage_initial_payment"),handleChange:L,value:h.monthlyPayment}),e.jsx(ot,{}),x.monthlyPayment&&e.jsx(E,{error:x.monthlyPayment})]}),e.jsx(d,{})]})}const Ct=()=>{const{t,i18n:o}=A(),{getContent:r}=W("mortgage_step1"),l=Y(),{data:p,loading:m,error:s,getDropdownProps:D}=it("mortgage_step1"),[M,h]=I.useState([]),[x,b]=I.useState({}),[H,R]=I.useState(!0);I.useEffect(()=>{const a=async()=>{try{const $=await(await fetch(`/api/get-cities?lang=${o.language}`)).json();if($.status==="success"){const te=$.data.map(G=>({value:G.value,label:G.name}));h(te)}else console.error("Failed to fetch cities:",$.message)}catch(S){console.error("Error fetching cities:",S)}},F=async()=>{var S,$,te,G,_e,ge,fe;try{R(!0);const de=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/api":{}.VITE_NODE_API_BASE_URL||"https://bankimonline.com/api",N=await(await fetch(`${de}/v1/calculation-parameters?business_path=mortgage`)).json();if(N.status==="success"&&N.data.property_ownership_ltvs){const T={};Object.keys(N.data.property_ownership_ltvs).forEach(J=>{T[J]=N.data.property_ownership_ltvs[J].ltv/100}),b(T),console.info("âœ… LTV ratios loaded from database:",T)}else if(N.status==="error"&&((S=N.data)!=null&&S.property_ownership_ltvs)){const T={};Object.keys(N.data.property_ownership_ltvs).forEach(J=>{T[J]=N.data.property_ownership_ltvs[J].ltv/100}),b(T),console.info("ðŸ“‹ Using fallback LTV ratios (database connection issue):",T)}else throw new E("No LTV data in response")}catch(de){console.warn("âš ï¸ Error fetching LTV ratios from calculation parameters API:",de.message),console.info("ðŸ“‹ Using calculationService fallback values");try{const K=await k.getAllParameters("mortgage");b({no_property:((te=($=K.property_ownership_ltvs)==null?void 0:$.no_property)==null?void 0:te.ltv)/100||.75,has_property:((_e=(G=K.property_ownership_ltvs)==null?void 0:G.has_property)==null?void 0:_e.ltv)/100||.5,selling_property:((fe=(ge=K.property_ownership_ltvs)==null?void 0:ge.selling_property)==null?void 0:fe.ltv)/100||.7})}catch{console.warn("ðŸš¨ CRITICAL: Even calculationService failed, using hardcoded emergency values"),b({no_property:.75,has_property:.5,selling_property:.7})}}finally{R(!1)}};a(),F()},[o.language]);const L=D("when_needed"),P=D("type"),_=D("first_home"),q=D("property_ownership"),{setFieldValue:f,values:c,errors:g,touched:O,setFieldTouched:y}=ee(),v=(a,F)=>{if(!a||a===0)return 1;const S=x[F]||x.no_property||.75;return a*S},n=(a,F)=>{if(!a||a===0)return 0;const S=v(a,F);return a-S};return I.useEffect(()=>{if(c.propertyOwnership&&c.priceOfEstate){const a=n(c.priceOfEstate,c.propertyOwnership),F=c.priceOfEstate;c.initialFee<a?(console.log(`Auto-adjusting initial fee from ${c.initialFee} to minimum ${a}`),f("initialFee",a)):c.initialFee>F&&(console.log(`Auto-adjusting initial fee from ${c.initialFee} to maximum ${F}`),f("initialFee",F))}},[c.propertyOwnership,c.priceOfEstate,c.initialFee,f]),e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(le,{title:r("mortgage_step1.header.title","calculate_mortgage_title")}),e.jsxs(w,{children:[e.jsxs(d,{children:[e.jsx(nt,{handleChange:a=>{l(ne("period")),f("priceOfEstate",a)},name:"PriceOfEstate",title:r("mortgage_step1.field.property_price","calculate_mortgage_price"),value:c.priceOfEstate,placeholder:"1,000,000",error:g.priceOfEstate,"data-testid":"property-price-input"}),g.priceOfEstate&&e.jsx(E,{error:g.priceOfEstate})]}),e.jsx(d,{children:e.jsx(Q,{title:r("mortgage_step1.field.city","calculate_mortgage_city"),data:M,placeholder:r("mortgage_step1.field.city_ph","Select city"),value:c.cityWhereYouBuy,onChange:a=>f("cityWhereYouBuy",a),onBlur:()=>y("cityWhereYouBuy",!0),searchable:!0,searchPlaceholder:r("mortgage_step1.field.search_ph","Search..."),nothingFoundText:r("mortgage_step1.field.nothing_found","Nothing found"),error:O.cityWhereYouBuy&&g.cityWhereYouBuy,dataTestId:"city-dropdown"})}),e.jsxs(d,{children:[e.jsx(Q,{title:L.label||r("mortgage_step1.field.when_needed","calculate_mortgage_when"),data:L.options,placeholder:L.placeholder||r("mortgage_step1.field.when_needed_ph","calculate_mortgage_when_options_ph"),value:c.whenDoYouNeedMoney,onChange:a=>f("whenDoYouNeedMoney",a),onBlur:()=>y("whenDoYouNeedMoney",!0),error:O.whenDoYouNeedMoney&&g.whenDoYouNeedMoney,dataTestId:"when-needed-dropdown",disabled:m}),s&&e.jsx(E,{error:r("error_dropdown_load_failed","Failed to load options. Please refresh the page.")})]})]}),e.jsxs(w,{children:[e.jsxs(d,{children:[e.jsx(ue,{name:"InitialFee",value:c.initialFee,min:n(c.priceOfEstate,c.propertyOwnership),max:c.priceOfEstate||1,title:r("mortgage_step1.field.initial_fee","calculate_mortgage_initial_fee"),handleChange:a=>{l(ne("period")),f("initialFee",a)},tooltip:r("mortgage_step1.field.initial_payment_tooltip","Minimum down payment depends on property ownership status"),error:g.initialFee,disableRangeValues:!0,"data-testid":"initial-fee-input"}),e.jsx(Mt,{}),g.initialFee&&e.jsx(E,{error:g.initialFee})]}),e.jsxs(d,{children:[e.jsx(Q,{title:P.label||r("mortgage_step1.field.type","calculate_mortgage_type"),data:P.options,placeholder:P.placeholder||r("mortgage_step1.field.type_ph","calculate_mortgage_type_ph"),value:c.typeSelect,onChange:a=>f("typeSelect",a),onBlur:()=>y("typeSelect",!0),error:O.typeSelect&&g.typeSelect,dataTestId:"property-type-dropdown",disabled:m}),s&&e.jsx(E,{error:r("error_dropdown_load_failed","Failed to load type options. Please refresh the page.")})]}),e.jsxs(d,{children:[e.jsx(Q,{title:_.label||r("mortgage_step1.field.first_home","calculate_mortgage_first"),data:_.options,placeholder:_.placeholder||r("mortgage_step1.field.first_home_ph","calculate_mortgage_first_ph"),value:c.willBeYourFirst,onChange:a=>f("willBeYourFirst",a),onBlur:()=>y("willBeYourFirst",!0),error:O.willBeYourFirst&&g.willBeYourFirst,dataTestId:"first-home-dropdown",disabled:m}),s&&e.jsx(E,{error:r("error_dropdown_load_failed","Failed to load first home options. Please refresh the page.")})]})]}),e.jsxs(w,{children:[e.jsxs(d,{children:[e.jsx(Q,{title:q.label||r("mortgage_step1.field.property_ownership","calculate_mortgage_property_ownership"),data:q.options,placeholder:q.placeholder||r("mortgage_step1.field.property_ownership_ph","calculate_mortgage_property_ownership_ph"),value:c.propertyOwnership,onChange:a=>f("propertyOwnership",a),onBlur:()=>y("propertyOwnership",!0),error:O.propertyOwnership&&g.propertyOwnership,dataTestId:"property-ownership-dropdown",disabled:m}),s&&e.jsx(E,{error:r("error_dropdown_load_failed","Failed to load property ownership options. Please refresh the page.")})]}),e.jsx(d,{}),e.jsx(d,{})]}),e.jsx(V,{}),e.jsx(Et,{})]})})},Nt=()=>Z().shape({priceOfEstate:C().max(1e7,i("error_max_price",'×¢×¨×š ×”× ×›×¡ ×”×ž×§×¡×™×ž×œ×™ ×”×•× 10,000,000 ×©"×—')).required(i("error_property_value_required","×¢×¨×š ×”× ×›×¡ × ×“×¨×©")),cityWhereYouBuy:u().required(i("error_city_required","×¢×™×¨ × ×“×¨×©×ª")),whenDoYouNeedMoney:u().required(i("error_when_need_mortgage","×™×© ×œ×‘×—×•×¨ ×ž×ª×™ ×ª×–×“×§×§ ×œ×ž×©×›× ×ª×")),initialFee:C().test("initial-payment-percentage",i("error_initial_fee","×ª×©×œ×•× ×¨××©×•× ×™ ×œ× ×™×›×•×œ ×œ×¢×œ×•×ª ×¢×œ 75% ×ž×¢×¨×š ×”× ×›×¡"),function(t){const o=this.parent.priceOfEstate||0;return Bt(o,t)}).required(i("error_initial_payment_required","×ª×©×œ×•× ×¨××©×•× ×™ × ×“×¨×©")),typeSelect:u().required(i("error_mortgage_type_required","×¡×•×’ ×ž×©×›× ×ª×” × ×“×¨×©")),willBeYourFirst:u().required(i("error_first_home_required","×× × ×¦×™×™×Ÿ ×× ×–×” ×”×‘×™×ª ×”×¨××©×•×Ÿ ×©×œ×š")),propertyOwnership:u().required(i("error_property_ownership_required","×¡×˜×˜×•×¡ ×‘×¢×œ×•×ª ×¢×œ × ×›×¡ × ×“×¨×©")),period:C().min(4,i("error_min_period","×ª×§×•×¤×” ×ž×™× ×™×ž×œ×™×ª ×”×™× 4 ×©× ×™×")).max(30,i("error_max_period","×ª×§×•×¤×” ×ž×§×¡×™×ž×œ×™×ª ×”×™× 30 ×©× ×”")).required(i("error_period_required","×ª×§×•×¤×ª ×”×ž×©×›× ×ª×” × ×“×¨×©×ª")),monthlyPayment:C().min(2654,i("error_min_monthly_payment",'×ª×©×œ×•× ×—×•×“×©×™ ×ž×™× ×™×ž×œ×™ ×”×•× 2,664 ×©"×—')).required(i("error_monthly_payment_required","×ª×©×œ×•× ×—×•×“×©×™ × ×“×¨×©"))});function Bt(t,o){const r=t*.25;return typeof o>"u"?!1:o>=r}const At=()=>{A();const{getContent:t}=W("mortgage_step1"),o=Y(),r=U(),l=j(s=>s.mortgage),p=j(s=>s.login.isLogin),m={priceOfEstate:l.priceOfEstate||1e6,cityWhereYouBuy:l.cityWhereYouBuy||"",whenDoYouNeedMoney:l.whenDoYouNeedMoney||"",initialFee:l.initialFee||5e5,typeSelect:l.typeSelect||"",willBeYourFirst:l.willBeYourFirst||"",propertyOwnership:l.propertyOwnership||"",period:l.period||4,monthlyPayment:l.monthlyPayment||11514};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{initialValues:m,validationSchema:Nt(),validateOnMount:!0,onSubmit:s=>{o(B(s)),p?r("/services/calculate-mortgage/2"):(o(Ne()),o(Be("phoneVerification")))},children:e.jsxs(se,{children:[e.jsxs(ie,{children:[e.jsx(We,{title:t("video_calculate_mortgage_title","video_calculate_mortgage_title"),text:t("show_offers","show_offers"),size:"small"}),e.jsx(Ct,{})]}),e.jsx(He,{})]})}),e.jsx(Ge,{}),e.jsx(qe,{})]})},Dt=()=>{A();const{getContent:t}=W("mortgage_step4"),o=j(l=>l.login.loginData),r=j(l=>l.mortgage);return e.jsxs(ce,{children:[e.jsx(le,{title:t("calculate_mortgage_final","calculate_mortgage_final")}),e.jsx(Ke,{cost:r.priceOfEstate,initialPayment:r.initialFee,period:r.period,nameSurname:o==null?void 0:o.nameSurname,phoneNumber:o==null?void 0:o.phoneNumber}),e.jsx(Je,{text:t("calculate_mortgage_warning","calculate_mortgage_warning")}),e.jsx(w,{children:e.jsx(Qe,{})}),e.jsx(Xe,{})]})},Lt={selectedBank:"",selectedOffer:null},Tt=Z().shape({selectedBank:u(),selectedOffer:Z().nullable()}),kt=()=>{const t=Y(),o=U();return j(r=>r.login.loginData),j(r=>r.login.isLogin),e.jsx(ae,{initialValues:Lt,validationSchema:Tt,validateOnMount:!0,onSubmit:r=>{t(B(r)),console.log("Bypassing authentication, navigating to application submitted"),o("/services/application-submitted")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx(Dt,{})}),e.jsx(he,{})]})})},Vt=()=>{A();const{getContent:t}=W("mortgage_step2"),{values:o}=ee(),r=j(l=>l.login.loginData);return e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(le,{title:t("mortgage_step2_title","Personal Details")}),e.jsxs(at,{children:[e.jsx(Pt,{}),e.jsx(z,{name:r==null?void 0:r.nameSurname,phone:r==null?void 0:r.phoneNumber})]}),e.jsxs(w,{children:[e.jsx(dt,{}),e.jsx(mt,{}),e.jsx(pt,{})]}),e.jsxs(w,{children:[e.jsxs(d,{style:{gap:"2rem"},children:[e.jsx(ut,{}),o.additionalCitizenships==="yes"&&e.jsx(xt,{})]}),e.jsxs(d,{style:{gap:"2rem"},children:[e.jsx(ht,{}),o.taxes==="yes"&&e.jsx(wt,{})]}),e.jsxs(d,{style:{gap:"2rem"},children:[e.jsx(_t,{}),o.childrens==="yes"&&e.jsx(jt,{})]})]}),e.jsx(V,{}),e.jsxs(w,{children:[e.jsx(gt,{}),e.jsx(ft,{}),e.jsx(yt,{})]}),e.jsx(V,{}),e.jsxs(w,{children:[e.jsx(st,{}),e.jsx(d,{}),e.jsx(d,{})]}),e.jsx(V,{}),e.jsxs(w,{children:[e.jsx(bt,{}),e.jsx(d,{children:o.familyStatus==="option_2"&&e.jsx(lt,{})}),e.jsx(d,{children:o.partnerPayMortgage==="yes"&&o.familyStatus==="option_2"&&e.jsx(ct,{})})]})]})})},Se=()=>Z().shape({nameSurname:u().required(i("error_name_surname","Please enter your name and surname")),birthday:u().required(i("error_date","Please enter a valid date")),education:u().required(i("error_education_required","Education is required")),additionalCitizenships:u().required(i("error_citizenship_required","Citizenship information is required")),citizenshipsDropdown:be().when("additionalCitizenships",{is:"yes",then:t=>t.min(1,i("error_citizenship_countries_required","Please select at least one citizenship country")),otherwise:t=>t.min(0)}),taxes:u().required(i("error_taxes_required","Tax payment information is required")),countriesPayTaxes:be().when("taxes",{is:"yes",then:t=>t.min(1,i("error_tax_countries_required","Please select at least one tax country")),otherwise:t=>t.min(0)}),childrens:u().required(i("error_children_required","Children information is required")),howMuchChildrens:C().required(i("error_children_count_required","Number of children is required")),medicalInsurance:u().required(i("error_medical_insurance_required","Medical insurance information is required")),isForeigner:u().required(i("error_foreigner_required","Foreigner status is required")),publicPerson:u().required(i("error_public_person_required","Public person status is required")),borrowers:C().min(1,i("error_quantity_borrowers","At least one borrower is required")).required(i("error_quantity_borrowers","Number of borrowers is required")),familyStatus:u().required(i("error_family_status_required","Family status is required")),partnerPayMortgage:u().when("familyStatus",{is:"Married",then:t=>t.required(i("error_partner_mortgage_required","Partner mortgage information is required")),otherwise:t=>t.notRequired()})});Se();const Yt=()=>{const t=Y(),o=U(),r=j(m=>m.mortgage),p={nameSurname:j(m=>m.login.loginData).nameSurname||r.nameSurname||"",birthday:r.birthday||new Date(new Date().setFullYear(new Date().getFullYear()-18)).getTime(),education:r.education||"",additionalCitizenships:r.additionalCitizenships||null,citizenshipsDropdown:r.citizenshipsDropdown||[],taxes:r.taxes||null,countriesPayTaxes:r.countriesPayTaxes||[],childrens:r.childrens||null,howMuchChildrens:r.howMuchChildrens||1,medicalInsurance:r.medicalInsurance||null,isForeigner:r.isForeigner||null,publicPerson:r.publicPerson||null,borrowers:r.borrowers||null,familyStatus:r.familyStatus||"",partnerPayMortgage:r.partnerPayMortgage||null,addPartner:r.addPartner||""};return e.jsx(ae,{initialValues:p,validationSchema:Se(),validateOnMount:!0,onSubmit:m=>{t(B(m)),o("/services/calculate-mortgage/3")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx(Vt,{})}),e.jsx(he,{})]})})},Fe=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="1"||o.includes("no_additional")||o.includes("no additional")||o.includes("none")},Rt=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o.includes("no_obligation")||o.includes("no obligation")||o.includes("none")},$t=()=>{A();const{getContent:t}=W("mortgage_step3"),o=U(),{values:r}=ee(),{mainSourceOfIncome:l,additionalIncome:p,obligation:m}=r,s=Y(),D=j(n=>n.borrowers.sourceOfIncomeModal),M=j(n=>n.borrowers.additionalIncomeModal),h=j(n=>n.borrowers.obligationModal),x=j(n=>n.otherBorrowers.otherBorrowers),b=j(n=>n.login.loginData),H=()=>{s(B(r)),s(Ae())},R=()=>{s(B(r)),s(De())},L=()=>{s(B(r)),s(Le())},P=n=>{s(Te({id:n}))},_=n=>{s(ke({id:n}))},q=n=>{s(Ve({id:n}))},f=n=>{s(Ye(n))},c=n=>{s(Re(n))},g=n=>{s($e(n))},O=n=>{s(je(n));const F=!x.some(S=>S.id===n)?me(x):n;o({pathname:"/services/other-borrowers/1/",search:xe({pageId:String(F)}).toString()})},y=()=>{s(je(me(x))),s(B(r)),o({pathname:"/services/other-borrowers/1/",search:xe({pageId:me(x).toString()}).toString()})},v=n=>{s(ze(n))};return e.jsxs(ce,{children:[e.jsx(le,{title:t("mortgage_step3_title","Income & Employment Information")}),e.jsx(z,{name:b==null?void 0:b.nameSurname,phone:b==null?void 0:b.phoneNumber}),e.jsxs(w,{children:[e.jsx(Ot,{}),(()=>{const a={employee:"employee",selfemployed:"selfemployed",pension:"pension",student:"student",unemployed:"unemployed",unpaid_leave:"unpaid_leave",other:"other",1:"employee",2:"selfemployed",3:"selfemployed",4:"pension",5:"student",6:"unemployed",7:"other",option_1:"employee",option_2:"selfemployed",option_3:"selfemployed",option_4:"pension",option_5:"student",option_6:"unemployed",option_7:"other"}[String(l)]||"";return a&&Oe[a]?Oe[a].map((F,S)=>e.jsx(ye.Fragment,{children:F},S)):null})()]}),e.jsx(w,{children:e.jsx(d,{children:l&&e.jsxs(e.Fragment,{children:[D.map(n=>e.jsx(z,{onEdit:()=>f(n.id),onDelete:()=>P(n.id),enableEdit:!0,name:`${t("source_of_income","source_of_income")}${n.id+1}`},n.id)),e.jsx(re,{onClick:H,color:"#FBE54D",value:t("add_place_to_work","add_place_to_work"),variant:"none"})]})})}),e.jsx(V,{}),e.jsxs(w,{children:[e.jsx(vt,{}),p&&!Fe(p)&&e.jsx(Ft,{}),e.jsx(d,{})]}),p&&!Fe(p)&&e.jsx(w,{children:e.jsxs(d,{children:[M.map(n=>e.jsx(z,{onEdit:()=>c(n.id),onDelete:()=>_(n.id),enableEdit:!0,name:`${t("additional_source_of_income","additional_source_of_income")}${n.id+1}`},n.id)),e.jsx(re,{onClick:R,color:"#FBE54D",value:t("add_additional_source_of_income","add_additional_source_of_income"),variant:"none"})]})}),e.jsx(V,{}),e.jsxs(w,{children:[e.jsx(St,{}),ve[m]&&ve[m].map((n,a)=>e.jsx(ye.Fragment,{children:n},a)),e.jsx(d,{})]}),m&&!Rt(m)&&e.jsx(w,{children:e.jsxs(d,{children:[h.map(n=>e.jsx(z,{onEdit:()=>g(n.id),onDelete:()=>q(n.id),enableEdit:!0,name:`${t("obligation","obligation")}${n.id+1}`},n.id)),e.jsx(re,{onClick:L,color:"#FBE54D",value:t("add_obligation","add_obligation"),variant:"none"})]})}),e.jsx(V,{}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[x&&e.jsx(we,{title:t("borrower","borrower")}),e.jsxs(w,{style:{columnGap:"2rem"},children:[x.map(n=>e.jsx(d,{children:e.jsx(z,{onEdit:()=>O(n.id),onDelete:()=>v(n.id),enableEdit:!0,name:n.nameSurname},n.id)},n.id)),!x&&e.jsx(we,{title:t("borrower","borrower")}),e.jsx(d,{children:e.jsx(re,{value:t("add_borrower","add_borrower"),onClick:y,style:{height:"3.5rem",borderRadius:"0.25rem",padding:"0",width:"13.125rem"}})}),e.jsx(d,{})]})]})]})},X=t=>{if(!t)return!1;const o=t.toLowerCase();return o.includes("unemployed")||o.includes("no_income")||o.includes("no income")||o.includes("option_5")||o.includes("option_6")||o.includes("option_4")||o==="app.mortgage.step3.main_source_income_option_5"||o==="app.mortgage.step3.main_source_income_option_6"||o==="app.mortgage.step3.main_source_income_option_4"||o==="other"||o==="unpaid_leave"||o.includes("pension")},zt=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="1"||o.includes("no_additional")||o.includes("no additional")||o.includes("none")},pe=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="no_obligations"||o.includes("no_obligation")||o.includes("no obligation")||o.includes("none")},Ut=Z().shape({mainSourceOfIncome:u().required(i("error_select_answer","Please select an answer")).test("not-empty",i("error_select_answer","Please select an answer"),t=>t!=null&&t!==""),monthlyIncome:C().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),startDate:Pe().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_date","Please enter a valid date")),otherwise:t=>t.notRequired()}),fieldOfActivity:u().when("mainSourceOfIncome",{is:t=>t!=null&&t!==""&&!X(t),then:t=>t.required(i("error_select_field_of_activity","Please select field of activity")),otherwise:t=>t.notRequired()}),profession:u().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),companyName:u().when("mainSourceOfIncome",{is:t=>!X(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),additionalIncome:u().required(i("error_select_one_of_the_options","Please select one of the options")).test("not-empty",i("error_select_one_of_the_options","Please select one of the options"),t=>t!=null&&t!==""),additionalIncomeAmount:C().when("additionalIncome",{is:t=>t!=null&&t!==""&&!zt(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),obligation:u().required(i("error_select_one_of_the_options","Please select one of the options")),bank:u().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_select_bank","Please select a bank")),otherwise:t=>t.notRequired()}),monthlyPaymentForAnotherBank:C().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),endDate:Pe().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(i("error_date","Please enter a valid date")),otherwise:t=>t.notRequired()})}),Wt=()=>{const t=Y(),o=U(),r=j(p=>p.mortgage),l={mainSourceOfIncome:r.mainSourceOfIncome||"",monthlyIncome:r.monthlyIncome||null,startDate:r.startDate||new Date().getTime(),fieldOfActivity:r.fieldOfActivity||"",profession:r.profession||"",companyName:r.companyName||"",additionalIncome:r.additionalIncome||"",additionalIncomeAmount:r.additionalIncomeAmount||null,obligation:r.obligation||"option_1",bank:r.bank||"",monthlyPaymentForAnotherBank:r.monthlyPaymentForAnotherBank||null,endDate:r.endDate||new Date().getTime(),amountIncomeCurrentYear:r.amountIncomeCurrentYear||null,noIncome:r.noIncome||new Date().getTime()};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{initialValues:l,validationSchema:Ut,validateOnMount:!0,onSubmit:p=>{t(B(p)),o("/services/calculate-mortgage/4")},children:e.jsxs(se,{children:[e.jsx(ie,{children:e.jsx($t,{})}),e.jsx(he,{})]})}),e.jsx(Ze,{}),e.jsx(et,{}),e.jsx(tt,{})]})},Ht=()=>{const{stepNumber:t}=Ie();A();const{getContent:o}=W("mortgage_calculation"),r=U(),l=j(s=>s.login.isLogin);I.useEffect(()=>{!l&&t!=="1"&&r("/services/calculate-mortgage/1")},[l,t,r]);const p=[o("mobile_step_1","mobile_step_1"),o("mobile_step_2","mobile_step_2"),o("mobile_step_3","mobile_step_3"),o("mobile_step_4","mobile_step_4")];let m;switch(t){case"1":m=e.jsx(At,{});break;case"2":m=e.jsx(Yt,{});break;case"3":m=e.jsx(Wt,{});break;case"4":m=e.jsx(kt,{});break;default:m=e.jsx(Ue,{type:"NOT_FOUND"});break}return e.jsxs(e.Fragment,{children:[t!=="4"&&e.jsx(Ee,{progress:t,data:p}),e.jsx(I.Suspense,{fallback:e.jsx(Me,{}),children:m})]})},Ir=Ht;export{Ir as CalculateMortgage};
