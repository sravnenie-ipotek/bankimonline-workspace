<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTrack Reports Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .stats-bar {
            background: #f8f9fa;
            padding: 20px 40px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            min-width: 120px;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .controls {
            padding: 30px 40px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .controls-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 600;
            color: #495057;
            min-width: 80px;
        }

        select, input {
            padding: 8px 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #007bff;
        }

        .search-box {
            flex: 1;
            max-width: 300px;
        }

        .status-filter {
            min-width: 200px;
        }

        .clear-filters {
            padding: 8px 16px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .clear-filters:hover {
            background: #545b62;
        }

        .view-toggle {
            display: flex;
            background: white;
            border-radius: 6px;
            overflow: hidden;
            border: 2px solid #dee2e6;
        }

        .view-toggle button {
            padding: 8px 16px;
            border: none;
            background: transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .view-toggle button.active {
            background: #007bff;
            color: white;
        }

        .reports-container {
            padding: 40px;
            min-height: 600px;
        }

        .reports-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 25px;
        }

        .reports-table {
            display: none;
            overflow-x: auto;
        }

        .report-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 5px solid;
        }

        .report-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        }

        .report-card.ignored {
            opacity: 0.6;
            border-left-color: #6c757d !important;
        }

        .report-card.ignored .report-header {
            background: #f1f3f4;
        }

        .report-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .report-id {
            font-size: 1.1rem;
            font-weight: bold;
            color: #495057;
            margin-bottom: 8px;
        }

        .report-title {
            font-size: 0.95rem;
            color: #6c757d;
            line-height: 1.4;
        }

        .report-body {
            padding: 20px;
        }

        .status-badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 15px;
        }

        .status-done {
            background: #d4edda;
            color: #155724;
            border-left-color: #28a745;
        }

        .status-not-done {
            background: #f8d7da;
            color: #721c24;
            border-left-color: #dc3545;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
            border-left-color: #ffc107;
        }

        .status-complete {
            background: #cce5ff;
            color: #004085;
            border-left-color: #007bff;
        }

        .status-default {
            background: #e9ecef;
            color: #495057;
            border-left-color: #6c757d;
        }

        .report-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #6c757d;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .detail-value {
            font-weight: 600;
            color: #495057;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
        }

        .quality-score {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .score-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
            color: white;
        }

        .report-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .no-results h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        th {
            background: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: top;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .controls {
                padding: 20px;
            }

            .controls-row {
                flex-direction: column;
                align-items: stretch;
            }

            .reports-container {
                padding: 20px;
            }

            .reports-grid {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                padding: 15px 20px;
            }

            .report-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>YouTrack Reports Dashboard</h1>
            <p>Comprehensive overview of project issues and implementation status</p>
            <p style="font-size: 0.9rem; margin-top: 5px; opacity: 0.9;">📁 Loading from youtrackReports/ folder with range-based files</p>
            <div id="files-loaded" style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;"></div>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-number" id="total-issues">-</div>
                <div class="stat-label">Total Issues</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="done-issues" style="color: #28a745;">-</div>
                <div class="stat-label">Completed</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="pending-issues" style="color: #ffc107;">-</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="not-done-issues" style="color: #dc3545;">-</div>
                <div class="stat-label">Not Done</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="ignored-issues" style="color: #6c757d;">-</div>
                <div class="stat-label">Ignored</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="completion-rate" style="color: #007bff;">-</div>
                <div class="stat-label">Completion Rate</div>
            </div>
        </div>

        <div class="controls">
            <div class="controls-row">
                <div class="filter-group">
                    <label for="status-filter">Status:</label>
                    <select id="status-filter" class="status-filter">
                        <option value="">All Statuses</option>
                        <option value="done">✅ Done</option>
                        <option value="❌ not done">❌ Not Done</option>
                        <option value="pending_confirmation">⏳ Pending</option>
                        <option value="IMPLEMENTATION_COMPLETE_READY_FOR_TESTING">🧪 Ready for Testing</option>
                        <option value="SEQUENTIAL_ANALYSIS_COMPLETE">📋 Analysis Complete</option>
                        <option value="substantially_complete">📋 Substantially Complete</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="search-box">Search:</label>
                    <input type="text" id="search-box" class="search-box" placeholder="Search issues, titles, or descriptions...">
                </div>

                <div class="filter-group">
                    <label for="source-filter">Source:</label>
                    <select id="source-filter">
                        <option value="">All Sources</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>

                <div class="filter-group">
                    <label for="ignore-filter">Show:</label>
                    <select id="ignore-filter">
                        <option value="">All Issues</option>
                        <option value="false">Active Issues Only</option>
                        <option value="true">Ignored Issues Only</option>
                    </select>
                </div>

                <button class="clear-filters" onclick="clearFilters()">Clear Filters</button>

                <div class="view-toggle">
                    <button id="grid-view" class="active" onclick="setView('grid')">Grid View</button>
                    <button id="table-view" onclick="setView('table')">Table View</button>
                </div>
            </div>
        </div>

        <div class="reports-container">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Loading YouTrack reports...</p>
            </div>

            <div class="reports-grid" id="reports-grid" style="display: none;"></div>
            
            <div class="reports-table" id="reports-table">
                <table>
                    <thead>
                        <tr>
                            <th>Issue ID</th>
                            <th>Title</th>
                            <th>Status</th>
                            <th>Actions</th>
                            <th>Quality Score</th>
                            <th>Last Updated</th>
                            <th>Source</th>
                            <th>Ignored</th>
                        </tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>

            <div class="no-results" id="no-results" style="display: none;">
                <h3>No reports found</h3>
                <p>Try adjusting your filters or search criteria</p>
            </div>
        </div>
    </div>

    <script>
        let allReports = [];
        let filteredReports = [];
        let currentView = 'grid';

        // Discover and load all available YouTrack JSON files from youtrackReports folder
        async function discoverFiles() {
            const potentialFiles = [
                // Files in youtrackReports folder
                'youtrackReports/youTrackReports.json',
                'youtrackReports/youTrackReports_136-200.json',
                'youtrackReports/youTrackReports_200-300.json',
                'youtrackReports/youTrackReports_300-400.json',
                'youtrackReports/youTrackReports_400-500.json',
                'youtrackReports/youTrackReports_500-600.json',
                'youtrackReports/youTrackReports_600-628.json',
                'youtrackReports/youTrackReports_LK.json',
                
                // Additional potential range files
                'youtrackReports/youTrackReports_1-100.json',
                'youtrackReports/youTrackReports_100-136.json',
                'youtrackReports/youTrackReports_628-700.json',
                'youtrackReports/youTrackReports_700-800.json',
                'youtrackReports/youTrackReports_800-900.json',
                'youtrackReports/youTrackReports_900-1000.json'
            ];

            const availableFiles = [];
            console.log('Starting file discovery...');
            
            for (const filePath of potentialFiles) {
                try {
                    console.log(`Checking ${filePath}...`);
                    const response = await fetch(`./${filePath}`);
                    if (response.ok) {
                        console.log(`✅ Found: ${filePath}`);
                        availableFiles.push(filePath);
                    } else {
                        console.log(`❌ Not found (${response.status}): ${filePath}`);
                    }
                } catch (error) {
                    console.log(`❌ Error accessing ${filePath}:`, error.message);
                }
            }
            
            console.log(`Discovery complete. Found ${availableFiles.length} files.`);
            return availableFiles;
        }

        // Load and parse JSON data
        async function loadReports() {
            try {
                document.getElementById('loading').innerHTML = `
                    <div class="spinner"></div>
                    <p>Discovering available YouTrack files...</p>
                `;

                const availableFiles = await discoverFiles();
                console.log('Discovered files:', availableFiles);

                document.getElementById('loading').innerHTML = `
                    <div class="spinner"></div>
                    <p>Loading ${availableFiles.length} YouTrack files...</p>
                `;

                const filePromises = availableFiles.map(async (filePath) => {
                    try {
                        console.log(`Loading ${filePath}...`);
                        const response = await fetch(`./${filePath}`);
                        if (response.ok) {
                            const data = await response.json();
                            const fileName = filePath.split('/').pop(); // Extract just the filename
                            console.log(`✅ Successfully loaded ${filePath}`);
                            return { data, name: fileName, fullPath: filePath };
                        } else {
                            console.error(`❌ Failed to load ${filePath}: HTTP ${response.status}`);
                        }
                        return null;
                    } catch (error) {
                        console.error(`❌ Error loading ${filePath}:`, error);
                        return null;
                    }
                });

                const results = await Promise.all(filePromises);
                const validResults = results.filter(result => result !== null);

                if (validResults.length === 0) {
                    throw new Error('No YouTrack files could be loaded. Please check the file paths and server configuration.');
                }

                // Parse reports from all loaded files
                allReports = [];
                validResults.forEach(result => {
                    const reports = Object.entries(result.data.reports || {}).map(([id, report]) => ({
                        id,
                        ...report,
                        source: result.name
                    }));
                    allReports = [...allReports, ...reports];
                });

                console.log(`Loaded ${allReports.length} reports from ${validResults.length} files:`, 
                    validResults.map(r => r.name).join(', '));
                filteredReports = [...allReports];

                // Update source filter dropdown with discovered files
                updateSourceFilter(validResults.map(r => r.name));

                // Show loaded files in header with categorization
                const mainFiles = validResults.filter(r => r.name === 'youTrackReports.json');
                const rangeFiles = validResults.filter(r => r.name.match(/\d+-\d+/));
                const otherFiles = validResults.filter(r => !mainFiles.includes(r) && !rangeFiles.includes(r));
                
                let summaryText = `📁 Successfully loaded ${validResults.length} YouTrack files`;
                if (rangeFiles.length > 0) {
                    summaryText += ` (${rangeFiles.length} range files, ${otherFiles.length} other files)`;
                }
                
                const filesList = validResults.map(r => r.name).join(', ');
                document.getElementById('files-loaded').innerHTML = 
                    `${summaryText}: ${filesList}`;

                updateStats();
                renderReports();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('reports-grid').style.display = 'grid';

            } catch (error) {
                console.error('Error loading reports:', error);
                document.getElementById('loading').innerHTML = `
                    <div style="color: #dc3545; text-align: center;">
                        <h3>Error loading reports</h3>
                        <p>Could not load files from youtrackReports folder. Expected files:</p>
                        <ul style="list-style: none; padding: 0;">
                            <li>youtrackReports/youTrackReports.json</li>
                            <li>youtrackReports/youTrackReports_136-200.json</li>
                            <li>youtrackReports/youTrackReports_200-300.json</li>
                            <li>youtrackReports/youTrackReports_300-400.json</li>
                            <li>youtrackReports/youTrackReports_500-600.json</li>
                            <li>youtrackReports/youTrackReports_600-628.json</li>
                        </ul>
                        <p style="font-size: 0.9rem; color: #6c757d;">Check console for detailed error messages.</p>
                    </div>
                `;
            }
        }

        // Update source filter dropdown with discovered files
        function updateSourceFilter(fileNames) {
            const sourceFilter = document.getElementById('source-filter');
            
            // Clear existing options except "All Sources"
            sourceFilter.innerHTML = '<option value="">All Sources</option>';
            
            // Sort files for better organization
            const sortedFiles = fileNames.sort((a, b) => {
                // Main file first
                if (a === 'youTrackReports.json') return -1;
                if (b === 'youTrackReports.json') return 1;
                
                // Range files by their start number
                const rangeA = a.match(/(\d+)-(\d+)/);
                const rangeB = b.match(/(\d+)-(\d+)/);
                
                if (rangeA && rangeB) {
                    return parseInt(rangeA[1]) - parseInt(rangeB[1]);
                }
                
                // Backup and special files at the end
                if (a.includes('backup')) return 1;
                if (b.includes('backup')) return -1;
                
                // Default alphabetical
                return a.localeCompare(b);
            });
            
            // Add discovered files
            sortedFiles.forEach(fileName => {
                const option = document.createElement('option');
                option.value = fileName;
                option.textContent = fileName;
                sourceFilter.appendChild(option);
            });
        }

        // Update statistics
        function updateStats() {
            const total = filteredReports.length;
            const done = filteredReports.filter(r => r.status === 'done' || r.status === '✅ done').length;
            const notDone = filteredReports.filter(r => r.status === '❌ not done').length;
            const pending = filteredReports.filter(r => 
                r.status === 'pending_confirmation' || 
                r.status === 'IMPLEMENTATION_COMPLETE_READY_FOR_TESTING' ||
                r.status === 'SEQUENTIAL_ANALYSIS_COMPLETE' ||
                r.status === 'substantially_complete'
            ).length;
            const ignored = filteredReports.filter(r => r.is_ignore === true).length;
            const completionRate = total > 0 ? Math.round((done / total) * 100) : 0;

            document.getElementById('total-issues').textContent = total;
            document.getElementById('done-issues').textContent = done;
            document.getElementById('not-done-issues').textContent = notDone;
            document.getElementById('pending-issues').textContent = pending;
            document.getElementById('ignored-issues').textContent = ignored;
            document.getElementById('completion-rate').textContent = completionRate + '%';
        }

        // Get status badge class
        function getStatusClass(status) {
            if (status === 'done' || status === '✅ done') return 'status-done';
            if (status === '❌ not done') return 'status-not-done';
            if (status === 'pending_confirmation') return 'status-pending';
            if (status === 'IMPLEMENTATION_COMPLETE_READY_FOR_TESTING' || 
                status === 'SEQUENTIAL_ANALYSIS_COMPLETE' ||
                status === 'substantially_complete') return 'status-complete';
            return 'status-default';
        }

        // Get quality score color
        function getScoreColor(score) {
            if (score >= 9) return '#28a745';
            if (score >= 7) return '#ffc107';
            if (score >= 5) return '#fd7e14';
            return '#dc3545';
        }

        // Format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            try {
                return new Date(dateString).toLocaleDateString();
            } catch {
                return dateString;
            }
        }

        // Render reports in grid view
        function renderGridView() {
            const container = document.getElementById('reports-grid');
            container.innerHTML = '';

            if (filteredReports.length === 0) {
                document.getElementById('no-results').style.display = 'block';
                return;
            } else {
                document.getElementById('no-results').style.display = 'none';
            }

            filteredReports.forEach(report => {
                const statusClass = getStatusClass(report.status);
                const qualityScore = report.implementation_quality?.overall_score || 
                                  report.implementation_quality?.overall || 
                                  (report.actions_completed && report.total_actions ? 
                                    Math.round((report.actions_completed / report.total_actions) * 10) : 0);
                const scoreColor = getScoreColor(qualityScore);
                const completionPercentage = report.total_actions ? 
                    Math.round(((report.actions_completed || 0) / report.total_actions) * 100) : 0;

                const card = document.createElement('div');
                card.className = `report-card ${statusClass} ${report.is_ignore === true ? 'ignored' : ''}`;
                card.innerHTML = `
                    <div class="report-header">
                        <div class="report-id">
                            ${report.id}
                            ${report.is_ignore === true ? '<span style="color: #6c757d; font-size: 0.8rem; margin-left: 8px;">🚫 IGNORED</span>' : ''}
                        </div>
                        <div class="report-title">${report.issue_title || report.title || 'No title available'}</div>
                    </div>
                    <div class="report-body">
                        <span class="status-badge ${statusClass}">${report.status || 'Unknown'}</span>
                        
                        <div class="report-details">
                            <div class="detail-item">
                                <span class="detail-label">Total Actions</span>
                                <span class="detail-value">${report.total_actions || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Completed</span>
                                <span class="detail-value">${report.actions_completed || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Analysis Date</span>
                                <span class="detail-value">${formatDate(report.analysis_date || report.last_check_date)}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Source</span>
                                <span class="detail-value" title="${report.source}">${report.source.replace('youTrackReports_', '').replace('.json', '')}</span>
                            </div>
                        </div>

                        ${report.total_actions ? `
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${completionPercentage}%"></div>
                            </div>
                        ` : ''}

                        ${qualityScore ? `
                            <div class="quality-score">
                                <div class="score-circle" style="background: ${scoreColor}">
                                    ${qualityScore}
                                </div>
                                <span>Quality Score</span>
                            </div>
                        ` : ''}

                        <div class="report-actions">
                            ${report.figma_url ? `<a href="${report.figma_url}" target="_blank" class="btn btn-primary">View Design</a>` : ''}
                            ${report.page_url ? `<a href="${report.page_url}" class="btn btn-secondary">View Page</a>` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Render reports in table view
        function renderTableView() {
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = '';

            if (filteredReports.length === 0) {
                document.getElementById('no-results').style.display = 'block';
                return;
            } else {
                document.getElementById('no-results').style.display = 'none';
            }

            filteredReports.forEach(report => {
                const statusClass = getStatusClass(report.status);
                const qualityScore = report.implementation_quality?.overall_score || 
                                  report.implementation_quality?.overall || 
                                  (report.actions_completed && report.total_actions ? 
                                    Math.round((report.actions_completed / report.total_actions) * 10) : 0);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${report.id}</strong></td>
                    <td>${(report.issue_title || report.title || 'No title available').substring(0, 60)}...</td>
                    <td><span class="status-badge ${statusClass}">${report.status || 'Unknown'}</span></td>
                    <td>${report.total_actions || 'N/A'} / ${report.actions_completed || 'N/A'}</td>
                    <td>${qualityScore || 'N/A'}</td>
                    <td>${formatDate(report.analysis_date || report.last_check_date)}</td>
                    <td>${report.source}</td>
                    <td>${report.is_ignore === true ? '🚫 Yes' : '✅ No'}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Render reports based on current view
        function renderReports() {
            if (currentView === 'grid') {
                renderGridView();
            } else {
                renderTableView();
            }
            updateStats();
        }

        // Set view mode
        function setView(view) {
            currentView = view;
            
            document.getElementById('grid-view').classList.toggle('active', view === 'grid');
            document.getElementById('table-view').classList.toggle('active', view === 'table');
            
            document.getElementById('reports-grid').style.display = view === 'grid' ? 'grid' : 'none';
            document.getElementById('reports-table').style.display = view === 'table' ? 'block' : 'none';
            
            renderReports();
        }

        // Filter reports
        function filterReports() {
            const statusFilter = document.getElementById('status-filter').value;
            const searchTerm = document.getElementById('search-box').value.toLowerCase();
            const sourceFilter = document.getElementById('source-filter').value;
            const ignoreFilter = document.getElementById('ignore-filter').value;

            filteredReports = allReports.filter(report => {
                const statusMatch = !statusFilter || report.status === statusFilter;
                const searchMatch = !searchTerm || 
                    report.id.toLowerCase().includes(searchTerm) ||
                    (report.issue_title || report.title || '').toLowerCase().includes(searchTerm) ||
                    (report.key_findings || '').toLowerCase().includes(searchTerm);
                const sourceMatch = !sourceFilter || report.source === sourceFilter;
                const ignoreMatch = !ignoreFilter || 
                    (ignoreFilter === 'true' && report.is_ignore === true) ||
                    (ignoreFilter === 'false' && (report.is_ignore === false || report.is_ignore === undefined));

                return statusMatch && searchMatch && sourceMatch && ignoreMatch;
            });

            renderReports();
        }

        // Clear all filters
        function clearFilters() {
            document.getElementById('status-filter').value = '';
            document.getElementById('search-box').value = '';
            document.getElementById('source-filter').value = '';
            document.getElementById('ignore-filter').value = '';
            filteredReports = [...allReports];
            renderReports();
        }

        // Event listeners
        document.getElementById('status-filter').addEventListener('change', filterReports);
        document.getElementById('search-box').addEventListener('input', filterReports);
        document.getElementById('source-filter').addEventListener('change', filterReports);
        document.getElementById('ignore-filter').addEventListener('change', filterReports);

        // Initialize
        loadReports();
    </script>
</body>
</html>