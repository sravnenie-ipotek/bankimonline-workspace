üìã **Dropdown Standardisation & Fix Plan (follow @dropDownsInDBLogic)**

---

## STEP-0  ‚Äì Ground Rules  (ALWAYS)
1. Never delete rows without explicit approval.
2. No `component_type = 'dropdown_option'` ‚Äì use only `option`.
3. Each dropdown set MUST contain:
   ‚Ä¢ 1√ó `dropdown`  ‚Ä¢ N√ó `option`  ‚Ä¢ 1√ó `placeholder`  ‚Ä¢ 1√ó `label`
4. All dropdown family items share:
   ‚Ä¢ same `screen_location`
   ‚Ä¢ same `category = 'form'`
5. All translations (`en`, `he`, `ru`) ‚Üí `status = 'approved'`.
6. Naming patterns ‚Üí see **dropDownsInDBLogic**.

---

## STEP-1  ‚Äì Global Validation Sweep
Run the validation queries in **dropDownsInDBLogic ‚Üí Validation Queries** for the whole DB:
   A. Duplicate `content_key`s
   B. Missing translations
   C. Draft / pending in prod
   D. Invalid `component_type`
   E. Inconsistent categories

‚òëÔ∏è  Produce CSV / markdown report `DEVHelp/reports/dropdownValidation_<date>.md`.

---

## STEP-2  ‚Äì Component Type Standardisation
1. Identify any remaining `dropdown_option` or other non-standard types.
2. Generate migration: `migrations/standardise_component_types.sql` ‚Üí update to `option`.
3. QA: Validation query confirms **0** non-standard types.

---

## STEP-3  ‚Äì Fix Orphaned Options
For every screen:
1. `option` without matching `dropdown`  ‚Üí
   ‚Ä¢ If dropdown logically exists ‚Üí add container.
   ‚Ä¢ If option belongs to another dropdown ‚Üí rename.
2. Create migration per screen family: `migrations/fix_<screen>_orphaned_options.sql`.
3. QA: Orphaned-options query returns **0** rows.

---

## STEP-4  ‚Äì Add Missing Dropdown Containers
1. `dropdown` count = 0 but options exist ‚Üí insert container.
2. Also add matching `placeholder` & `label` rows.
3. Migration file: `migrations/add_missing_dropdown_containers_<screens>.sql`.
4. QA: No dropdowns-without-options & vice-versa.

---

## STEP-5  ‚Äì Category Normalisation
1. Any dropdown family item with `category IS NULL` or != `form` ‚Üí update.
2. Migration: `migrations/fix_dropdown_categories.sql`.
3. QA: `null_categories` validation query returns **0**.

---

## STEP-6  ‚Äì Translation Completeness
1. Find items where translation_count < 3.
2. Generate multi-language insert script `migrations/add_missing_dropdown_translations.sql`.
3. QA: Missing-translations query returns **0**.

---

## STEP-7  ‚Äì Screen-Location Consistency
1. Scan for dropdown families whose keys do NOT start with their screen prefix.
2. Rename keys or screen_location to follow convention (`<feature>_<step>`).
3. Migration: `migrations/fix_screen_location_naming.sql`.
4. QA: Naming consistency script passes.

---

## STEP-8  ‚Äì Placeholder / Label Completeness
1. For each dropdown container ensure exactly 1 placeholder & 1 label.
2. Add missing ones with proper translations.
3. QA script shows 0 containers missing placeholder/label.

---

## STEP-9  ‚Äì Final Regression Suite
1. Re-run ALL validation queries.
2. Run Cypress/Playwright dropdown E2E tests.
3. Produce final report `DEVHelp/reports/dropdownFix_final_<date>.md`.

---

## STEP-10  ‚Äì Code & Docs Update
1. Update `DEVHelp/docs/dropDownsInDBLogic` if any new edge-cases discovered.
2. Tag migrations in CHANGELOG.

---

üü¢ **End State:**
‚Ä¢ 100 % dropdowns comply with @dropDownsInDBLogic.
‚Ä¢ 0 validation errors.
‚Ä¢ All languages fully translated.

---

## üîç **CURRENT STATUS (2025-01-25)**

### ‚úÖ **COMPLETED:**
- ‚úÖ **Component Type Standardisation**: 0 `dropdown_option` items found
- ‚úÖ **Null Categories**: 0 screens with null categories
- ‚úÖ **Missing Translations**: 0 screens missing translations
- ‚úÖ **Refinance Credit Screens**: All 4 screens fixed and complete

### ‚ùå **REMAINING ISSUES:**

#### **üî¥ CRITICAL: Orphaned Options (5 screens remaining)**
1. ‚úÖ **mortgage_step2**: FIXED (was 29, now 0 orphaned options)
2. ‚úÖ **tenders_for_brokers**: FIXED (was 27, now 0 orphaned options)
3. ‚úÖ **temporary_franchise**: FIXED (was 23, now 0 orphaned options)
4. ‚úÖ **mortgage_step3**: FIXED (was 23, now 0 orphaned options)
5. **refinance_step1**: 21 orphaned options ‚Üê NEXT PRIORITY
6. **tenders_for_lawyers**: 20 orphaned options
7. **cooperation**: 10 orphaned options
8. **mortgage_step4**: 4 orphaned options
9. **refinance_mortgage_2**: 2 orphaned options

#### **üî¥ CRITICAL: Empty Dropdowns (12 screens)**
1. **mortgage_calculation**: 27 empty dropdowns
2. **mortgage_step2**: 11 empty dropdowns
3. **main_page**: 7 empty dropdowns
4. **refinance_step1**: 5 empty dropdowns
5. **mortgage_step3**: 3 empty dropdowns
6. **tenders_for_brokers**: 2 empty dropdowns
7. **refinance_mortgage_2**: 2 empty dropdowns
8. **tenders_for_lawyers**: 2 empty dropdowns
9. **temporary_franchise**: 2 empty dropdowns
10. **mortgage_step1**: 2 empty dropdowns
11. **mortgage_step4**: 1 empty dropdown
12. **cooperation**: 1 empty dropdown

### üéØ **NEXT STEP:**
**Fix orphaned options in refinance_step1 (21 items)** - this is now the largest remaining issue.

### ‚úÖ **COMPLETED TODAY:**
- **mortgage_step2**: Fixed 29 orphaned options by removing duplicates and properly linking citizenship options to existing dropdowns. Removed duplicate education and family status options. Result: 13 dropdowns, 22 options, 0 orphaned.
- **tenders_for_brokers**: Fixed 27 orphaned options by renaming them to match existing dropdown containers. Result: 2 dropdowns, 27 options, 0 orphaned.
- **temporary_franchise**: Fixed 23 orphaned options by renaming them to match existing dropdown containers. Result: 2 dropdowns, 23 options, 0 orphaned.
- **mortgage_step3**: Fixed 23 orphaned options by renaming them to match existing dropdown containers. Deleted 4 sphere options with no corresponding dropdown. Result: 3 dropdowns, 19 options, 0 orphaned.

