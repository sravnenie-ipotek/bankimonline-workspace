<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="app_name">BankimOnline Admin</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/i18n.css">
    <!-- Core Scripts -->
    <script src="/js/i18n.js"></script>
    <script src="/js/role-manager.js"></script>
    <script src="/js/bank-config.js"></script>
</head>
<body class="bg-gray-50">
    <div id="app"></div>
    
    <script>
        // Environment-aware API base URL
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:8003' 
            : 'https://bankim-nodejs-api-production.up.railway.app';
        
        // Wait for i18n to be ready
        let i18nReady = false;
        
        // Function to wait for i18n initialization
        function waitForI18n() {
            return new Promise((resolve) => {
                if (window.i18n && window.i18n.translations && Object.keys(window.i18n.translations).length > 0) {
                    i18nReady = true;
                    resolve();
                } else {
                    setTimeout(() => waitForI18n().then(resolve), 100);
                }
            });
        }
        
        // Translation function - uses global i18n instance
        function t(key, params = {}) {
            if (window.i18n) {
                return window.i18n.t(key, params);
            }
            return key;
        }
        
        // Language switcher function - uses global i18n instance
        function setLanguage(lang) {
            if (window.i18n) {
                window.i18n.setLanguage(lang);
            }
        }
        
        // Re-render the current view when language changes
        function reloadCurrentView() {
            if (!isLoggedIn) {
                showLogin();
                return;
            }
            
            // Get current active section
            const activeLink = document.querySelector('.nav-link.bg-indigo-100');
            if (activeLink) {
                const text = activeLink.textContent.trim();
                // Determine which section is active and reload it
                if (text.includes('Dashboard') || text.includes('–ü–∞–Ω–µ–ª—å') || text.includes('◊ú◊ï◊ó')) {
                    showDashboard();
                } else if (text.includes('Banks') || text.includes('–ë–∞–Ω–∫–∏') || text.includes('◊ë◊†◊ß◊ô◊ù')) {
                    showBankManagement();
                } else if (text.includes('Applications') || text.includes('–ó–∞—è–≤–∫–∏') || text.includes('◊ë◊ß◊©◊ï◊™')) {
                    showApplications();
                } else if (text.includes('Standards') || text.includes('–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã') || text.includes('◊™◊ß◊†◊ô◊ù')) {
                    showBankingStandards();
                } else if (text.includes('Settings') || text.includes('–ù–∞—Å—Ç—Ä–æ–π–∫–∏') || text.includes('◊î◊í◊ì◊®◊ï◊™')) {
                    showSettings();
                } else {
                    showDashboard(); // Default to dashboard
                }
            } else {
                showDashboard(); // Default to dashboard
            }
        }

        // Language dropdown functionality
        const languageData = {
            'en': { flag: 'üá∫üá∏', name: 'English' },
            'he': { flag: 'üáÆüá±', name: '◊¢◊ë◊®◊ô◊™' },
            'ru': { flag: 'üá∑üá∫', name: '–†—É—Å—Å–∫–∏–π' }
        };

        function initializeLanguageDropdown() {
            const dropdownBtn = document.getElementById('languageDropdownBtn');
            const dropdown = document.getElementById('languageDropdown');
            
            if (!dropdownBtn || !dropdown) return;
            
            // Get current language from i18n or default to English
            const currentLang = (window.i18n && window.i18n.currentLang) || 'en';
            updateLanguageDisplay(currentLang);
            
            // Toggle dropdown
            dropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                dropdown.classList.toggle('hidden');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                if (dropdown) {
                    dropdown.classList.add('hidden');
                }
            });
            
            // Listen for language changes from i18n system
            document.addEventListener('languageChanged', function(event) {
                updateLanguageDisplay(event.detail.language);
                
                // Don't reload if this was triggered by our own changeLanguage function
                if (!window.isChangingLanguage) {
                    setTimeout(() => {
                        if (isLoggedIn) {
                            loadDashboard();
                        } else {
                            showLogin();
                        }
                    }, 100);
                }
            });
        }

        function updateLanguageDisplay(lang) {
            const flagElement = document.getElementById('currentLanguageFlag');
            const nameElement = document.getElementById('currentLanguageName');
            
            if (flagElement && nameElement && languageData[lang]) {
                flagElement.textContent = languageData[lang].flag;
                nameElement.textContent = languageData[lang].name;
            }
        }

        function changeLanguage(lang) {
            // Hide dropdown
            const dropdown = document.getElementById('languageDropdown');
            if (dropdown) {
                dropdown.classList.add('hidden');
            }
            
            // Update display
            updateLanguageDisplay(lang);
            
            // Change language using i18n system
            if (window.i18n) {
                window.i18n.setLanguage(lang);
                
                // Wait a bit for i18n to update, then reload the view
                setTimeout(() => {
                    // Re-render the entire admin layout if logged in
                    if (isLoggedIn) {
                        const currentUser = JSON.parse(localStorage.getItem('adminUser') || '{}');
                        const app = document.getElementById('app');
                        if (app && currentUser.email) {
                            // Re-render the admin dashboard with updated translations
                            loadDashboard();
                        }
                    } else {
                        // Re-render login page
                        showLogin();
                    }
                }, 100);
            }
        }
        
        // Admin Login Component
        function AdminLogin() {
            return `
                <div class="min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8">
                    <div class="sm:mx-auto sm:w-full sm:max-w-md">
                        <div class="flex justify-center">
                            <div class="text-3xl font-bold text-indigo-600">üè¶ ${t('app_name')}</div>
                        </div>
                        <h2 class="mt-6 text-center text-3xl font-extrabold text-gray-900">${t('admin_login')}</h2>
                        <p class="mt-2 text-center text-sm text-gray-600">${t('enter_credentials')}</p>
                    </div>

                    <div class="mt-8 sm:mx-auto sm:w-full sm:max-w-md">
                        <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
                            <form onsubmit="handleLogin(event)" class="space-y-6">
                                <div>
                                    <label for="email" class="block text-sm font-medium text-gray-700">${t('email')}</label>
                                    <div class="mt-1">
                                        <input id="email" name="email" type="email" required value="test@test"
                                            class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                    </div>
                                </div>

                                <div>
                                    <label for="password" class="block text-sm font-medium text-gray-700">${t('password')}</label>
                                    <div class="mt-1">
                                        <input id="password" name="password" type="password" required value="test"
                                            class="appearance-none block w-full px-3 py-2 border border-gray-300 rounded-md placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                    </div>
                                </div>

                                <div id="error" class="hidden rounded-md bg-red-50 p-4">
                                    <div class="text-sm text-red-700"></div>
                                </div>

                                <div>
                                    <button type="submit" id="loginBtn"
                                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        ${t('sign_in')}
                                    </button>
                                </div>
                            </form>

                            <div class="mt-6 p-4 bg-green-50 rounded-md">
                                <div class="text-sm text-green-700">
                                    <p class="font-medium">${t('test_credentials')}:</p>
                                    <p>${t('email')}: test@test</p>
                                    <p>${t('password')}: test</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Enhanced Admin Dashboard Component with Multi-Role UI
        function AdminDashboard(user, stats) {
            return `
                <div class="min-h-screen bg-gray-50">
                    <!-- Top Navigation -->
                    <nav class="bg-white shadow-sm border-b border-gray-200">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="flex justify-between h-16">
                                <div class="flex items-center space-x-8">
                                    <div class="text-2xl font-bold text-indigo-600">üè¶ ${t('app_name')}</div>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <!-- Language Selector -->
                                    <div class="relative">
                                        <button id="languageDropdownBtn" class="flex items-center space-x-2 bg-white border border-gray-300 rounded-lg px-3 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 shadow-sm">
                                            <span id="currentLanguageFlag">üá∫üá∏</span>
                                            <span id="currentLanguageName">English</span>
                                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                            </svg>
                                        </button>
                                        <div id="languageDropdown" class="absolute right-0 top-full mt-1 w-40 bg-white border border-gray-200 rounded-lg shadow-lg z-50 hidden">
                                            <div class="py-1">
                                                <button onclick="changeLanguage('en')" class="flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                                    <span class="mr-2">üá∫üá∏</span>
                                                    <span>English</span>
                                                </button>
                                                <button onclick="changeLanguage('he')" class="flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                                    <span class="mr-2">üáÆüá±</span>
                                                    <span>◊¢◊ë◊®◊ô◊™</span>
                                                </button>
                                                <button onclick="changeLanguage('ru')" class="flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors">
                                                    <span class="mr-2">üá∑üá∫</span>
                                                    <span>–†—É—Å—Å–∫–∏–π</span>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="text-sm text-gray-700">
                                        ${t('welcome')}, <span class="font-medium">${user.name}</span>
                                        <div class="text-xs text-gray-500">${user.role}</div>
                                    </div>
                                    <button onclick="handleLogout()"
                                        class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                        ${t('logout')}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </nav>

                    <!-- Main Tab Navigation -->
                    <div class="bg-white border-b border-gray-200">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                <button onclick="showMainTab('dashboard')" id="tab-dashboard" class="main-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    ${t('navigation.dashboard')}
                                </button>
                                <button onclick="showMainTab('bank-operations')" id="tab-bank-operations" class="main-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1a2 2 0 012 2v1a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2z"></path>
                                    </svg>
                                    ${t('navigation.bank_operations')}
                                </button>
                                <button onclick="showMainTab('user-management')" id="tab-user-management" class="main-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                    </svg>
                                    ${t('navigation.user_management')}
                                </button>
                                <button onclick="showMainTab('risk-compliance')" id="tab-risk-compliance" class="main-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                    </svg>
                                    ${t('navigation.risk_compliance')}
                                </button>
                                <button onclick="showMainTab('applications')" id="tab-applications" class="main-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    ${t('navigation.applications')}
                                </button>
                                <button onclick="showMainTab('system-settings')" id="tab-system-settings" class="main-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    ${t('navigation.system_settings')}
                                </button>
                            </nav>
                        </div>
                    </div>

                    <!-- Main Content Area -->
                    <div id="main-content" class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
                        <!-- Dynamic content will be loaded here -->
                    </div>
                </div>
            `;
        }

        // Dashboard Content Component
        function DashboardContent(stats) {
            return `
                <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-md">
                    <div class="text-green-800">
                        <h3 class="font-medium">üéâ Admin Panel Working!</h3>
                        <p class="text-sm mt-1">Phase 2 implementation in progress. Bank management is now available.</p>
                    </div>
                </div>

                <div class="mb-6">
                    <h1 class="text-3xl font-bold text-gray-900">${t('dashboard_title')}</h1>
                    <p class="mt-1 text-sm text-gray-600">${t('dashboard_subtitle')}</p>
                </div>

                <div class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4 mb-8">
                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0"><div class="text-2xl">üë•</div></div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">${t('total_clients')}</dt>
                                        <dd class="text-lg font-medium text-gray-900">${stats.totalClients}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg cursor-pointer hover:bg-gray-50" onclick="showBankManagement()">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0"><div class="text-2xl">üè¶</div></div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">${t('total_banks')}</dt>
                                        <dd class="text-lg font-medium text-gray-900">${stats.totalBanks}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg cursor-pointer hover:bg-gray-50" onclick="showApplications()">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0"><div class="text-2xl">üìã</div></div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">Applications</dt>
                                        <dd class="text-lg font-medium text-gray-900">${stats.totalApplications}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white overflow-hidden shadow rounded-lg">
                        <div class="p-5">
                            <div class="flex items-center">
                                <div class="flex-shrink-0"><div class="text-2xl">üë®‚Äçüíº</div></div>
                                <div class="ml-5 w-0 flex-1">
                                    <dl>
                                        <dt class="text-sm font-medium text-gray-500 truncate">${t('admin_users')}</dt>
                                        <dd class="text-lg font-medium text-gray-900">${stats.totalAdmins}</dd>
                                    </dl>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">${t('quick_actions')}</h3>
                        
                        <div class="grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4">
                            <button onclick="showBankManagement()" class="border border-gray-200 rounded-lg p-4 text-left hover:bg-gray-50">
                                <h4 class="font-medium text-gray-900 mb-2">üè¶ ${t('manage_banks')}</h4>
                                <p class="text-sm text-gray-600">${t('manage_banks_desc')}</p>
                            </button>
                            
                            <button onclick="showUserManagement()" class="border border-gray-200 rounded-lg p-4 text-left hover:bg-gray-50">
                                <h4 class="font-medium text-gray-900 mb-2">üë• ${t('manage_users')}</h4>
                                <p class="text-sm text-gray-600">${t('manage_users_desc')}</p>
                            </button>
                            
                            <button onclick="showApplications()" class="border border-gray-200 rounded-lg p-4 text-left hover:bg-gray-50">
                                <h4 class="font-medium text-gray-900 mb-2">üìã Manage Applications</h4>
                                <p class="text-sm text-gray-600">Review and approve customer loan applications</p>
                            </button>
                            
                            <button onclick="showCalculations()" class="border border-gray-200 rounded-lg p-4 text-left hover:bg-gray-50">
                                <h4 class="font-medium text-gray-900 mb-2">üßÆ ${t('calculations')}</h4>
                                <p class="text-sm text-gray-600">${t('calculation_management_subtitle')}</p>
                            </button>
                        </div>

                        <div class="mt-6 p-4 bg-blue-50 rounded-md">
                            <div class="text-sm text-blue-700">
                                <p class="font-medium">üéØ Phase 2 Status: IN PROGRESS</p>
                                <p class="mt-1">Bank management system is now available. Click "Manage Banks" above to start managing bank information.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Bank Management Component
        function BankManagementContent(banks = []) {
            return `
                <div class="mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">Bank Management</h1>
                            <p class="mt-1 text-sm text-gray-600">Manage bank information and settings</p>
                        </div>
                        <button onclick="showAddBankModal()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            Add New Bank
                        </button>
                    </div>
                </div>

                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bank Name (EN)</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hebrew Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Priority</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Website</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${banks.map(bank => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${bank.name_en || 'N/A'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${bank.name_he || 'N/A'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${bank.priority || 1}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                ${bank.url ? `<a href="${bank.url}" target="_blank" class="text-indigo-600 hover:text-indigo-900">Visit</a>` : 'N/A'}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="editBank(${bank.id})" class="text-indigo-600 hover:text-indigo-900 mr-4">Edit</button>
                                                <button onclick="deleteBank(${bank.id})" class="text-red-600 hover:text-red-900">Delete</button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                    ${banks.length === 0 ? '<tr><td colspan="5" class="px-6 py-4 text-center text-gray-500">No banks found. Click "Add New Bank" to get started.</td></tr>' : ''}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Add/Edit Bank Modal -->
                <div id="bankModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <h3 class="text-lg font-medium text-gray-900 mb-4" id="modalTitle">Add New Bank</h3>
                            <form id="bankForm" onsubmit="handleBankSubmit(event)">
                                <input type="hidden" id="bankId" name="id">
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Bank Name (English) *</label>
                                    <input type="text" id="bankNameEn" name="name_en" required 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Bank Name (Hebrew)</label>
                                    <input type="text" id="bankNameHe" name="name_he"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Bank Name (Russian)</label>
                                    <input type="text" id="bankNameRu" name="name_ru"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Website URL</label>
                                    <input type="url" id="bankUrl" name="url"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                                    <input type="number" id="bankPriority" name="priority" min="1" max="100" value="1"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="flex justify-end space-x-3">
                                    <button type="button" onclick="closeBankModal()"
                                            class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md text-sm font-medium">
                                        Cancel
                                    </button>
                                    <button type="submit"
                                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                        Save Bank
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
        }

        // Applications Management Component
        function ApplicationsManagementContent(data = {}) {
            const applications = data.applications || [];
            const statusCounts = data.status_counts || {};
            const statusColors = {
                'draft': 'bg-gray-100 text-gray-800',
                'submitted': 'bg-blue-100 text-blue-800',
                'under_review': 'bg-yellow-100 text-yellow-800',
                'approved': 'bg-green-100 text-green-800',
                'rejected': 'bg-red-100 text-red-800',
                'cancelled': 'bg-gray-100 text-gray-800'
            };

            const loanTypeLabels = {
                'mortgage': 'üè† Mortgage',
                'credit': 'üí≥ Credit',
                'refinance_mortgage': 'üîÑ Mortgage Refinance',
                'refinance_credit': 'üîÑ Credit Refinance',
                'personal_loan': 'üë§ Personal Loan'
            };

            return `
                <div class="mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">üìã Loan Applications</h1>
                            <p class="mt-1 text-sm text-gray-600">Review and manage customer loan applications</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="refreshApplications()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                üîÑ Refresh
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-white shadow rounded-lg mb-6">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                                <select id="statusFilter" onchange="filterApplications()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">All Statuses</option>
                                    <option value="submitted">Submitted</option>
                                    <option value="under_review">Under Review</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Loan Type</label>
                                <select id="loanTypeFilter" onchange="filterApplications()" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="">All Types</option>
                                    <option value="mortgage">Mortgage</option>
                                    <option value="credit">Credit</option>
                                    <option value="refinance_mortgage">Mortgage Refinance</option>
                                    <option value="refinance_credit">Credit Refinance</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Search</label>
                                <input type="text" id="applicationSearch" placeholder="Search by name, email, or application number..." 
                                       onkeypress="handleApplicationSearch(event)"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="flex items-end">
                                <button onclick="filterApplications()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Apply Filters
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Applications Table -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Application</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Customer</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Submitted</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${applications.map(app => `
                                        <tr class="hover:bg-gray-50">
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">APP-${app.id}</div>
                                                <div class="text-sm text-gray-500">${app.bank_name}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">${app.client_name}</div>
                                                <div class="text-sm text-gray-500">${app.email || 'N/A'}</div>
                                                <div class="text-sm text-gray-500">${app.phone || 'N/A'}</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="text-sm text-gray-900">${loanTypeLabels[app.loan_type] || app.loan_type}</span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <div class="text-sm font-medium text-gray-900">‚Ç™${(app.loan_amount || 0).toLocaleString()}</div>
                                                <div class="text-sm text-gray-500">${app.interest_rate}% - ${app.term_months} months</div>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusColors[app.status] || 'bg-gray-100 text-gray-800'}">
                                                    ${app.status?.replace('_', ' ') || 'Unknown'}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                ${app.created_at ? new Date(app.created_at).toLocaleDateString() : 'N/A'}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="viewApplication(${app.id})" class="text-indigo-600 hover:text-indigo-900 mr-3">View</button>
                                                ${['pending_review', 'under_review', 'documentation_required', 'documents_verified', 'final_approval'].includes(app.status) ? 
                                                    `<button onclick="showUpdateStatusModal(${app.id}, '${app.status}')" class="text-green-600 hover:text-green-900 mr-3">Update</button>` : 
                                                    ''
                                                }
                                            </td>
                                        </tr>
                                    `).join('')}
                                    ${applications.length === 0 ? '<tr><td colspan="7" class="px-6 py-4 text-center text-gray-500">No applications found.</td></tr>' : ''}
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        ${pagination.totalPages > 1 ? `
                            <div class="flex items-center justify-between border-t border-gray-200 bg-white px-4 py-3 sm:px-6 mt-4">
                                <div class="flex flex-1 justify-between sm:hidden">
                                    <button onclick="loadApplicationsPage(${pagination.page - 1})" 
                                            ${!pagination.hasPrev ? 'disabled' : ''}
                                            class="relative inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">
                                        Previous
                                    </button>
                                    <button onclick="loadApplicationsPage(${pagination.page + 1})" 
                                            ${!pagination.hasNext ? 'disabled' : ''}
                                            class="relative ml-3 inline-flex items-center rounded-md border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50">
                                        Next
                                    </button>
                                </div>
                                <div class="hidden sm:flex sm:flex-1 sm:items-center sm:justify-between">
                                    <div>
                                        <p class="text-sm text-gray-700">
                                            Showing page <span class="font-medium">${pagination.page}</span> of <span class="font-medium">${pagination.totalPages}</span>
                                            (${pagination.total} total applications)
                                        </p>
                                    </div>
                                    <div>
                                        <nav class="isolate inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination">
                                            <button onclick="loadApplicationsPage(${pagination.page - 1})" 
                                                    ${!pagination.hasPrev ? 'disabled' : ''}
                                                    class="relative inline-flex items-center rounded-l-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                                                Previous
                                            </button>
                                            <button onclick="loadApplicationsPage(${pagination.page + 1})" 
                                                    ${!pagination.hasNext ? 'disabled' : ''}
                                                    class="relative inline-flex items-center rounded-r-md px-2 py-2 text-gray-400 ring-1 ring-inset ring-gray-300 hover:bg-gray-50 focus:z-20 focus:outline-offset-0">
                                                Next
                                            </button>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                </div>

                <!-- Status Summary -->
                ${Object.keys(statusCounts).length > 0 ? `
                    <div class="mt-6 bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">Status Summary</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                ${Object.entries(statusCounts).map(([status, count]) => `
                                    <div class="bg-gray-50 p-3 rounded">
                                        <div class="text-sm font-medium text-gray-600">${status.replace(/_/g, ' ').toUpperCase()}</div>
                                        <div class="text-2xl font-semibold text-gray-900">${count}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                ` : ''}

                <!-- Application Detail Modal -->
                <div id="applicationModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                    <div class="relative top-10 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-medium text-gray-900" id="applicationModalTitle">Application Details</h3>
                                <button onclick="closeApplicationModal()" class="text-gray-400 hover:text-gray-600">
                                    <span class="sr-only">Close</span>
                                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                    </svg>
                                </button>
                            </div>
                            <div id="applicationDetails" class="max-h-96 overflow-y-auto">
                                <!-- Application details will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Enhanced Calculation Management Component
        function CalculationManagementContent(params = {}) {
            return `
                <div class="mb-6">
                    <h1 class="text-3xl font-bold text-gray-900">üßÆ ${t('calculation_management')}</h1>
                    <p class="mt-1 text-sm text-gray-600">${t('calculation_management_subtitle')}</p>
                    <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-md">
                        <div class="text-blue-800">
                            <h3 class="font-medium">üéØ Phase 1 Enhancement: Real Banking Approval Logic</h3>
                            <p class="text-sm mt-1">Now includes LTV/DTI calculations, credit scoring, age verification, and stress testing!</p>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Calculators -->
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                    <!-- Enhanced Mortgage Calculator -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">üè† ${t('enhanced_mortgage_calculation')}</h3>
                            <form id="enhancedMortgageForm" onsubmit="testEnhancedMortgageCalculation(event)">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('loan_amount')}</label>
                                        <input type="number" id="enhMortgageAmount" value="1000000" min="50000" max="5000000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('property_value')}</label>
                                        <input type="number" id="enhMortgagePropertyValue" value="1300000" min="100000" max="10000000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('interest_rate')}</label>
                                        <input type="number" id="enhMortgageRate" value="3.5" min="2.5" max="8.0" step="0.1"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('loan_term_years')}</label>
                                        <input type="number" id="enhMortgageYears" value="25" min="1" max="30"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('down_payment')}</label>
                                        <input type="number" id="enhMortgageDown" value="200000" min="0"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('monthly_income')}</label>
                                        <input type="number" id="enhMortgageIncome" value="20000" min="5000" max="100000"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('monthly_expenses')}</label>
                                        <input type="number" id="enhMortgageExpenses" value="5000" min="0" max="50000"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('age')}</label>
                                        <input type="number" id="enhMortgageAge" value="35" min="18" max="75"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('credit_score')}</label>
                                        <input type="number" id="enhMortgageCreditScore" value="750" min="300" max="850"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('employment_years')}</label>
                                        <input type="number" id="enhMortgageEmployment" value="5" min="0" max="50"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                <button type="submit" class="mt-4 w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    ${t('calculate_enhanced')}
                                </button>
                            </form>
                            <div id="enhancedMortgageResult" class="mt-4 hidden"></div>
                        </div>
                    </div>

                    <!-- Enhanced Credit Calculator -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">üí≥ ${t('enhanced_credit_calculation')}</h3>
                            <form id="enhancedCreditForm" onsubmit="testEnhancedCreditCalculation(event)">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('loan_amount')}</label>
                                        <input type="number" id="enhCreditAmount" value="500000" min="50000" max="3000000"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('interest_rate')}</label>
                                        <input type="number" id="enhCreditRate" value="8.5" min="5.0" max="15.0" step="0.1"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('loan_term_years')}</label>
                                        <input type="number" id="enhCreditYears" value="5" min="1" max="15"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('monthly_income')}</label>
                                        <input type="number" id="enhCreditIncome" value="20000" min="5000" max="100000"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('monthly_expenses')}</label>
                                        <input type="number" id="enhCreditExpenses" value="5000" min="0" max="50000"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('existing_debts')}</label>
                                        <input type="number" id="enhCreditDebts" value="2000" min="0" max="30000"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('age')}</label>
                                        <input type="number" id="enhCreditAge" value="35" min="18" max="70"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('credit_score')}</label>
                                        <input type="number" id="enhCreditCreditScore" value="720" min="300" max="850"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('employment_years')}</label>
                                        <input type="number" id="enhCreditEmployment" value="5" min="0" max="50"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                <button type="submit" class="mt-4 w-full bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    ${t('calculate_enhanced')}
                                </button>
                            </form>
                            <div id="enhancedCreditResult" class="mt-4 hidden"></div>
                        </div>
                    </div>
                </div>

                <!-- Enhanced Refinance Calculators -->
                <div class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-6">
                    <!-- Enhanced Mortgage Refinance Calculator -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">üè†üîÑ Enhanced Mortgage Refinance</h3>
                            <form id="enhancedMortgageRefinanceForm" onsubmit="testEnhancedMortgageRefinanceCalculation(event)">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Current Loan Amount</label>
                                        <input type="number" id="enhMortRefCurrentAmount" value="800000" min="50000" max="5000000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Current Rate (%)</label>
                                        <input type="number" id="enhMortRefCurrentRate" value="4.5" min="2.5" max="8.0" step="0.1" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Current Monthly Payment</label>
                                        <input type="number" id="enhMortRefCurrentPayment" value="5500" min="1000" max="20000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Remaining Years</label>
                                        <input type="number" id="enhMortRefRemainingYears" value="20" min="1" max="30" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('property_value')}</label>
                                        <input type="number" id="enhMortRefPropertyValue" value="1200000" min="100000" max="10000000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">New Loan Amount</label>
                                        <input type="number" id="enhMortRefNewAmount" value="800000" min="50000" max="5000000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">New Rate (%)</label>
                                        <input type="number" id="enhMortRefNewRate" value="3.2" min="2.5" max="8.0" step="0.1" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">New Term (years)</label>
                                        <input type="number" id="enhMortRefNewYears" value="25" min="1" max="30" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('monthly_income')}</label>
                                        <input type="number" id="enhMortRefIncome" value="20000" min="5000" max="100000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('monthly_expenses')}</label>
                                        <input type="number" id="enhMortRefExpenses" value="5000" min="0" max="50000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('age')}</label>
                                        <input type="number" id="enhMortRefAge" value="40" min="18" max="75" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('credit_score')}</label>
                                        <input type="number" id="enhMortRefCreditScore" value="750" min="300" max="850" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('employment_years')}</label>
                                        <input type="number" id="enhMortRefEmployment" value="8" min="0" max="50" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Closing Costs</label>
                                        <input type="number" id="enhMortRefClosingCosts" value="5000" min="0" max="20000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Refinance Type</label>
                                        <select id="enhMortRefType" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="rate_and_term">Rate and Term</option>
                                            <option value="cash_out">Cash-Out</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Calculate Mortgage Refinance
                                </button>
                            </form>
                            <div id="enhancedMortgageRefinanceResult" class="mt-4 hidden"></div>
                        </div>
                    </div>

                    <!-- Enhanced Credit Refinance Calculator -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">üí≥üîÑ Enhanced Credit Refinance</h3>
                            <form id="enhancedCreditRefinanceForm" onsubmit="testEnhancedCreditRefinanceCalculation(event)">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Consolidation Amount</label>
                                        <input type="number" id="enhCredRefConsolidationAmount" value="600000" min="50000" max="3000000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">New Rate (%)</label>
                                        <input type="number" id="enhCredRefNewRate" value="7.5" min="5.0" max="15.0" step="0.1" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">New Term (years)</label>
                                        <input type="number" id="enhCredRefNewYears" value="7" min="1" max="15" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('monthly_income')}</label>
                                        <input type="number" id="enhCredRefIncome" value="25000" min="5000" max="100000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('monthly_expenses')}</label>
                                        <input type="number" id="enhCredRefExpenses" value="6000" min="0" max="50000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('age')}</label>
                                        <input type="number" id="enhCredRefAge" value="38" min="18" max="70" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('credit_score')}</label>
                                        <input type="number" id="enhCredRefCreditScore" value="720" min="300" max="850" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('employment_years')}</label>
                                        <input type="number" id="enhCredRefEmployment" value="6" min="0" max="50" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div class="col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Refinance Purpose</label>
                                        <select id="enhCredRefPurpose" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                            <option value="consolidation">Debt Consolidation</option>
                                            <option value="rate_reduction">Rate Reduction</option>
                                            <option value="payment_reduction">Payment Reduction</option>
                                        </select>
                                    </div>
                                </div>
                                <button type="submit" class="mt-4 w-full bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    Calculate Credit Refinance
                                </button>
                            </form>
                            <div id="enhancedCreditRefinanceResult" class="mt-4 hidden"></div>
                        </div>
                    </div>
                </div>

                <!-- Basic Calculators (Legacy) -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    <!-- Basic Mortgage Calculator -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">üè† ${t('test_mortgage_calculation')}</h3>
                            <form id="mortgageForm" onsubmit="testMortgageCalculation(event)">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('loan_amount')}</label>
                                        <input type="number" id="mortgageAmount" value="1000000" min="50000" max="5000000" 
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('interest_rate')}</label>
                                        <input type="number" id="mortgageRate" value="3.5" min="2.5" max="8.0" step="0.1"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('loan_term_years')}</label>
                                        <input type="number" id="mortgageYears" value="20" min="1" max="30"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('down_payment')}</label>
                                        <input type="number" id="mortgageDown" value="200000" min="0"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                <button type="submit" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    ${t('calculate_mortgage')}
                                </button>
                            </form>
                            <div id="mortgageResult" class="mt-4 hidden p-4 bg-green-50 rounded-md">
                                <h4 class="font-medium text-green-800">${t('calculation_result')}</h4>
                                <div class="text-sm text-green-700 mt-2 space-y-1">
                                    <div>${t('principal')}: <span id="mortgagePrincipal"></span></div>
                                    <div>${t('monthly_payment')}: <span id="mortgageMonthly"></span></div>
                                    <div>${t('total_payment')}: <span id="mortgageTotal"></span></div>
                                    <div>${t('total_interest')}: <span id="mortgageInterest"></span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Basic Credit Calculator -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">üí≥ ${t('test_credit_calculation')}</h3>
                            <form id="creditForm" onsubmit="testCreditCalculation(event)">
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('loan_amount')}</label>
                                        <input type="number" id="creditAmount" value="500000" min="50000" max="5000000"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('interest_rate')}</label>
                                        <input type="number" id="creditRate" value="8.5" min="5.0" max="15.0" step="0.1"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                    <div class="col-span-2">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">${t('loan_term_years')}</label>
                                        <input type="number" id="creditYears" value="5" min="1" max="30"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                    </div>
                                </div>
                                <button type="submit" class="mt-4 w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                    ${t('calculate_credit')}
                                </button>
                            </form>
                            <div id="creditResult" class="mt-4 hidden p-4 bg-green-50 rounded-md">
                                <h4 class="font-medium text-green-800">${t('calculation_result')}</h4>
                                <div class="text-sm text-green-700 mt-2 space-y-1">
                                    <div>${t('principal')}: <span id="creditPrincipal"></span></div>
                                    <div>${t('monthly_payment')}: <span id="creditMonthly"></span></div>
                                    <div>${t('total_payment')}: <span id="creditTotal"></span></div>
                                    <div>${t('total_interest')}: <span id="creditInterest"></span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Parameter Management -->
                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">‚öôÔ∏è ${t('calculation_parameters')}</h3>
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 text-sm">
                            <div class="p-3 bg-gray-50 rounded">
                                <div class="font-medium">${t('mortgage_rate_range')}</div>
                                <div class="text-gray-600">${params.calc_mortgage_min_rate}% - ${params.calc_mortgage_max_rate}%</div>
                                <div class="text-gray-600">${t('default')}: ${params.calc_mortgage_default_rate}%</div>
                            </div>
                            <div class="p-3 bg-gray-50 rounded">
                                <div class="font-medium">${t('credit_rate_range')}</div>
                                <div class="text-gray-600">${params.calc_credit_min_rate}% - ${params.calc_credit_max_rate}%</div>
                                <div class="text-gray-600">${t('default')}: ${params.calc_credit_default_rate}%</div>
                            </div>
                            <div class="p-3 bg-gray-50 rounded">
                                <div class="font-medium">${t('loan_amount_range')}</div>
                                <div class="text-gray-600">${params.calc_min_loan_amount?.toLocaleString()} - ${params.calc_max_loan_amount?.toLocaleString()}</div>
                            </div>
                            <div class="p-3 bg-gray-50 rounded">
                                <div class="font-medium">${t('term_range')}</div>
                                <div class="text-gray-600">${params.calc_min_term_years} - ${params.calc_max_term_years} ${t('years')}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // User Management Component
        function UserManagementContent(users = [], pagination = {}) {
            return `
                <div class="mb-6">
                    <div class="flex justify-between items-center">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
                            <p class="mt-1 text-sm text-gray-600">–ü—Ä–æ—Å–º–æ—Ç—Ä –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</p>
                        </div>
                        <div class="flex space-x-4">
                            <input type="text" id="userSearch" placeholder="–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π..." 
                                   class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                                   onkeyup="handleUserSearch(event)">
                            <button onclick="refreshUsers()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md text-sm font-medium">
                                –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>

                <div class="bg-white shadow rounded-lg">
                    <div class="px-4 py-5 sm:p-6">
                        <div class="flex justify-between items-center mb-4">
                            <p class="text-sm text-gray-600">
                                –í—Å–µ–≥–æ: ${pagination.total || 0} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | 
                                –°—Ç—Ä–∞–Ω–∏—Ü–∞ ${pagination.page || 1} –∏–∑ ${pagination.totalPages || 1}
                            </p>
                            <div class="flex space-x-2">
                                ${pagination.hasPrev ? `<button onclick="loadUsersPage(${pagination.page - 1})" class="px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>` : ''}
                                ${pagination.hasNext ? `<button onclick="loadUsersPage(${pagination.page + 1})" class="px-3 py-1 bg-indigo-600 text-white rounded text-sm hover:bg-indigo-700">–°–ª–µ–¥—É—é—â–∞—è</button>` : ''}
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–ò–º—è</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–¢–µ–ª–µ—Ñ–æ–Ω</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–†–æ–ª—å</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    ${users.map(user => `
                                        <tr>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                                                ${user.first_name} ${user.last_name}
                                                ${user.is_staff ? '<span class="ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">–ê–¥–º–∏–Ω</span>' : ''}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.email}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${user.phone || 'N/A'}</td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}">
                                                    ${user.role}
                                                </span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                ${new Date(user.created_at).toLocaleDateString('ru-RU')}
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <button onclick="editUser(${user.id})" class="text-indigo-600 hover:text-indigo-900 mr-4">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                                ${!user.is_staff && user.role !== 'admin' ? `<button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-900">–£–¥–∞–ª–∏—Ç—å</button>` : '<span class="text-gray-400">–ó–∞—â–∏—â–µ–Ω</span>'}
                                            </td>
                                        </tr>
                                    `).join('')}
                                    ${users.length === 0 ? '<tr><td colspan="6" class="px-6 py-4 text-center text-gray-500">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</td></tr>' : ''}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Edit User Modal -->
                <div id="userModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                        <div class="mt-3">
                            <h3 class="text-lg font-medium text-gray-900 mb-4" id="userModalTitle">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
                            <form id="userForm" onsubmit="handleUserSubmit(event)">
                                <input type="hidden" id="userId" name="id">
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–ò–º—è *</label>
                                    <input type="text" id="userFirstName" name="first_name" required 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–§–∞–º–∏–ª–∏—è *</label>
                                    <input type="text" id="userLastName" name="last_name" required 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email *</label>
                                    <input type="email" id="userEmail" name="email" required 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                    <input type="tel" id="userPhone" name="phone" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                </div>
                                
                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">–†–æ–ª—å</label>
                                    <select id="userRole" name="role" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                                        <option value="client">–ö–ª–∏–µ–Ω—Ç</option>
                                        <option value="customer">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</option>
                                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                                    </select>
                                </div>
                                
                                <div class="flex justify-end space-x-3">
                                    <button type="button" onclick="closeUserModal()"
                                            class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md text-sm font-medium">
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                    <button type="submit"
                                            class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;
        }

        // State management
        let currentUser = null;
        let isLoggedIn = false;
        let currentStats = { totalClients: 0, totalBanks: 0, totalApplications: 0, totalAdmins: 0 };

        // Check if user is logged in
        function checkAuth() {
            const token = localStorage.getItem('adminToken');
            if (token) {
                loadDashboard();
            } else {
                showLogin();
            }
        }

        // Show login form
        function showLogin() {
            document.getElementById('app').innerHTML = AdminLogin();
        }

        // Handle login
        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('loginBtn');
            const errorDiv = document.getElementById('error');

            btn.textContent = 'Signing in...';
            btn.disabled = true;
            errorDiv.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE}/api/admin/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('adminToken', data.data.token);
                    currentUser = data.data.admin;
                    isLoggedIn = true;
                    loadDashboard();
                } else {
                    errorDiv.querySelector('div').textContent = data.message || 'Login failed';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                errorDiv.querySelector('div').textContent = 'Network error occurred';
                errorDiv.classList.remove('hidden');
            } finally {
                btn.textContent = 'Sign in';
                btn.disabled = false;
            }
        }

        // Load dashboard
        async function loadDashboard() {
            const token = localStorage.getItem('adminToken');
            
            try {
                // Get user profile
                const profileResponse = await fetch(`${API_BASE}/api/admin/profile`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (profileResponse.ok) {
                    const profileData = await profileResponse.json();
                    currentUser = profileData.data.admin;
                }

                // Get stats
                const statsResponse = await fetch(`${API_BASE}/api/admin/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                let stats = { totalClients: 0, totalBanks: 0, totalApplications: 0, totalAdmins: 0 };
                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    stats = statsData.data;
                }

                document.getElementById('app').innerHTML = AdminDashboard(currentUser, stats);
                currentStats = stats;
                isLoggedIn = true;
                
                // Initialize the dashboard tab as active and load content
                setTimeout(() => {
                    initializeLanguageDropdown();
                    showMainTab('dashboard');
                }, 100);
            } catch (error) {
                console.error('Error loading dashboard:', error);
                handleLogout();
            }
        }

        // Handle logout
        function handleLogout() {
            localStorage.removeItem('adminToken');
            currentUser = null;
            isLoggedIn = false;
            showLogin();
        }

        // Handle URL routing
        function handleRoute() {
            const path = window.location.pathname;
            if (path.startsWith('/admin')) {
                if (path === '/admin/login' || !localStorage.getItem('adminToken')) {
                    showLogin();
                } else {
                    checkAuth();
                }
            } else {
                checkAuth();
            }
        }

        // Initialize app
        window.addEventListener('load', handleRoute);
        window.addEventListener('popstate', handleRoute);

        // Navigation functions
        function updateNavigation(activeSection) {
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.classList.remove('bg-indigo-100', 'text-indigo-700');
                link.classList.add('text-gray-700');
            });
            
            // Highlight active section (simple approach)
            navLinks.forEach(link => {
                if ((activeSection === 'dashboard' && link.textContent === t('dashboard')) ||
                    (activeSection === 'banks' && link.textContent === t('banks')) ||
                    (activeSection === 'users' && link.textContent === t('users')) ||
                    (activeSection === 'applications' && link.textContent === 'Applications') ||
                    (activeSection === 'calculations' && link.textContent === t('calculations')) ||
                    (activeSection === 'settings' && link.textContent === t('settings'))) {
                    link.classList.add('bg-indigo-100', 'text-indigo-700');
                    link.classList.remove('text-gray-700');
                }
            });
        }

        async function showDashboard() {
            const token = localStorage.getItem('adminToken');
            
            try {
                const statsResponse = await fetch(`${API_BASE}/api/admin/stats`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                let stats = { totalClients: 0, totalBanks: 0, totalApplications: 0, totalAdmins: 0 };
                if (statsResponse.ok) {
                    const statsData = await statsResponse.json();
                    stats = statsData.data;
                }

                document.getElementById('main-content').innerHTML = DashboardContent(stats);
                updateNavigation('dashboard');
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        async function showBankManagement() {
            const token = localStorage.getItem('adminToken');
            
            document.getElementById('main-content').innerHTML = '<div class="flex justify-center items-center h-64"><div class="text-gray-500">Loading banks...</div></div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/banks`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('main-content').innerHTML = BankManagementContent(data.data);
                    updateNavigation('banks');
                } else {
                    document.getElementById('main-content').innerHTML = '<div class="text-red-500 text-center">Error loading banks</div>';
                }
            } catch (error) {
                console.error('Error loading banks:', error);
                document.getElementById('main-content').innerHTML = '<div class="text-red-500 text-center">Network error loading banks</div>';
            }
        }

        async function showUserManagement(page = 1, search = '') {
            const token = localStorage.getItem('adminToken');
            
            document.getElementById('main-content').innerHTML = '<div class="flex justify-center items-center h-64"><div class="text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...</div></div>';
            
            try {
                const queryParams = new URLSearchParams({
                    page: page,
                    limit: 20
                });
                
                if (search) {
                    queryParams.append('search', search);
                }
                
                const response = await fetch(`${API_BASE}/api/admin/users?${queryParams}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('main-content').innerHTML = UserManagementContent(data.data.users, data.data.pagination);
                    updateNavigation('users');
                } else {
                    document.getElementById('main-content').innerHTML = '<div class="text-red-500 text-center">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('main-content').innerHTML = '<div class="text-red-500 text-center">–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</div>';
            }
        }

        // User Management Helper Functions
        function loadUsersPage(page) {
            const search = document.getElementById('userSearch')?.value || '';
            showUserManagement(page, search);
        }

        function refreshUsers() {
            const search = document.getElementById('userSearch')?.value || '';
            showUserManagement(1, search);
        }

        function handleUserSearch(event) {
            if (event.key === 'Enter') {
                showUserManagement(1, event.target.value);
            }
        }

        function closeUserModal() {
            document.getElementById('userModal').classList.add('hidden');
        }

        async function editUser(userId) {
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/users/${userId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const user = data.data;
                    
                    document.getElementById('userModalTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è';
                    document.getElementById('userId').value = user.id;
                    document.getElementById('userFirstName').value = user.first_name || '';
                    document.getElementById('userLastName').value = user.last_name || '';
                    document.getElementById('userEmail').value = user.email || '';
                    document.getElementById('userPhone').value = user.phone || '';
                    document.getElementById('userRole').value = user.role || 'client';
                    
                    document.getElementById('userModal').classList.remove('hidden');
                } else {
                    alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
                }
            } catch (error) {
                console.error('Error loading user:', error);
                alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
        }

        async function deleteUser(userId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) {
                return;
            }

            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/users/${userId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω');
                    refreshUsers(); // Reload the list
                } else {
                    const data = await response.json();
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
        }

        async function handleUserSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const userData = {
                first_name: formData.get('first_name'),
                last_name: formData.get('last_name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                role: formData.get('role'),
                is_staff: formData.get('role') === 'admin'
            };

            const userId = formData.get('id');
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/users/${userId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(userData)
                });

                if (response.ok) {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω');
                    closeUserModal();
                    refreshUsers(); // Reload the list
                } else {
                    const data = await response.json();
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ' + (data.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'));
                }
            } catch (error) {
                console.error('Error saving user:', error);
                alert('–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
            }
        }

        async function showApplications(page = 1, status = '', loanType = '', search = '') {
            document.getElementById('main-content').innerHTML = '<div class="flex justify-center items-center h-64"><div class="text-gray-500">Loading applications...</div></div>';
            
            try {
                const queryParams = new URLSearchParams();
                
                if (status) queryParams.append('status', status);
                if (loanType) queryParams.append('bank_id', loanType);
                if (search) queryParams.append('search', search);
                queryParams.append('limit', '50');
                queryParams.append('offset', (page - 1) * 50);
                
                const response = await fetch(`${API_BASE}/api/admin/applications?${queryParams}`);

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('main-content').innerHTML = ApplicationsManagementContent(data.data);
                    updateNavigation('applications');
                } else {
                    document.getElementById('main-content').innerHTML = '<div class="text-red-500 text-center">Error loading applications</div>';
                }
            } catch (error) {
                console.error('Error loading applications:', error);
                document.getElementById('main-content').innerHTML = '<div class="text-red-500 text-center">Network error loading applications</div>';
            }
        }

        // Applications Management Helper Functions
        function loadApplicationsPage(page) {
            const status = document.getElementById('statusFilter')?.value || '';
            const loanType = document.getElementById('loanTypeFilter')?.value || '';
            const search = document.getElementById('applicationSearch')?.value || '';
            showApplications(page, status, loanType, search);
        }

        function refreshApplications() {
            const status = document.getElementById('statusFilter')?.value || '';
            const loanType = document.getElementById('loanTypeFilter')?.value || '';
            const search = document.getElementById('applicationSearch')?.value || '';
            showApplications(1, status, loanType, search);
        }

        function filterApplications() {
            const status = document.getElementById('statusFilter')?.value || '';
            const loanType = document.getElementById('loanTypeFilter')?.value || '';
            const search = document.getElementById('applicationSearch')?.value || '';
            showApplications(1, status, loanType, search);
        }

        function handleApplicationSearch(event) {
            if (event.key === 'Enter') {
                filterApplications();
            }
        }

        function closeApplicationModal() {
            document.getElementById('applicationModal').classList.add('hidden');
        }

        async function viewApplication(applicationId) {
            try {
                const response = await fetch(`${API_BASE}/api/admin/applications/${applicationId}`);

                if (response.ok) {
                    const result = await response.json();
                    const data = result.data;
                    
                    document.getElementById('applicationModalTitle').textContent = `Application #${applicationId}`;
                    document.getElementById('applicationDetails').innerHTML = formatApplicationDetails(data);
                    document.getElementById('applicationModal').classList.remove('hidden');
                } else {
                    alert('Error loading application details');
                }
            } catch (error) {
                console.error('Error loading application:', error);
                alert('Network error loading application details');
            }
        }

        function formatApplicationDetails(data) {
            const app = data.application;
            const client = data.client_details;
            const employment = data.employment_details;
            const financial = data.financial_details;
            
            const loanTypeLabels = {
                'mortgage': 'üè† Mortgage',
                'mortgage_refinance': 'üîÑ Mortgage Refinance',
                'credit': 'üí≥ Credit',
                'credit_refinance': 'üîÑ Credit Refinance'
            };

            return `
                <div class="space-y-6">
                    <!-- Basic Information -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 mb-3">üìã Application Information</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="font-medium">Application ID:</span> APP-${app.id}</div>
                            <div><span class="font-medium">Bank:</span> ${app.bank_name}</div>
                            <div><span class="font-medium">Loan Type:</span> ${loanTypeLabels[app.loan_type] || app.loan_type}</div>
                            <div><span class="font-medium">Loan Amount:</span> ‚Ç™${(app.loan_amount || 0).toLocaleString()}</div>
                            <div><span class="font-medium">Interest Rate:</span> ${app.interest_rate}%</div>
                            <div><span class="font-medium">Term:</span> ${app.term_months} months</div>
                            <div><span class="font-medium">Monthly Payment:</span> ‚Ç™${(app.monthly_payment || 0).toLocaleString()}</div>
                            <div><span class="font-medium">Status:</span> <span class="capitalize">${app.status?.replace('_', ' ') || 'Unknown'}</span></div>
                            <div><span class="font-medium">Submitted:</span> ${app.created_at ? new Date(app.created_at).toLocaleDateString() : 'N/A'}</div>
                            <div><span class="font-medium">Last Updated:</span> ${app.updated_at ? new Date(app.updated_at).toLocaleDateString() : 'N/A'}</div>
                        </div>
                    </div>

                    <!-- Customer Information -->
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 mb-3">üë§ Customer Information</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="font-medium">Name:</span> ${client.name}</div>
                            <div><span class="font-medium">Email:</span> ${client.email || 'N/A'}</div>
                            <div><span class="font-medium">Phone:</span> ${client.phone || 'N/A'}</div>
                            <div><span class="font-medium">Age:</span> ${client.age || 'N/A'}</div>
                        </div>
                    </div>

                    ${employment ? `
                    <!-- Employment Information -->
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 mb-3">üíº Employment Information</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="font-medium">Status:</span> ${employment.status || 'N/A'}</div>
                            <div><span class="font-medium">Occupation:</span> ${employment.occupation || 'N/A'}</div>
                            <div><span class="font-medium">Years Employed:</span> ${employment.years_employed || 'N/A'}</div>
                            <div><span class="font-medium">Monthly Income:</span> ‚Ç™${(employment.monthly_income || 0).toLocaleString()}</div>
                        </div>
                    </div>
                    ` : ''}

                    ${financial ? `
                    <!-- Financial Information -->
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 mb-3">üí∞ Financial Information</h4>
                        <div class="grid grid-cols-2 gap-4 text-sm">
                            <div><span class="font-medium">Credit Score:</span> ${financial.credit_score || 'N/A'}</div>
                            <div><span class="font-medium">Monthly Expenses:</span> ‚Ç™${(financial.monthly_expenses || 0).toLocaleString()}</div>
                            <div><span class="font-medium">DTI Ratio:</span> ${financial.dti_ratio || 'N/A'}%</div>
                        </div>
                    </div>
                    ` : ''}

                    ${app.application_data ? `
                    <!-- Additional Application Data -->
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 mb-3">üìä Additional Details</h4>
                        <div class="text-sm">
                            ${(() => {
                                try {
                                    const data = JSON.parse(app.application_data);
                                    return `
                                        ${data.property_value ? `<div><span class="font-medium">Property Value:</span> ‚Ç™${data.property_value.toLocaleString()}</div>` : ''}
                                        ${data.ltv_ratio ? `<div><span class="font-medium">LTV Ratio:</span> ${data.ltv_ratio}%</div>` : ''}
                                        ${data.dti_ratio ? `<div><span class="font-medium">DTI Ratio:</span> ${data.dti_ratio}%</div>` : ''}
                                        ${data.additional_info ? `<div class="mt-2"><span class="font-medium">Notes:</span> ${data.additional_info}</div>` : ''}
                                    `;
                                } catch (e) {
                                    return '<div class="text-gray-500">No additional data available</div>';
                                }
                            })()}
                        </div>
                    </div>
                    ` : ''}

                    ${app.review_notes ? `
                    <!-- Review Notes -->
                    <div class="bg-orange-50 p-4 rounded-lg">
                        <h4 class="font-medium text-gray-900 mb-3">üìù Review Notes</h4>
                        <p class="text-sm">${app.review_notes}</p>
                    </div>
                    ` : ''}

                    <!-- Action Buttons -->
                    <div class="flex justify-end space-x-3 pt-4 border-t">
                        ${['pending_review', 'under_review', 'documentation_required', 'documents_verified', 'final_approval'].includes(app.status) ? `
                            <button onclick="showUpdateStatusModal(${app.id}, '${app.status}')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                üìã Update Status
                            </button>
                        ` : ''}
                        <button onclick="closeApplicationModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md text-sm font-medium">
                            Close
                        </button>
                    </div>
                </div>
            `;
        }

        function showUpdateStatusModal(applicationId, currentStatus) {
            const statusOptions = {
                'pending_review': ['under_review', 'rejected'],
                'under_review': ['documentation_required', 'final_approval', 'rejected'],
                'documentation_required': ['documents_verified', 'rejected'],
                'documents_verified': ['final_approval', 'rejected'],
                'final_approval': ['approved', 'rejected']
            };

            const nextStatuses = statusOptions[currentStatus] || [];
            
            const modalHtml = `
                <div id="statusUpdateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
                    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Update Application Status</h3>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Current Status</label>
                            <p class="text-sm text-gray-900 capitalize">${currentStatus.replace('_', ' ')}</p>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">New Status</label>
                            <select id="newStatus" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                ${nextStatuses.map(status => `
                                    <option value="${status}">${status.replace(/_/g, ' ').toUpperCase()}</option>
                                `).join('')}
                            </select>
                        </div>
                        
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Review Notes</label>
                            <textarea id="reviewNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                      placeholder="Add notes about this status update..."></textarea>
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button onclick="document.getElementById('statusUpdateModal').remove()" 
                                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded-md text-sm font-medium">
                                Cancel
                            </button>
                            <button onclick="updateApplicationStatus(${applicationId})" 
                                    class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                Update Status
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        async function updateApplicationStatus(applicationId) {
            const newStatus = document.getElementById('newStatus')?.value;
            const reviewNotes = document.getElementById('reviewNotes')?.value;
            
            if (!newStatus) {
                alert('Please select a new status');
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/applications/${applicationId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: newStatus,
                        review_notes: reviewNotes
                    })
                });

                if (response.ok) {
                    document.getElementById('statusUpdateModal')?.remove();
                    closeApplicationModal();
                    alert('Application status updated successfully');
                    refreshApplications();
                } else {
                    alert('Error updating application status');
                }
            } catch (error) {
                console.error('Error updating status:', error);
                alert('Network error updating application status');
            }
        }

        async function approveApplication(applicationId) {
            await updateApplicationStatus(applicationId, 'approved', 'approved');
        }

        async function rejectApplication(applicationId) {
            const reason = prompt('Please enter rejection reason:');
            if (reason) {
                await updateApplicationStatus(applicationId, 'rejected', 'rejected', reason);
            }
        }

        async function approveApplicationFromModal(applicationId) {
            await updateApplicationStatus(applicationId, 'approved', 'approved');
            closeApplicationModal();
        }

        async function rejectApplicationFromModal(applicationId) {
            const reason = prompt('Please enter rejection reason:');
            if (reason) {
                await updateApplicationStatus(applicationId, 'rejected', 'rejected', reason);
                closeApplicationModal();
            }
        }

        async function updateApplicationStatus(applicationId, applicationStatus, approvalStatus, rejectionReason = null) {
            const token = localStorage.getItem('adminToken');
            
            const updateData = {
                application_status: applicationStatus,
                approval_status: approvalStatus
            };
            
            if (rejectionReason) {
                updateData.rejection_reason = rejectionReason;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/applications/${applicationId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(updateData)
                });

                if (response.ok) {
                    alert(`Application ${applicationStatus} successfully`);
                    refreshApplications(); // Reload the list
                } else {
                    const data = await response.json();
                    alert('Error updating application: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error updating application:', error);
                alert('Network error updating application');
            }
        }

        async function showCalculations() {
            const token = localStorage.getItem('adminToken');
            
            document.getElementById('main-content').innerHTML = '<div class="flex justify-center items-center h-64"><div class="text-gray-500">Loading calculations...</div></div>';
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/calculations`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('main-content').innerHTML = CalculationManagementContent(data.data);
                    updateNavigation('calculations');
                } else {
                    document.getElementById('main-content').innerHTML = '<div class="text-red-500 text-center">Error loading calculations</div>';
                }
            } catch (error) {
                console.error('Error loading calculations:', error);
                document.getElementById('main-content').innerHTML = '<div class="text-red-500 text-center">Network error loading calculations</div>';
            }
        }

        // Enhanced Mortgage Calculation with Approval Logic
        async function testEnhancedMortgageCalculation(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            
            const amount = parseInt(document.getElementById('enhMortgageAmount').value);
            const property_value = parseInt(document.getElementById('enhMortgagePropertyValue').value);
            const rate = parseFloat(document.getElementById('enhMortgageRate').value);
            const years = parseInt(document.getElementById('enhMortgageYears').value);
            const initial_payment = parseInt(document.getElementById('enhMortgageDown').value);
            const monthly_income = parseInt(document.getElementById('enhMortgageIncome').value);
            const monthly_expenses = parseInt(document.getElementById('enhMortgageExpenses').value);
            const age = parseInt(document.getElementById('enhMortgageAge').value);
            const credit_score = parseInt(document.getElementById('enhMortgageCreditScore').value);
            const employment_years = parseInt(document.getElementById('enhMortgageEmployment').value);
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/calculate-enhanced-mortgage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        amount, property_value, rate, years, initial_payment, 
                        monthly_income, monthly_expenses, age, credit_score, employment_years 
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const result = data.data;
                    displayEnhancedMortgageResult(result);
                } else {
                    const errorData = await response.json();
                    alert('Error calculating enhanced mortgage: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error calculating enhanced mortgage:', error);
                alert('Network error calculating enhanced mortgage');
            }
        }

        // Enhanced Credit Calculation with Approval Logic
        async function testEnhancedCreditCalculation(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            
            const amount = parseInt(document.getElementById('enhCreditAmount').value);
            const rate = parseFloat(document.getElementById('enhCreditRate').value);
            const years = parseInt(document.getElementById('enhCreditYears').value);
            const monthly_income = parseInt(document.getElementById('enhCreditIncome').value);
            const monthly_expenses = parseInt(document.getElementById('enhCreditExpenses').value);
            const existing_debts = parseInt(document.getElementById('enhCreditDebts').value);
            const age = parseInt(document.getElementById('enhCreditAge').value);
            const credit_score = parseInt(document.getElementById('enhCreditCreditScore').value);
            const employment_years = parseInt(document.getElementById('enhCreditEmployment').value);
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/calculate-enhanced-credit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        amount, rate, years, monthly_income, monthly_expenses, 
                        existing_debts, age, credit_score, employment_years 
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const result = data.data;
                    displayEnhancedCreditResult(result);
                } else {
                    const errorData = await response.json();
                    alert('Error calculating enhanced credit: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error calculating enhanced credit:', error);
                alert('Network error calculating enhanced credit');
            }
        }

        // Display Enhanced Mortgage Result
        function displayEnhancedMortgageResult(result) {
            const resultDiv = document.getElementById('enhancedMortgageResult');
            const approvalClass = result.approved ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
            const approvalTextClass = result.approved ? 'text-green-800' : 'text-red-800';
            const approvalStatus = result.approved ? t('approved') : t('rejected');
            
            resultDiv.innerHTML = `
                <div class="p-4 ${approvalClass} border rounded-md">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">${result.approved ? '‚úÖ' : '‚ùå'}</span>
                        <h4 class="font-medium ${approvalTextClass}">${t('approval_result')} ${approvalStatus}</h4>
                    </div>
                    
                    <!-- Basic Calculation Results -->
                    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                        <div><strong>${t('principal')}:</strong> ${result.principal.toLocaleString()}</div>
                        <div><strong>${t('monthly_payment')}:</strong> ${result.monthlyPayment.toLocaleString()}</div>
                        <div><strong>${t('total_payment')}:</strong> ${result.totalPayment.toLocaleString()}</div>
                        <div><strong>${t('total_interest')}:</strong> ${result.totalInterest.toLocaleString()}</div>
                    </div>
                    
                    <!-- Approval Criteria -->
                    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                        <div><strong>${t('ltv_ratio')}:</strong> ${result.ltv_ratio}% ${result.criteria_results.ltv_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>${t('dti_ratio')}:</strong> ${result.dti_ratio}% ${result.criteria_results.dti_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>${t('age_at_maturity')}:</strong> ${result.age_at_maturity} ${result.criteria_results.age_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>${t('stress_test_dti')}:</strong> ${result.stress_test_dti}% ${result.criteria_results.stress_test_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>${t('credit_risk_level')}:</strong> ${result.credit_risk_level} ${result.criteria_results.credit_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Employment:</strong> ${result.criteria_results.employment_approved ? '‚úÖ' : '‚ùå'}</div>
                    </div>
                    
                    ${result.rejection_reasons.length > 0 ? `
                        <div class="mb-4">
                            <strong class="text-red-800">${t('rejection_reasons')}:</strong>
                            <ul class="list-disc list-inside text-sm text-red-700 mt-1">
                                ${result.rejection_reasons.map(reason => `<li>${reason}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${result.approval_conditions.length > 0 ? `
                        <div class="mb-4">
                            <strong class="text-orange-800">${t('approval_conditions')}:</strong>
                            <ul class="list-disc list-inside text-sm text-orange-700 mt-1">
                                ${result.approval_conditions.map(condition => `<li>${condition}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${result.recommended_banks.length > 0 ? `
                        <div>
                            <strong class="text-green-800">${t('recommended_banks')}:</strong>
                            <div class="mt-1 space-y-1">
                                ${result.recommended_banks.map(bank => `
                                    <div class="text-sm text-green-700">
                                        <strong>${bank.name}</strong> - ${bank.rate}% (${bank.reason})
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            resultDiv.classList.remove('hidden');
        }

        // Display Enhanced Credit Result
        function displayEnhancedCreditResult(result) {
            const resultDiv = document.getElementById('enhancedCreditResult');
            const approvalClass = result.approved ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
            const approvalTextClass = result.approved ? 'text-green-800' : 'text-red-800';
            const approvalStatus = result.approved ? t('approved') : t('rejected');
            
            resultDiv.innerHTML = `
                <div class="p-4 ${approvalClass} border rounded-md">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">${result.approved ? '‚úÖ' : '‚ùå'}</span>
                        <h4 class="font-medium ${approvalTextClass}">${t('approval_result')} ${approvalStatus}</h4>
                    </div>
                    
                    <!-- Basic Calculation Results -->
                    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                        <div><strong>${t('principal')}:</strong> ${result.principal.toLocaleString()}</div>
                        <div><strong>${t('monthly_payment')}:</strong> ${result.monthlyPayment.toLocaleString()}</div>
                        <div><strong>${t('total_payment')}:</strong> ${result.totalPayment.toLocaleString()}</div>
                        <div><strong>${t('total_interest')}:</strong> ${result.totalInterest.toLocaleString()}</div>
                    </div>
                    
                    <!-- Approval Criteria -->
                    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                        <div><strong>${t('dti_ratio')}:</strong> ${result.dti_ratio}% ${result.criteria_results.dti_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Credit/Income:</strong> ${result.credit_to_income_ratio}% ${result.criteria_results.credit_amount_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>${t('age_at_maturity')}:</strong> ${result.age_at_maturity} ${result.criteria_results.age_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>${t('stress_test_dti')}:</strong> ${result.stress_test_dti}% ${result.criteria_results.stress_test_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>${t('credit_risk_level')}:</strong> ${result.credit_risk_level} ${result.criteria_results.credit_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Employment:</strong> ${result.criteria_results.employment_approved ? '‚úÖ' : '‚ùå'}</div>
                    </div>
                    
                    ${result.rejection_reasons.length > 0 ? `
                        <div class="mb-4">
                            <strong class="text-red-800">${t('rejection_reasons')}:</strong>
                            <ul class="list-disc list-inside text-sm text-red-700 mt-1">
                                ${result.rejection_reasons.map(reason => `<li>${reason}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${result.approval_conditions.length > 0 ? `
                        <div class="mb-4">
                            <strong class="text-orange-800">${t('approval_conditions')}:</strong>
                            <ul class="list-disc list-inside text-sm text-orange-700 mt-1">
                                ${result.approval_conditions.map(condition => `<li>${condition}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${result.recommended_banks.length > 0 ? `
                        <div>
                            <strong class="text-green-800">${t('recommended_banks')}:</strong>
                            <div class="mt-1 space-y-1">
                                ${result.recommended_banks.map(bank => `
                                    <div class="text-sm text-green-700">
                                        <strong>${bank.name}</strong> - ${bank.rate}% (${bank.reason})
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            resultDiv.classList.remove('hidden');
        }

        // Test Mortgage Calculation
        async function testMortgageCalculation(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            
            const amount = parseInt(document.getElementById('mortgageAmount').value);
            const rate = parseFloat(document.getElementById('mortgageRate').value);
            const years = parseInt(document.getElementById('mortgageYears').value);
            const initial_payment = parseInt(document.getElementById('mortgageDown').value);
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/calculate-mortgage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ amount, rate, years, initial_payment })
                });

                if (response.ok) {
                    const data = await response.json();
                    const result = data.data;
                    
                    document.getElementById('mortgagePrincipal').textContent = result.principal.toLocaleString();
                    document.getElementById('mortgageMonthly').textContent = result.monthlyPayment.toLocaleString();
                    document.getElementById('mortgageTotal').textContent = result.totalPayment.toLocaleString();
                    document.getElementById('mortgageInterest').textContent = result.totalInterest.toLocaleString();
                    
                    document.getElementById('mortgageResult').classList.remove('hidden');
                } else {
                    alert('Error calculating mortgage');
                }
            } catch (error) {
                console.error('Error calculating mortgage:', error);
                alert('Network error calculating mortgage');
            }
        }

        // Test Credit Calculation
        async function testCreditCalculation(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            
            const amount = parseInt(document.getElementById('creditAmount').value);
            const rate = parseFloat(document.getElementById('creditRate').value);
            const years = parseInt(document.getElementById('creditYears').value);
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/calculate-credit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ amount, rate, years })
                });

                if (response.ok) {
                    const data = await response.json();
                    const result = data.data;
                    
                    document.getElementById('creditPrincipal').textContent = result.principal.toLocaleString();
                    document.getElementById('creditMonthly').textContent = result.monthlyPayment.toLocaleString();
                    document.getElementById('creditTotal').textContent = result.totalPayment.toLocaleString();
                    document.getElementById('creditInterest').textContent = result.totalInterest.toLocaleString();
                    
                    document.getElementById('creditResult').classList.remove('hidden');
                } else {
                    alert('Error calculating credit');
                }
            } catch (error) {
                console.error('Error calculating credit:', error);
                alert('Network error calculating credit');
            }
        }

        // Enhanced Mortgage Refinance Calculation with Approval Logic
        async function testEnhancedMortgageRefinanceCalculation(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            
            const current_loan_amount = parseInt(document.getElementById('enhMortRefCurrentAmount').value);
            const current_rate = parseFloat(document.getElementById('enhMortRefCurrentRate').value);
            const current_monthly_payment = parseInt(document.getElementById('enhMortRefCurrentPayment').value);
            const remaining_years = parseInt(document.getElementById('enhMortRefRemainingYears').value);
            const property_value = parseInt(document.getElementById('enhMortRefPropertyValue').value);
            const new_loan_amount = parseInt(document.getElementById('enhMortRefNewAmount').value);
            const new_rate = parseFloat(document.getElementById('enhMortRefNewRate').value);
            const new_years = parseInt(document.getElementById('enhMortRefNewYears').value);
            const monthly_income = parseInt(document.getElementById('enhMortRefIncome').value);
            const monthly_expenses = parseInt(document.getElementById('enhMortRefExpenses').value);
            const age = parseInt(document.getElementById('enhMortRefAge').value);
            const credit_score = parseInt(document.getElementById('enhMortRefCreditScore').value);
            const employment_years = parseInt(document.getElementById('enhMortRefEmployment').value);
            const closing_costs = parseInt(document.getElementById('enhMortRefClosingCosts').value);
            const refinance_type = document.getElementById('enhMortRefType').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/calculate-enhanced-mortgage-refinance`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        current_loan_amount, current_rate, current_monthly_payment, remaining_years,
                        property_value, new_loan_amount, new_rate, new_years, monthly_income, 
                        monthly_expenses, age, credit_score, employment_years, closing_costs, refinance_type
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const result = data.data;
                    displayEnhancedMortgageRefinanceResult(result);
                } else {
                    const errorData = await response.json();
                    alert('Error calculating enhanced mortgage refinance: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error calculating enhanced mortgage refinance:', error);
                alert('Network error calculating enhanced mortgage refinance');
            }
        }

        // Enhanced Credit Refinance Calculation with Approval Logic
        async function testEnhancedCreditRefinanceCalculation(event) {
            event.preventDefault();
            const token = localStorage.getItem('adminToken');
            
            const consolidation_amount = parseInt(document.getElementById('enhCredRefConsolidationAmount').value);
            const new_rate = parseFloat(document.getElementById('enhCredRefNewRate').value);
            const new_years = parseInt(document.getElementById('enhCredRefNewYears').value);
            const monthly_income = parseInt(document.getElementById('enhCredRefIncome').value);
            const monthly_expenses = parseInt(document.getElementById('enhCredRefExpenses').value);
            const age = parseInt(document.getElementById('enhCredRefAge').value);
            const credit_score = parseInt(document.getElementById('enhCredRefCreditScore').value);
            const employment_years = parseInt(document.getElementById('enhCredRefEmployment').value);
            const refinance_purpose = document.getElementById('enhCredRefPurpose').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/calculate-enhanced-credit-refinance`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        consolidation_amount, new_rate, new_years, monthly_income, monthly_expenses,
                        age, credit_score, employment_years, refinance_purpose
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const result = data.data;
                    displayEnhancedCreditRefinanceResult(result);
                } else {
                    const errorData = await response.json();
                    alert('Error calculating enhanced credit refinance: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error calculating enhanced credit refinance:', error);
                alert('Network error calculating enhanced credit refinance');
            }
        }

        // Display Enhanced Mortgage Refinance Result
        function displayEnhancedMortgageRefinanceResult(result) {
            const resultDiv = document.getElementById('enhancedMortgageRefinanceResult');
            const approvalClass = result.approved ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
            const approvalTextClass = result.approved ? 'text-green-800' : 'text-red-800';
            const approvalStatus = result.approved ? 'Approved' : 'Rejected';
            
            resultDiv.innerHTML = `
                <div class="p-4 ${approvalClass} border rounded-md">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">${result.approved ? '‚úÖ' : '‚ùå'}</span>
                        <h4 class="font-medium ${approvalTextClass}">Refinance Decision: ${approvalStatus}</h4>
                    </div>
                    
                    <!-- Refinance Results -->
                    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                        <div><strong>Refinance Type:</strong> ${result.refinance_type.replace('_', ' ').toUpperCase()}</div>
                        <div><strong>New Loan Amount:</strong> ‚Ç™${result.new_loan_amount.toLocaleString()}</div>
                        <div><strong>New Monthly Payment:</strong> ‚Ç™${result.new_monthly_payment.toLocaleString()}</div>
                        <div><strong>Monthly Savings:</strong> ‚Ç™${result.monthly_savings.toLocaleString()}</div>
                        <div><strong>Break-even Period:</strong> ${result.break_even_months} months</div>
                        <div><strong>Cash-out Amount:</strong> ‚Ç™${result.cash_out_amount.toLocaleString()}</div>
                    </div>
                    
                    <!-- Approval Criteria -->
                    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                        <div><strong>LTV Ratio:</strong> ${result.ltv_ratio}% ${result.criteria_results.ltv_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>DTI Ratio:</strong> ${result.dti_ratio}% ${result.criteria_results.dti_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Age at Maturity:</strong> ${result.age_at_maturity} ${result.criteria_results.age_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Break-even:</strong> ${result.criteria_results.break_even_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Credit Score:</strong> ${result.credit_score} ${result.criteria_results.credit_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Cash-out Check:</strong> ${result.criteria_results.cash_out_approved ? '‚úÖ' : '‚ùå'}</div>
                    </div>
                    
                    ${result.rejection_reasons.length > 0 ? `
                        <div class="mb-3">
                            <h5 class="font-medium text-red-800 mb-1">Rejection Reasons:</h5>
                            <ul class="text-sm text-red-700 list-disc list-inside">
                                ${result.rejection_reasons.map(reason => `<li>${reason}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${result.approval_conditions.length > 0 ? `
                        <div class="mb-3">
                            <h5 class="font-medium text-orange-800 mb-1">Approval Conditions:</h5>
                            <ul class="text-sm text-orange-700 list-disc list-inside">
                                ${result.approval_conditions.map(condition => `<li>${condition}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${result.recommended_banks.length > 0 ? `
                        <div>
                            <h5 class="font-medium text-blue-800 mb-1">Recommended Banks:</h5>
                            <div class="text-sm text-blue-700">
                                ${result.recommended_banks.map(bank => `
                                    <div class="flex justify-between py-1">
                                        <span>${bank.name}</span>
                                        <span>${bank.rate}% - ${bank.reason}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            resultDiv.classList.remove('hidden');
        }

        // Display Enhanced Credit Refinance Result
        function displayEnhancedCreditRefinanceResult(result) {
            const resultDiv = document.getElementById('enhancedCreditRefinanceResult');
            const approvalClass = result.approved ? 'bg-green-50 border-green-200' : 'bg-red-50 border-red-200';
            const approvalTextClass = result.approved ? 'text-green-800' : 'text-red-800';
            const approvalStatus = result.approved ? 'Approved' : 'Rejected';
            
            resultDiv.innerHTML = `
                <div class="p-4 ${approvalClass} border rounded-md">
                    <div class="flex items-center mb-3">
                        <span class="text-2xl mr-2">${result.approved ? '‚úÖ' : '‚ùå'}</span>
                        <h4 class="font-medium ${approvalTextClass}">Credit Refinance Decision: ${approvalStatus}</h4>
                    </div>
                    
                    <!-- Refinance Results -->
                    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                        <div><strong>Purpose:</strong> ${result.refinance_purpose.replace('_', ' ').toUpperCase()}</div>
                        <div><strong>Consolidation Amount:</strong> ‚Ç™${result.consolidation_amount.toLocaleString()}</div>
                        <div><strong>New Monthly Payment:</strong> ‚Ç™${result.new_monthly_payment.toLocaleString()}</div>
                        <div><strong>Monthly Savings:</strong> ‚Ç™${result.monthly_savings.toLocaleString()}</div>
                        <div><strong>Old DTI:</strong> ${result.old_dti}%</div>
                        <div><strong>DTI Improvement:</strong> ${result.dti_improvement}%</div>
                    </div>
                    
                    <!-- Approval Criteria -->
                    <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                        <div><strong>DTI Ratio:</strong> ${result.dti_ratio}% ${result.criteria_results.dti_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Credit to Income:</strong> ${result.credit_to_income_ratio}% ${result.criteria_results.credit_amount_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Age at Maturity:</strong> ${result.age_at_maturity} ${result.criteria_results.age_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Credit Score:</strong> ${result.credit_score} ${result.criteria_results.credit_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>Monthly Savings:</strong> ${result.criteria_results.savings_approved ? '‚úÖ' : '‚ùå'}</div>
                        <div><strong>DTI Improvement:</strong> ${result.criteria_results.dti_improvement_approved ? '‚úÖ' : '‚ùå'}</div>
                    </div>
                    
                    ${result.rejection_reasons.length > 0 ? `
                        <div class="mb-3">
                            <h5 class="font-medium text-red-800 mb-1">Rejection Reasons:</h5>
                            <ul class="text-sm text-red-700 list-disc list-inside">
                                ${result.rejection_reasons.map(reason => `<li>${reason}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${result.approval_conditions.length > 0 ? `
                        <div class="mb-3">
                            <h5 class="font-medium text-orange-800 mb-1">Approval Conditions:</h5>
                            <ul class="text-sm text-orange-700 list-disc list-inside">
                                ${result.approval_conditions.map(condition => `<li>${condition}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    
                    ${result.recommended_banks.length > 0 ? `
                        <div>
                            <h5 class="font-medium text-blue-800 mb-1">Recommended Banks:</h5>
                            <div class="text-sm text-blue-700">
                                ${result.recommended_banks.map(bank => `
                                    <div class="flex justify-between py-1">
                                        <span>${bank.name}</span>
                                        <span>${bank.rate}% - ${bank.reason}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
            resultDiv.classList.remove('hidden');
        }

        // Banking Standards Management
        async function showBankingStandards() {
            const token = localStorage.getItem('adminToken');
            
            document.getElementById('main-content').innerHTML = `<div class="flex justify-center items-center h-64"><div class="text-gray-500">${t('loading')} ${t('standards').toLowerCase()}...</div></div>`;
            
            try {
                // Load standards for all business paths
                const [mortgageRes, mortgageRefRes, creditRes, creditRefRes] = await Promise.all([
                    fetch(`${API_BASE}/api/admin/banking-standards/mortgage`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/banking-standards/mortgage_refinance`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/banking-standards/credit`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch(`${API_BASE}/api/admin/banking-standards/credit_refinance`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    })
                ]);

                if (mortgageRes.ok && mortgageRefRes.ok && creditRes.ok && creditRefRes.ok) {
                    const [mortgageData, mortgageRefData, creditData, creditRefData] = await Promise.all([
                        mortgageRes.json(),
                        mortgageRefRes.json(),
                        creditRes.json(),
                        creditRefRes.json()
                    ]);
                    
                    document.getElementById('main-content').innerHTML = BankingStandardsContent({
                        mortgage: mortgageData.data.standards,
                        mortgage_refinance: mortgageRefData.data.standards,
                        credit: creditData.data.standards,
                        credit_refinance: creditRefData.data.standards
                    });
                    updateNavigation('standards');
                    
                    // Update i18n content after DOM is updated
                    setTimeout(() => {
                        if (window.i18n && window.i18n.updatePageContent) {
                            window.i18n.updatePageContent();
                        }
                    }, 100);
                } else {
                    document.getElementById('main-content').innerHTML = `<div class="text-red-500 text-center">${t('error_loading_applications')} ${t('standards').toLowerCase()}</div>`;
                }
            } catch (error) {
                console.error('Error loading banking standards:', error);
                document.getElementById('main-content').innerHTML = `<div class="text-red-500 text-center">${t('network_error')} ${t('standards').toLowerCase()}</div>`;
            }
        }

        // Banking Standards Content Component
        function BankingStandardsContent(standards) {
            // Check if standards is valid
            if (!standards || typeof standards !== 'object') {
                return `
                    <div class="mb-6">
                        <h1 class="text-3xl font-bold text-gray-900" data-i18n="banking_standards_management">${t('banking_standards_management')}</h1>
                        <p class="mt-1 text-sm text-gray-600" data-i18n="configure_banking_standards">${t('configure_banking_standards')}</p>
                    </div>
                    <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4">
                        <div class="text-yellow-800">
                            <h3 class="font-medium">‚ö†Ô∏è No Banking Standards Data</h3>
                            <p class="text-sm mt-1">Banking standards data is not available. Please check your API connection or contact your administrator.</p>
                        </div>
                    </div>
                `;
            }
            
            return `
                <div class="mb-6">
                    <h1 class="text-3xl font-bold text-gray-900" data-i18n="banking_standards_management">${t('banking_standards_management')}</h1>
                    <p class="mt-1 text-sm text-gray-600" data-i18n="configure_banking_standards">${t('configure_banking_standards')}</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    ${Object.entries(standards).map(([businessPath, pathStandards]) => `
                        <div class="bg-white shadow rounded-lg">
                            <div class="px-4 py-5 sm:p-6">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">
                                    ${businessPath.replace('_', ' ').toUpperCase()} ${t('standards_suffix')}
                                </h3>
                                
                                <div class="space-y-4">
                                    ${pathStandards.map(standard => `
                                        <div class="border border-gray-200 rounded-md p-3">
                                            <div class="flex justify-between items-start">
                                                <div class="flex-1">
                                                    <h4 class="text-sm font-medium text-gray-900">
                                                        ${standard.standard_category}.${standard.standard_name}
                                                    </h4>
                                                    <p class="text-xs text-gray-500 mt-1">${standard.description || t('no_description')}</p>
                                                </div>
                                                <div class="ml-4 flex items-center space-x-2">
                                                    <input 
                                                        type="number" 
                                                        value="${standard.standard_value}" 
                                                        step="0.01"
                                                        class="w-20 px-2 py-1 border border-gray-300 rounded text-sm"
                                                        onchange="updateStandard(${standard.id}, this.value)"
                                                    >
                                                    <span class="text-xs text-gray-500">
                                                        ${standard.value_type === 'percentage' ? '%' : 
                                                          standard.value_type === 'score' ? 'pts' : 
                                                          standard.value_type === 'years' ? 'yrs' : ''}
                                                    </span>
                                                    <button 
                                                        onclick="toggleStandard(${standard.id}, ${!standard.is_active})"
                                                        class="px-2 py-1 text-xs rounded ${standard.is_active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}"
                                                    >
                                                        ${standard.is_active ? t('active') : t('inactive')}
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div class="mt-6 p-4 bg-blue-50 rounded-md">
                    <div class="text-sm text-blue-700">
                        <p class="font-medium" data-i18n="banking_standards_info">üí° ${t('banking_standards_info')}</p>
                        <p class="mt-1" data-i18n="standards_take_effect">${t('standards_take_effect')}</p>
                    </div>
                </div>
            `;
        }

        // Update banking standard value
        async function updateStandard(standardId, newValue) {
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/banking-standards/${standardId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        standard_value: parseFloat(newValue),
                        is_active: true
                    })
                });

                if (response.ok) {
                    console.log('Standard updated successfully');
                } else {
                    const data = await response.json();
                    alert('Error updating standard: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error updating standard:', error);
                alert('Network error updating standard');
            }
        }

        // Toggle banking standard active status
        async function toggleStandard(standardId, isActive) {
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/banking-standards/${standardId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ 
                        is_active: isActive
                    })
                });

                if (response.ok) {
                    showBankingStandards(); // Reload the page
                } else {
                    const data = await response.json();
                    alert('Error toggling standard: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error toggling standard:', error);
                alert('Network error toggling standard');
            }
        }

        function showSettings() {
            document.getElementById('main-content').innerHTML = '<div class="text-center py-8"><h2 class="text-2xl font-bold text-gray-900">Settings</h2><p class="text-gray-600 mt-2">Coming soon in Phase 2...</p></div>';
            updateNavigation('settings');
        }

        // Bank Management Functions
        let currentBanks = [];

        function showAddBankModal() {
            document.getElementById('modalTitle').textContent = 'Add New Bank';
            document.getElementById('bankForm').reset();
            document.getElementById('bankId').value = '';
            document.getElementById('bankModal').classList.remove('hidden');
        }

        function closeBankModal() {
            document.getElementById('bankModal').classList.add('hidden');
        }

        async function editBank(bankId) {
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/banks/${bankId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const bank = data.data;
                    
                    document.getElementById('modalTitle').textContent = 'Edit Bank';
                    document.getElementById('bankId').value = bank.id;
                    document.getElementById('bankNameEn').value = bank.name_en || '';
                    document.getElementById('bankNameHe').value = bank.name_he || '';
                    document.getElementById('bankNameRu').value = bank.name_ru || '';
                    document.getElementById('bankUrl').value = bank.url || '';
                    document.getElementById('bankPriority').value = bank.priority || 1;
                    
                    document.getElementById('bankModal').classList.remove('hidden');
                } else {
                    alert('Error loading bank details');
                }
            } catch (error) {
                console.error('Error loading bank:', error);
                alert('Network error loading bank details');
            }
        }

        async function deleteBank(bankId) {
            if (!confirm('Are you sure you want to delete this bank? This action cannot be undone.')) {
                return;
            }

            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/banks/${bankId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    alert('Bank deleted successfully');
                    showBankManagement(); // Reload the list
                } else {
                    const data = await response.json();
                    alert('Error deleting bank: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error deleting bank:', error);
                alert('Network error deleting bank');
            }
        }

        async function handleBankSubmit(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const bankData = {
                name_en: formData.get('name_en'),
                name_he: formData.get('name_he'),
                name_ru: formData.get('name_ru'),
                url: formData.get('url'),
                priority: parseInt(formData.get('priority')) || 1,
                tender: 1
            };

            const bankId = formData.get('id');
            const isEditing = bankId && bankId !== '';
            
            const token = localStorage.getItem('adminToken');
            
            try {
                const response = await fetch(`${API_BASE}/api/admin/banks${isEditing ? '/' + bankId : ''}`, {
                    method: isEditing ? 'PUT' : 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(bankData)
                });

                if (response.ok) {
                    alert(`Bank ${isEditing ? 'updated' : 'created'} successfully`);
                    closeBankModal();
                    showBankManagement(); // Reload the list
                } else {
                    const data = await response.json();
                    alert('Error saving bank: ' + (data.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error saving bank:', error);
                alert('Network error saving bank');
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('bankModal');
            if (modal && event.target === modal) {
                closeBankModal();
            }
        });

        // Enhanced Main Tab Management
        let currentMainTab = 'dashboard';
        let currentSubTab = {};

        function showMainTab(tabName) {
            // Update tab visibility
            document.querySelectorAll('.main-tab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeTab = document.getElementById(`tab-${tabName}`);
            if (activeTab) {
                activeTab.classList.remove('border-transparent', 'text-gray-500');
                activeTab.classList.add('border-indigo-500', 'text-indigo-600');
            }
            
            currentMainTab = tabName;
            
            // Load content based on tab
            switch (tabName) {
                case 'dashboard':
                    showDashboard();
                    break;
                case 'bank-operations':
                    showBankOperations();
                    break;
                case 'user-management':
                    showUserManagement();
                    break;
                case 'risk-compliance':
                    showRiskCompliance();
                    break;
                case 'applications':
                    showApplications();
                    break;
                case 'system-settings':
                    showSystemSettings();
                    break;
                default:
                    showDashboard();
            }
        }

        // Bank Operations with Sub-tabs
        function showBankOperations() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Header -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900">
                                    <svg class="w-8 h-8 inline mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1a2 2 0 012 2v1a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2z"></path>
                                    </svg>
                                    ${t('navigation.bank_operations')}
                                </h1>
                                <p class="text-gray-600">${t('bank_operations_subtitle')}</p>
                            </div>
                            <div class="flex space-x-2">
                                <div class="bg-green-100 px-3 py-1 rounded-full text-green-800 text-sm font-medium">
                                    Multi-Role Ready
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Sub-navigation -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                                <button onclick="showBankOperationSubTab('bank-management')" id="subtab-bank-management" class="bank-ops-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1a2 2 0 012 2v1a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2z"></path>
                                    </svg>
                                    ${t('sub_navigation.bank_management')}
                                </button>
                                <button onclick="showBankOperationSubTab('banking-standards')" id="subtab-banking-standards" class="bank-ops-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    ${t('sub_navigation.banking_standards')}
                                </button>
                                <button onclick="showBankOperationSubTab('market-analysis')" id="subtab-market-analysis" class="bank-ops-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    ${t('sub_navigation.market_analysis')}
                                </button>
                            </nav>
                        </div>
                        
                        <!-- Sub-tab Content -->
                        <div id="bank-operations-content" class="p-6">
                            <!-- Content will be loaded here -->
                        </div>
                    </div>
                </div>
            `;
            
            // Load default sub-tab
            showBankOperationSubTab('bank-management');
        }

        function showBankOperationSubTab(subTabName) {
            // Update sub-tab visibility
            document.querySelectorAll('.bank-ops-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeSubTab = document.getElementById(`subtab-${subTabName}`);
            if (activeSubTab) {
                activeSubTab.classList.remove('border-transparent', 'text-gray-500');
                activeSubTab.classList.add('border-indigo-500', 'text-indigo-600');
            }
            
            const contentDiv = document.getElementById('bank-operations-content');
            
            switch (subTabName) {
                case 'bank-management':
                    contentDiv.innerHTML = getBankManagementContent();
                    loadBankConfigurationData();
                    break;
                case 'banking-standards':
                    contentDiv.innerHTML = '<div class="flex justify-center items-center h-64"><div class="text-gray-500">Loading banking standards...</div></div>';
                    getBankingStandardsContent().then(content => {
                        contentDiv.innerHTML = content;
                    });
                    break;
                case 'market-analysis':
                    contentDiv.innerHTML = getMarketAnalysisContent();
                    break;
            }
        }

        function getBankManagementContent() {
            return `
                <div class="space-y-6">
                    <!-- Bank Selector -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <div class="lg:col-span-1">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h3 class="text-lg font-medium text-gray-900 mb-4">${t('forms.select_bank')}</h3>
                                <select id="bankConfigSelector" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" onchange="loadSelectedBankConfig()">
                                    <option value="">${t('forms.select_bank_option')}</option>
                                </select>
                                
                                <!-- Quick Stats -->
                                <div id="bankQuickStats" class="mt-4 space-y-2 hidden">
                                    <div class="grid grid-cols-2 gap-2">
                                        <div class="bg-white p-3 rounded border text-center">
                                            <div class="text-xs text-gray-500 cursor-help" title="${t('bank_stats.active_loans_hint') || 'Total number of approved loans currently active for this bank'}">
                                                ${t('bank_stats.active_loans') || 'Active Loans'} 
                                                <svg class="w-3 h-3 inline text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                                </svg>
                                            </div>
                                            <div class="text-lg font-bold text-indigo-600" id="activeLoanCount">-</div>
                                        </div>
                                        <div class="bg-white p-3 rounded border text-center">
                                            <div class="text-xs text-gray-500 cursor-help" title="${t('bank_stats.avg_rate_hint') || 'Weighted average interest rate across all active loans'}">
                                                ${t('bank_stats.avg_rate') || 'Average Rate'} 
                                                <svg class="w-3 h-3 inline text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                                </svg>
                                            </div>
                                            <div class="text-lg font-bold text-green-600" id="avgRate">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bank Configuration Panel -->
                        <div class="lg:col-span-3">
                            <div id="bankConfigPanel" class="hidden">
                                <!-- Configuration Tabs -->
                                <div class="bg-white rounded-lg shadow">
                                    <div class="border-b border-gray-200">
                                        <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                                            <button onclick="showBankConfigTab('configuration')" id="config-tab-configuration" class="bank-config-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                </svg>
                                                ${t('tabs.configuration')}
                                            </button>
                                            <button onclick="showBankConfigTab('interest-rates')" id="config-tab-interest-rates" class="bank-config-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                                </svg>
                                                ${t('tabs.interest_rates')}
                                            </button>
                                            <button onclick="showBankConfigTab('analytics')" id="config-tab-analytics" class="bank-config-tab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                                </svg>
                                                ${t('tabs.analytics')}
                                            </button>
                                        </nav>
                                    </div>
                                    
                                    <!-- Tab Content -->
                                    <div id="bank-config-content" class="p-6">
                                        <!-- Content will be loaded here -->
                                    </div>
                                </div>
                                
                                <!-- Save Button -->
                                <div class="mt-4 flex justify-end">
                                    <button onclick="saveBankConfiguration()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-md text-sm font-medium">
                                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
                                        </svg>
                                        ${t('buttons.save_configuration')}
                                    </button>
                                </div>
                            </div>
                            
                            <div id="noBankSelected" class="text-center py-12 text-gray-500">
                                <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1a2 2 0 012 2v1a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2z"></path>
                                </svg>
                                <p>${t('messages.select_bank_to_configure')}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        async function getBankingStandardsContent() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/banking-standards`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return BankingStandardsContent(data.data || {});
                } else {
                    // Fallback to empty standards if API fails
                    return BankingStandardsContent({});
                }
            } catch (error) {
                console.error('Error loading banking standards:', error);
                // Return a basic error message if API fails
                return BankingStandardsContent({});
            }
        }

        function getMarketAnalysisContent() {
            return `
                <div class="space-y-6">
                    <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4">
                        <div class="text-yellow-800">
                            <h3 class="font-medium">üöß Coming Soon: Market Analysis</h3>
                            <p class="text-sm mt-1">Advanced market analysis tools and competitor insights will be available in the next phase.</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Complete User Management Interface
        function showUserManagement() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Header -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900">
                                    <svg class="w-8 h-8 inline mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                    </svg>
                                    ${t('navigation.user_management')}
                                </h1>
                                <p class="text-gray-600">${t('user_management_subtitle')}</p>
                            </div>
                        </div>
                    </div>

                    <!-- User Management Sub-navigation -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                                <button onclick="showUserManagementSubTab('user-accounts')" id="user-subtab-user-accounts" class="user-mgmt-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                    ${t('sub_navigation.user_accounts')}
                                </button>
                                <button onclick="showUserManagementSubTab('security')" id="user-subtab-security" class="user-mgmt-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                                    </svg>
                                    ${t('sub_navigation.security')}
                                </button>
                                <button onclick="showUserManagementSubTab('user-analytics')" id="user-subtab-user-analytics" class="user-mgmt-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    ${t('sub_navigation.user_analytics')}
                                </button>
                            </nav>
                        </div>
                        
                        <!-- User Management Sub-tab Content -->
                        <div id="user-management-content" class="p-6">
                            <!-- Content will be loaded here -->
                        </div>
                    </div>
                </div>
            `;
            
            // Load default sub-tab
            showUserManagementSubTab('user-accounts');
        }

        function showUserManagementSubTab(subTabName) {
            // Update sub-tab visibility
            document.querySelectorAll('.user-mgmt-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeSubTab = document.getElementById(`user-subtab-${subTabName}`);
            if (activeSubTab) {
                activeSubTab.classList.remove('border-transparent', 'text-gray-500');
                activeSubTab.classList.add('border-indigo-500', 'text-indigo-600');
            }
            
            const contentDiv = document.getElementById('user-management-content');
            
            switch (subTabName) {
                case 'user-accounts':
                    contentDiv.innerHTML = getUserAccountsContent();
                    break;
                case 'security':
                    contentDiv.innerHTML = getUserSecurityContent();
                    break;
                case 'user-analytics':
                    contentDiv.innerHTML = getUserAnalyticsContent();
                    break;
            }
        }

        function getUserAccountsContent() {
            return `
                <div class="space-y-6">
                    <!-- User Account Management Header -->
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-medium text-gray-900">${t('tabs.active_users')}</h3>
                        <button onclick="addNewUser()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                            <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            ${t('add_new_user')}
                        </button>
                    </div>

                    <!-- User Roles Management -->
                    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                        <div class="lg:col-span-1">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="text-md font-medium text-gray-900 mb-3">${t('tabs.user_roles')}</h4>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between p-2 bg-white rounded border">
                                        <span class="text-sm">Business Admin</span>
                                        <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded">2</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded border">
                                        <span class="text-sm">Bank Admin</span>
                                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded">5</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded border">
                                        <span class="text-sm">Risk Manager</span>
                                        <span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded">3</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-white rounded border">
                                        <span class="text-sm">Compliance</span>
                                        <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded">2</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="lg:col-span-3">
                            <!-- Users Table -->
                            <div class="bg-white border rounded-lg overflow-hidden">
                                <div class="px-6 py-4 border-b border-gray-200">
                                    <div class="flex items-center justify-between">
                                        <h4 class="text-md font-medium text-gray-900">${t('user_list')}</h4>
                                        <div class="flex items-center space-x-3">
                                            <input type="text" placeholder="${t('search_users')}" class="px-3 py-1 border border-gray-300 rounded-md text-sm">
                                            <select class="px-3 py-1 border border-gray-300 rounded-md text-sm">
                                                <option value="">${t('all_roles')}</option>
                                                <option value="business_admin">Business Admin</option>
                                                <option value="bank_admin">Bank Admin</option>
                                                <option value="risk_manager">Risk Manager</option>
                                                <option value="compliance">Compliance</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="overflow-x-auto">
                                    <table class="min-w-full divide-y divide-gray-200">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${t('name')}</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${t('email')}</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${t('role')}</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${t('status')}</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${t('last_login')}</th>
                                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${t('actions')}</th>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="w-8 h-8 bg-indigo-100 rounded-full flex items-center justify-center">
                                                            <span class="text-indigo-600 font-medium text-sm">JD</span>
                                                        </div>
                                                        <div class="ml-3">
                                                            <div class="text-sm font-medium text-gray-900">John Doe</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">john@example.com</td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Business Admin</span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">${t('active')}</span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2 hours ago</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button onclick="editUser('john@example.com')" class="text-indigo-600 hover:text-indigo-900 mr-3">${t('edit')}</button>
                                                    <button onclick="deactivateUser('john@example.com')" class="text-red-600 hover:text-red-900">${t('deactivate')}</button>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                                            <span class="text-blue-600 font-medium text-sm">SC</span>
                                                        </div>
                                                        <div class="ml-3">
                                                            <div class="text-sm font-medium text-gray-900">Sarah Cohen</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">sarah@bankleumi.com</td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">Bank Admin</span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">${t('active')}</span>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">1 day ago</td>
                                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button onclick="editUser('sarah@bankleumi.com')" class="text-indigo-600 hover:text-indigo-900 mr-3">${t('edit')}</button>
                                                    <button onclick="deactivateUser('sarah@bankleumi.com')" class="text-red-600 hover:text-red-900">${t('deactivate')}</button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getUserSecurityContent() {
            return `
                <div class="space-y-6">
                    <!-- Security Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-red-50 p-4 rounded-lg">
                            <div class="text-red-800">
                                <h4 class="font-medium">${t('tabs.login_attempts')}</h4>
                                <div class="text-2xl font-bold mt-2">342</div>
                                <div class="text-sm mt-1">12 failed today</div>
                            </div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-blue-800">
                                <h4 class="font-medium">${t('tabs.session_management')}</h4>
                                <div class="text-2xl font-bold mt-2">24</div>
                                <div class="text-sm mt-1">Active sessions</div>
                            </div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-green-800">
                                <h4 class="font-medium">${t('tabs.two_factor_auth')}</h4>
                                <div class="text-2xl font-bold mt-2">89%</div>
                                <div class="text-sm mt-1">Adoption rate</div>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <div class="text-yellow-800">
                                <h4 class="font-medium">${t('tabs.password_policies')}</h4>
                                <div class="text-2xl font-bold mt-2">3</div>
                                <div class="text-sm mt-1">Policy violations</div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Settings -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white border rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">${t('security_settings')}</h4>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium">Require 2FA for Admin Accounts</div>
                                        <div class="text-sm text-gray-500">Force two-factor authentication for all admin users</div>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" checked class="sr-only peer">
                                        <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium">Session Timeout</div>
                                        <div class="text-sm text-gray-500">Automatically log out inactive users</div>
                                    </div>
                                    <select class="px-3 py-1 border border-gray-300 rounded-md text-sm">
                                        <option value="30">30 minutes</option>
                                        <option value="60" selected>1 hour</option>
                                        <option value="120">2 hours</option>
                                        <option value="240">4 hours</option>
                                    </select>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="font-medium">Password Complexity</div>
                                        <div class="text-sm text-gray-500">Minimum requirements for passwords</div>
                                    </div>
                                    <button class="text-indigo-600 hover:text-indigo-900 text-sm font-medium">${t('configure')}</button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white border rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">${t('recent_security_events')}</h4>
                            <div class="space-y-3">
                                <div class="flex items-start space-x-3">
                                    <div class="w-2 h-2 bg-red-500 rounded-full mt-2"></div>
                                    <div>
                                        <div class="text-sm font-medium">Failed Login Attempt</div>
                                        <div class="text-xs text-gray-500">user@suspicious.com - 5 attempts in 2 minutes</div>
                                        <div class="text-xs text-gray-400">2 minutes ago</div>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                                    <div>
                                        <div class="text-sm font-medium">Password Reset Request</div>
                                        <div class="text-xs text-gray-500">admin@example.com requested password reset</div>
                                        <div class="text-xs text-gray-400">1 hour ago</div>
                                    </div>
                                </div>
                                <div class="flex items-start space-x-3">
                                    <div class="w-2 h-2 bg-green-500 rounded-full mt-2"></div>
                                    <div>
                                        <div class="text-sm font-medium">2FA Enabled</div>
                                        <div class="text-xs text-gray-500">sarah@bankleumi.com enabled two-factor authentication</div>
                                        <div class="text-xs text-gray-400">3 hours ago</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getUserAnalyticsContent() {
            return `
                <div class="space-y-6">
                    <!-- User Analytics Overview -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white border rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">${t('tabs.usage_statistics')}</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Daily Active Users</span>
                                    <span class="font-medium">24</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Weekly Active Users</span>
                                    <span class="font-medium">67</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Monthly Active Users</span>
                                    <span class="font-medium">143</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Avg Session Duration</span>
                                    <span class="font-medium">28 min</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white border rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">${t('tabs.activity_reports')}</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Logins Today</span>
                                    <span class="font-medium">89</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Actions Performed</span>
                                    <span class="font-medium">1,234</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Data Exports</span>
                                    <span class="font-medium">12</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Config Changes</span>
                                    <span class="font-medium">7</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white border rounded-lg p-6">
                            <h4 class="text-lg font-medium text-gray-900 mb-4">${t('tabs.performance_metrics')}</h4>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Avg Response Time</span>
                                    <span class="font-medium">245ms</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Error Rate</span>
                                    <span class="font-medium">0.8%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">User Satisfaction</span>
                                    <span class="font-medium">94%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Support Tickets</span>
                                    <span class="font-medium">3</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Analytics -->
                    <div class="bg-white border rounded-lg p-6">
                        <h4 class="text-lg font-medium text-gray-900 mb-4">${t('user_activity_timeline')}</h4>
                        <div class="space-y-4">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="font-medium">Peak Usage Hours</div>
                                            <div class="text-sm text-gray-500">Most active user periods</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-medium">9:00 AM - 11:00 AM</div>
                                            <div class="text-sm text-gray-500">67% of daily activity</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <div class="font-medium">Most Active Users</div>
                                            <div class="text-sm text-gray-500">Top performers this week</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-medium">john@example.com</div>
                                            <div class="text-sm text-gray-500">89 actions performed</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showRiskCompliance() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="bg-white shadow rounded-lg p-6">
                    <div class="border-b border-gray-200 pb-4 mb-6">
                        <h2 class="text-2xl font-bold text-gray-900" data-i18n="navigation.risk_compliance">${t('navigation.risk_compliance')}</h2>
                        <p class="text-gray-600 mt-2" data-i18n="risk_compliance_subtitle">${t('risk_compliance_subtitle')}</p>
                    </div>
                    
                    <!-- Risk & Compliance Sub-navigation -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="-mb-px flex space-x-8">
                            <button id="risk-management-subtab" class="risk-compliance-subtab border-indigo-500 text-indigo-600 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" onclick="showRiskManagement()">
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span data-i18n="sub_navigation.risk_management">${t('sub_navigation.risk_management')}</span>
                            </button>
                            <button id="compliance-subtab" class="risk-compliance-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" onclick="showCompliance()">
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <span data-i18n="sub_navigation.compliance">${t('sub_navigation.compliance')}</span>
                            </button>
                            <button id="risk-analytics-subtab" class="risk-compliance-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" onclick="showRiskAnalytics()">
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                <span data-i18n="sub_navigation.analytics">${t('sub_navigation.analytics')}</span>
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Risk & Compliance Content -->
                    <div id="risk-compliance-content">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            `;
            
            // Set current main tab
            currentMainTab = 'risk_compliance';
            
            // Show default sub-tab
            showRiskManagement();
        }
        
        function showRiskManagement() {
            // Update sub-tab styling
            document.querySelectorAll('.risk-compliance-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            document.getElementById('risk-management-subtab').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById('risk-management-subtab').classList.add('border-indigo-500', 'text-indigo-600');
            
            const content = document.getElementById('risk-compliance-content');
            content.innerHTML = `
                <!-- Info Button -->
                <div class="mb-6 flex justify-end">
                    <button onclick="showRiskManagementInfo()" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        ${t('info_pages.learn_more') || 'Learn More About Risk Management'}
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Risk Models -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.risk_models">${t('tabs.risk_models')}</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg cursor-help" title="${t('risk_compliance_tooltips.credit_risk_model.description') || 'Algorithm that predicts loan default probability based on borrower financial profile'}">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-blue-900 flex items-center">
                                            ${t('risk_compliance_tooltips.credit_risk_model.title') || 'Credit Risk Model'}
                                            <svg class="w-4 h-4 ml-1 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </h4>
                                        <p class="text-sm text-blue-700" title="${t('risk_compliance_tooltips.credit_risk_model.active_status') || 'This model is currently being used for all new loan applications'}">Active ‚Ä¢ Last Updated: 2024-01-15</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-blue-900" title="${t('risk_compliance_tooltips.credit_risk_model.accuracy_hint') || 'Higher accuracy means better prediction reliability. 90%+ is excellent for banking'}">Accuracy: 94.2%</div>
                                        <div class="text-xs text-blue-700" title="${t('risk_compliance_tooltips.credit_risk_model.version_info') || 'Model version indicates algorithm updates and improvements'}">Version 2.1</div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-4 bg-yellow-50 rounded-lg cursor-help" title="${t('risk_compliance_tooltips.market_risk_model.description') || 'Predicts potential losses from market changes like interest rate fluctuations'}">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-yellow-900 flex items-center">
                                            ${t('risk_compliance_tooltips.market_risk_model.title') || 'Market Risk Model'}
                                            <svg class="w-4 h-4 ml-1 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                            </svg>
                                        </h4>
                                        <p class="text-sm text-yellow-700" title="${t('risk_compliance_tooltips.market_risk_model.review_status') || 'Model is being reviewed for potential updates or recalibration'}">Under Review ‚Ä¢ Last Updated: 2024-01-10</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-yellow-900" title="${t('risk_compliance_tooltips.market_risk_model.accuracy_hint') || 'Market models are harder to predict than credit models. 80%+ is good performance'}">Accuracy: 87.5%</div>
                                        <div class="text-xs text-yellow-700">Version 1.8</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Credit Scoring -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.credit_scoring">${t('tabs.credit_scoring')}</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded cursor-help" title="${t('risk_compliance_tooltips.credit_scoring.average_score.description') || 'Mean creditworthiness score across all current borrowers'} ‚Ä¢ ${t('risk_compliance_tooltips.credit_scoring.average_score.scale') || 'Typically ranges from 300-850. Higher scores indicate lower default risk'}">
                                <span class="text-sm font-medium flex items-center">
                                    ${t('risk_compliance_tooltips.credit_scoring.average_score.title') || 'Average Credit Score'}
                                    <svg class="w-3 h-3 ml-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </span>
                                <span class="text-lg font-bold text-green-600" title="${t('risk_compliance_tooltips.credit_scoring.average_score.benchmark') || 'Above 650 is generally considered good, above 750 is excellent'}">742</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded cursor-help" title="${t('risk_compliance_tooltips.credit_scoring.high_risk_apps.description') || 'Number of loan applications classified as high-risk requiring additional scrutiny'} ‚Ä¢ ${t('risk_compliance_tooltips.credit_scoring.high_risk_apps.action') || 'These applications require manual review and may need additional collateral'}">
                                <span class="text-sm font-medium flex items-center">
                                    ${t('risk_compliance_tooltips.credit_scoring.high_risk_apps.title') || 'High Risk Applications'}
                                    <svg class="w-3 h-3 ml-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                </span>
                                <span class="text-lg font-bold text-red-600">12.3%</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded cursor-help" title="${t('risk_compliance_tooltips.credit_scoring.score_updates.description') || 'Recent changes in borrowers credit scores affecting risk assessment'} ‚Ä¢ ${t('risk_compliance_tooltips.credit_scoring.score_updates.frequency') || 'Credit scores are typically updated monthly or quarterly'}">
                                <span class="text-sm font-medium flex items-center">
                                    ${t('risk_compliance_tooltips.credit_scoring.score_updates.title') || 'Score Updates Today'}
                                    <svg class="w-3 h-3 ml-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                </span>
                                <span class="text-lg font-bold text-blue-600">1,247</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Portfolio Analysis -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.portfolio_analysis">${t('tabs.portfolio_analysis')}</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="p-3 bg-green-50 rounded text-center cursor-help" title="${t('risk_compliance_tooltips.portfolio_analysis.total_portfolio.description') || 'Combined value of all active loans currently managed by the bank'} ‚Ä¢ ${t('risk_compliance_tooltips.portfolio_analysis.total_portfolio.importance') || 'Key indicator of banks lending volume and market presence'}">
                                    <div class="text-2xl font-bold text-green-600">‚Ç™45.2M</div>
                                    <div class="text-sm text-green-700 flex items-center justify-center">
                                        ${t('risk_compliance_tooltips.portfolio_analysis.total_portfolio.title') || 'Total Portfolio'}
                                        <svg class="w-3 h-3 ml-1 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                </div>
                                <div class="p-3 bg-blue-50 rounded text-center cursor-help" title="${t('risk_compliance_tooltips.portfolio_analysis.default_rate.description') || 'Percentage of loans currently in default (90+ days overdue or unlikely to be repaid)'} ‚Ä¢ ${t('risk_compliance_tooltips.portfolio_analysis.default_rate.healthy_range') || 'Healthy range: 1-3% for most banks. Higher rates indicate increased risk'}">
                                    <div class="text-2xl font-bold text-blue-600">2.1%</div>
                                    <div class="text-sm text-blue-700 flex items-center justify-center">
                                        ${t('risk_compliance_tooltips.portfolio_analysis.default_rate.title') || 'Default Rate'}
                                        <svg class="w-3 h-3 ml-1 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 bg-yellow-50 rounded cursor-help" title="${t('risk_compliance_tooltips.portfolio_analysis.risk_distribution.description') || 'Breakdown of loan portfolio by risk categories (Low, Medium, High risk)'} ‚Ä¢ ${t('risk_compliance_tooltips.portfolio_analysis.risk_distribution.low_risk') || 'Low Risk (65%): Borrowers with excellent credit scores and stable income'}">
                                <div class="text-sm font-medium text-yellow-800 flex items-center">
                                    ${t('risk_compliance_tooltips.portfolio_analysis.risk_distribution.title') || 'Risk Distribution'}
                                    <svg class="w-3 h-3 ml-1 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                                <div class="mt-2 space-y-1">
                                    <div class="flex justify-between text-xs" title="${t('risk_compliance_tooltips.portfolio_analysis.risk_distribution.low_risk') || 'Low Risk: Borrowers with excellent credit scores and stable income'}">
                                        <span>Low Risk</span>
                                        <span>65%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: 65%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Risk Reports -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.risk_reports">${t('tabs.risk_reports')}</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 border rounded hover:bg-gray-50 cursor-pointer" title="${t('risk_compliance_tooltips.risk_reports.daily_report.description') || 'Automated summary of daily risk metrics, portfolio changes, and alert notifications'} ‚Ä¢ ${t('risk_compliance_tooltips.risk_reports.daily_report.contents') || 'Includes new applications, payment status updates, and risk threshold breaches'}">
                                <div>
                                    <div class="font-medium flex items-center">
                                        ${t('risk_compliance_tooltips.risk_reports.daily_report.title') || 'Daily Risk Report'}
                                        <svg class="w-3 h-3 ml-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-sm text-gray-500">Generated: Today 08:00</div>
                                </div>
                                <button class="text-blue-600 hover:text-blue-800" title="Download report">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="flex items-center justify-between p-3 border rounded hover:bg-gray-50 cursor-pointer" title="${t('risk_compliance_tooltips.risk_reports.weekly_report.description') || 'Comprehensive weekly analysis of risk trends, portfolio performance, and regulatory compliance'} ‚Ä¢ ${t('risk_compliance_tooltips.risk_reports.weekly_report.strategic_value') || 'Used for strategic decision-making on lending policies and risk appetite'}">
                                <div>
                                    <div class="font-medium flex items-center">
                                        ${t('risk_compliance_tooltips.risk_reports.weekly_report.title') || 'Weekly Portfolio Summary'}
                                        <svg class="w-3 h-3 ml-1 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-sm text-gray-500">Generated: Mon 08:00</div>
                                </div>
                                <button class="text-blue-600 hover:text-blue-800" title="Download report">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showCompliance() {
            // Update sub-tab styling
            document.querySelectorAll('.risk-compliance-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            document.getElementById('compliance-subtab').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById('compliance-subtab').classList.add('border-indigo-500', 'text-indigo-600');
            
            const content = document.getElementById('risk-compliance-content');
            content.innerHTML = `
                <!-- Info Button -->
                <div class="mb-6 flex justify-end">
                    <button onclick="showComplianceInfo()" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        ${t('info_pages.learn_more_compliance') || 'Learn More About Compliance'}
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Audit Logs -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.audit_logs">${t('tabs.audit_logs')}</h3>
                        <div class="space-y-3">
                            <div class="p-3 border-l-4 border-blue-500 bg-blue-50">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="font-medium text-blue-900">User Login</div>
                                        <div class="text-sm text-blue-700">admin@bankimonline.com</div>
                                    </div>
                                    <div class="text-xs text-blue-600">2 min ago</div>
                                </div>
                            </div>
                            <div class="p-3 border-l-4 border-green-500 bg-green-50">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="font-medium text-green-900">Application Approved</div>
                                        <div class="text-sm text-green-700">ID: #12345</div>
                                    </div>
                                    <div class="text-xs text-green-600">15 min ago</div>
                                </div>
                            </div>
                            <div class="p-3 border-l-4 border-yellow-500 bg-yellow-50">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="font-medium text-yellow-900">Bank Configuration Changed</div>
                                        <div class="text-sm text-yellow-700">Bank Hapoalim rates updated</div>
                                    </div>
                                    <div class="text-xs text-yellow-600">1 hour ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Regulatory Reports -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.regulatory_reports">${t('tabs.regulatory_reports')}</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 border rounded">
                                <div>
                                    <div class="font-medium">BOI Monthly Report</div>
                                    <div class="text-sm text-gray-500">Due: End of month</div>
                                </div>
                                <span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded">Ready</span>
                            </div>
                            <div class="flex items-center justify-between p-3 border rounded">
                                <div>
                                    <div class="font-medium">ISA Compliance Report</div>
                                    <div class="text-sm text-gray-500">Due: Next week</div>
                                </div>
                                <span class="px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded">In Progress</span>
                            </div>
                            <div class="flex items-center justify-between p-3 border rounded">
                                <div>
                                    <div class="font-medium">Anti-Money Laundering</div>
                                    <div class="text-sm text-gray-500">Quarterly report</div>
                                </div>
                                <span class="px-2 py-1 text-xs font-medium bg-red-100 text-red-800 rounded">Overdue</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compliance Monitoring -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.compliance_monitoring">${t('tabs.compliance_monitoring')}</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Data Protection Compliance</span>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                    <span class="text-sm text-green-600">Compliant</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">KYC Procedures</span>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                    <span class="text-sm text-green-600">Compliant</span>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Interest Rate Regulations</span>
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                    <span class="text-sm text-yellow-600">Under Review</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Legal Documentation -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.legal_documentation">${t('tabs.legal_documentation')}</h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 border rounded hover:bg-gray-50 cursor-pointer">
                                <div>
                                    <div class="font-medium">Privacy Policy</div>
                                    <div class="text-sm text-gray-500">Last updated: 2024-01-01</div>
                                </div>
                                <button class="text-blue-600 hover:text-blue-800">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="flex items-center justify-between p-3 border rounded hover:bg-gray-50 cursor-pointer">
                                <div>
                                    <div class="font-medium">Terms of Service</div>
                                    <div class="text-sm text-gray-500">Last updated: 2024-01-01</div>
                                </div>
                                <button class="text-blue-600 hover:text-blue-800">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showRiskAnalytics() {
            // Update sub-tab styling
            document.querySelectorAll('.risk-compliance-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            document.getElementById('risk-analytics-subtab').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById('risk-analytics-subtab').classList.add('border-indigo-500', 'text-indigo-600');
            
            const content = document.getElementById('risk-compliance-content');
            content.innerHTML = `
                <!-- Info Button -->
                <div class="mb-6 flex justify-end">
                    <button onclick="showRiskAnalyticsInfo()" class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        ${t('info_pages.learn_more_analytics') || 'Learn More About Risk Analytics'}
                    </button>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Risk Analytics -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.risk_analytics">${t('tabs.risk_analytics')}</h3>
                        <div class="space-y-4">
                            <div class="grid grid-cols-3 gap-4">
                                <div class="p-3 bg-red-50 rounded text-center">
                                    <div class="text-xl font-bold text-red-600">8.2%</div>
                                    <div class="text-xs text-red-700">High Risk</div>
                                </div>
                                <div class="p-3 bg-yellow-50 rounded text-center">
                                    <div class="text-xl font-bold text-yellow-600">24.1%</div>
                                    <div class="text-xs text-yellow-700">Medium Risk</div>
                                </div>
                                <div class="p-3 bg-green-50 rounded text-center">
                                    <div class="text-xl font-bold text-green-600">67.7%</div>
                                    <div class="text-xs text-green-700">Low Risk</div>
                                </div>
                            </div>
                            <div class="p-4 bg-blue-50 rounded">
                                <div class="text-sm font-medium text-blue-900 mb-2">Risk Trend (Last 30 days)</div>
                                <div class="text-2xl font-bold text-blue-600">‚Üó +2.3%</div>
                                <div class="text-xs text-blue-700">Risk score improvement</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Compliance Metrics -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.compliance_metrics">${t('tabs.compliance_metrics')}</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Compliance Score</span>
                                <span class="text-lg font-bold text-green-600">94.7%</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Policy Violations</span>
                                <span class="text-lg font-bold text-red-600">3</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Audit Findings</span>
                                <span class="text-lg font-bold text-yellow-600">7</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Resolved Issues</span>
                                <span class="text-lg font-bold text-blue-600">142</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Trend Analysis -->
                    <div class="bg-white shadow rounded-lg p-6 lg:col-span-2">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.trend_analysis">${t('tabs.trend_analysis')}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div class="p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg">
                                <div class="text-sm font-medium text-blue-900 mb-2">Application Volume Trend</div>
                                <div class="text-2xl font-bold text-blue-600 mb-1">+12.4%</div>
                                <div class="text-xs text-blue-700">vs last month</div>
                                <div class="mt-3 text-xs text-blue-600">
                                    üìà Steady growth in applications
                                </div>
                            </div>
                            <div class="p-4 bg-gradient-to-r from-green-50 to-green-100 rounded-lg">
                                <div class="text-sm font-medium text-green-900 mb-2">Approval Rate Trend</div>
                                <div class="text-2xl font-bold text-green-600 mb-1">+3.2%</div>
                                <div class="text-xs text-green-700">vs last month</div>
                                <div class="mt-3 text-xs text-green-600">
                                    ‚úÖ Improved scoring accuracy
                                </div>
                            </div>
                            <div class="p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg">
                                <div class="text-sm font-medium text-purple-900 mb-2">Risk Distribution</div>
                                <div class="text-2xl font-bold text-purple-600 mb-1">-1.8%</div>
                                <div class="text-xs text-purple-700">high risk apps</div>
                                <div class="mt-3 text-xs text-purple-600">
                                    üéØ Better risk assessment
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showSystemSettings() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="bg-white shadow rounded-lg p-6">
                    <div class="border-b border-gray-200 pb-4 mb-6">
                        <h2 class="text-2xl font-bold text-gray-900" data-i18n="navigation.system_settings">${t('navigation.system_settings')}</h2>
                        <p class="text-gray-600 mt-2" data-i18n="system_settings_subtitle">${t('system_settings_subtitle')}</p>
                    </div>
                    
                    <!-- System Settings Sub-navigation -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="-mb-px flex space-x-8">
                            <button id="localization-subtab" class="system-settings-subtab border-indigo-500 text-indigo-600 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" onclick="showLocalization()">
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
                                </svg>
                                <span data-i18n="sub_navigation.localization">${t('sub_navigation.localization')}</span>
                            </button>
                            <button id="system-config-subtab" class="system-settings-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" onclick="showSystemConfiguration()">
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span data-i18n="sub_navigation.system_configuration">${t('sub_navigation.system_configuration')}</span>
                            </button>
                            <button id="maintenance-subtab" class="system-settings-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm" onclick="showMaintenance()">
                                <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                                </svg>
                                <span data-i18n="sub_navigation.maintenance">${t('sub_navigation.maintenance')}</span>
                            </button>
                        </nav>
                    </div>
                    
                    <!-- System Settings Content -->
                    <div id="system-settings-content">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            `;
            
            // Set current main tab
            currentMainTab = 'system_settings';
            
            // Show default sub-tab
            showLocalization();
        }
        
        function showLocalization() {
            // Update sub-tab styling
            document.querySelectorAll('.system-settings-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            document.getElementById('localization-subtab').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById('localization-subtab').classList.add('border-indigo-500', 'text-indigo-600');
            
            const content = document.getElementById('system-settings-content');
            content.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Language Settings -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.language_settings">${t('tabs.language_settings')}</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Default System Language</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="en">üá∫üá∏ English</option>
                                    <option value="he">üáÆüá± ◊¢◊ë◊®◊ô◊™ (Hebrew)</option>
                                    <option value="ru">üá∑üá∫ –†—É—Å—Å–∫–∏–π (Russian)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Available Languages</label>
                                <div class="space-y-2">
                                    <div class="flex items-center">
                                        <input type="checkbox" id="lang-en" checked class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label for="lang-en" class="ml-2 text-sm text-gray-700">üá∫üá∏ English</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="lang-he" checked class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label for="lang-he" class="ml-2 text-sm text-gray-700">üáÆüá± ◊¢◊ë◊®◊ô◊™ (Hebrew)</label>
                                    </div>
                                    <div class="flex items-center">
                                        <input type="checkbox" id="lang-ru" checked class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                        <label for="lang-ru" class="ml-2 text-sm text-gray-700">üá∑üá∫ –†—É—Å—Å–∫–∏–π (Russian)</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Currency Settings -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.currency_settings">${t('tabs.currency_settings')}</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Default Currency</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="ILS">‚Ç™ Israeli Shekel (ILS)</option>
                                    <option value="USD">$ US Dollar (USD)</option>
                                    <option value="EUR">‚Ç¨ Euro (EUR)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Currency Display Format</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="symbol">‚Ç™1,234.56</option>
                                    <option value="code">ILS 1,234.56</option>
                                    <option value="name">1,234.56 Israeli Shekel</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Number Format</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="comma">1,234.56</option>
                                    <option value="space">1 234.56</option>
                                    <option value="period">1.234,56</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Regional Settings -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.regional_settings">${t('tabs.regional_settings')}</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Default Time Zone</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="Asia/Jerusalem">Asia/Jerusalem (IST)</option>
                                    <option value="UTC">UTC</option>
                                    <option value="America/New_York">America/New_York (EST)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Date Format</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="DD/MM/YYYY">DD/MM/YYYY</option>
                                    <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">First Day of Week</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="sunday">Sunday</option>
                                    <option value="monday">Monday</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Translation Management -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.translation_management">${t('tabs.translation_management')}</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-blue-900">Translation Status</h4>
                                        <p class="text-sm text-blue-700">All languages are up to date</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-blue-900">100%</div>
                                        <div class="text-xs text-blue-700">Complete</div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">English (en.json)</span>
                                    <span class="text-sm text-green-600">‚úì 307 keys</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Hebrew (he.json)</span>
                                    <span class="text-sm text-green-600">‚úì 307 keys</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-sm">Russian (ru.json)</span>
                                    <span class="text-sm text-green-600">‚úì 307 keys</span>
                                </div>
                            </div>
                            <button class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                Export Translation Files
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showSystemConfiguration() {
            // Update sub-tab styling
            document.querySelectorAll('.system-settings-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            document.getElementById('system-config-subtab').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById('system-config-subtab').classList.add('border-indigo-500', 'text-indigo-600');
            
            const content = document.getElementById('system-settings-content');
            content.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- General Settings -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.general_settings">${t('tabs.general_settings')}</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">System Name</label>
                                <input type="text" value="BankimOnline Admin" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Session Timeout (minutes)</label>
                                <input type="number" value="30" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Max Login Attempts</label>
                                <input type="number" value="5" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="maintenance-mode" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                <label for="maintenance-mode" class="ml-2 text-sm text-gray-700">Maintenance Mode</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Email Configuration -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.email_configuration">${t('tabs.email_configuration')}</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">SMTP Server</label>
                                <input type="text" placeholder="smtp.example.com" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">SMTP Port</label>
                                <input type="number" value="587" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">From Email</label>
                                <input type="email" placeholder="noreply@bankimonline.com" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="email-enabled" checked class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                <label for="email-enabled" class="ml-2 text-sm text-gray-700">Enable Email Notifications</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- API Settings -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.api_settings">${t('tabs.api_settings')}</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">API Base URL</label>
                                <input type="url" value="http://localhost:8003" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">API Version</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="v1">v1</option>
                                    <option value="v2">v2</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Rate Limit (requests/minute)</label>
                                <input type="number" value="100" class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="api-logging" checked class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                <label for="api-logging" class="ml-2 text-sm text-gray-700">Enable API Logging</label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Integration Settings -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.integration_settings">${t('tabs.integration_settings')}</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-green-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-green-900">Bank of Israel API</h4>
                                        <p class="text-sm text-green-700">Connected ‚Ä¢ Last sync: 2 hours ago</p>
                                    </div>
                                    <div class="w-3 h-3 bg-green-500 rounded-full"></div>
                                </div>
                            </div>
                            <div class="p-4 bg-yellow-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-yellow-900">Credit Bureau API</h4>
                                        <p class="text-sm text-yellow-700">Pending ‚Ä¢ Configuration required</p>
                                    </div>
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full"></div>
                                </div>
                            </div>
                            <div class="p-4 bg-red-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-red-900">SMS Gateway</h4>
                                        <p class="text-sm text-red-700">Disconnected ‚Ä¢ Check credentials</p>
                                    </div>
                                    <div class="w-3 h-3 bg-red-500 rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showMaintenance() {
            // Update sub-tab styling
            document.querySelectorAll('.system-settings-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            document.getElementById('maintenance-subtab').classList.remove('border-transparent', 'text-gray-500');
            document.getElementById('maintenance-subtab').classList.add('border-indigo-500', 'text-indigo-600');
            
            const content = document.getElementById('system-settings-content');
            content.innerHTML = `
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- System Health -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.system_health">${t('tabs.system_health')}</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-green-50 rounded">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                    <span class="text-sm font-medium">Server Status</span>
                                </div>
                                <span class="text-sm text-green-600">Online</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-green-50 rounded">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                    <span class="text-sm font-medium">Database</span>
                                </div>
                                <span class="text-sm text-green-600">Healthy</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-yellow-50 rounded">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                    <span class="text-sm font-medium">Memory Usage</span>
                                </div>
                                <span class="text-sm text-yellow-600">78%</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-green-50 rounded">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-green-500 rounded-full mr-3"></div>
                                    <span class="text-sm font-medium">Disk Space</span>
                                </div>
                                <span class="text-sm text-green-600">45% Used</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Database Management -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.database_management">${t('tabs.database_management')}</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Total Records</span>
                                <span class="text-lg font-bold text-blue-600">12,847</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Database Size</span>
                                <span class="text-lg font-bold text-blue-600">2.3 GB</span>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Last Optimization</span>
                                <span class="text-sm text-gray-600">Yesterday</span>
                            </div>
                            <div class="space-y-2">
                                <button class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                    Optimize Database
                                </button>
                                <button class="w-full bg-gray-600 text-white py-2 px-4 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                                    Run Cleanup
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Backup & Recovery -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.backup_recovery">${t('tabs.backup_recovery')}</h3>
                        <div class="space-y-4">
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-blue-900">Last Backup</h4>
                                        <p class="text-sm text-blue-700">Today 02:00 AM ‚Ä¢ Automatic</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-sm font-medium text-blue-900">Success</div>
                                        <div class="text-xs text-blue-700">2.1 GB</div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <button class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                                    Create Backup Now
                                </button>
                                <button class="w-full bg-yellow-600 text-white py-2 px-4 rounded-md hover:bg-yellow-700 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2">
                                    Restore from Backup
                                </button>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Backup Schedule</label>
                                <select class="block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                                    <option value="daily" selected>Daily at 2:00 AM</option>
                                    <option value="weekly">Weekly on Sunday</option>
                                    <option value="monthly">Monthly on 1st</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Update Management -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4" data-i18n="tabs.update_management">${t('tabs.update_management')}</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                                <span class="text-sm font-medium">Current Version</span>
                                <span class="text-sm font-bold text-gray-900">v2.1.0</span>
                            </div>
                            <div class="p-4 bg-green-50 rounded-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-medium text-green-900">System Up to Date</h4>
                                        <p class="text-sm text-green-700">No updates available</p>
                                    </div>
                                    <svg class="w-6 h-6 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="space-y-2">
                                <button class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                                    Check for Updates
                                </button>
                                <div class="flex items-center">
                                    <input type="checkbox" id="auto-updates" class="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                    <label for="auto-updates" class="ml-2 text-sm text-gray-700">Enable Automatic Updates</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showSystemSettings() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4">
                    <div class="text-yellow-800">
                        <h3 class="font-medium">üöß Coming Soon: System Settings</h3>
                        <p class="text-sm mt-1">System configuration and maintenance tools will be available in the next phase.</p>
                    </div>
                </div>
            `;
        }

        // Info Page Functions
        function showRiskManagementInfo() {
            const content = document.getElementById('risk-compliance-content');
            content.innerHTML = `
                <div class="bg-white shadow rounded-lg p-8 max-w-4xl mx-auto">
                    <button onclick="showRiskManagement()" class="mb-6 inline-flex items-center text-sm text-gray-500 hover:text-gray-700">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        ${t('info_pages.back_to') || 'Back to'} ${t('sub_navigation.risk_management') || 'Risk Management'}
                    </button>
                    
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">${t('info_pages.risk_management.title') || 'Understanding Risk Management in Banking'}</h1>
                    
                    <div class="prose max-w-none">
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.risk_management.what_is.title') || 'What is Risk Management?'}</h2>
                        <p class="text-gray-600 mb-4">${t('info_pages.risk_management.what_is.description') || 'Risk management in banking is the process of identifying, assessing, and controlling threats to an organization\'s capital and earnings. These risks stem from various sources including financial uncertainty, legal liabilities, technology issues, strategic management errors, accidents, and natural disasters.'}</p>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.risk_management.key_components.title') || 'Key Components'}</h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-600 mb-4">
                            <li><strong>${t('info_pages.risk_management.key_components.credit_risk') || 'Credit Risk'}</strong>: ${t('info_pages.risk_management.key_components.credit_risk_desc') || 'The possibility that a borrower will fail to meet obligations in accordance with agreed terms'}</li>
                            <li><strong>${t('info_pages.risk_management.key_components.market_risk') || 'Market Risk'}</strong>: ${t('info_pages.risk_management.key_components.market_risk_desc') || 'The risk of losses in on- and off-balance sheet positions arising from movements in market prices'}</li>
                            <li><strong>${t('info_pages.risk_management.key_components.operational_risk') || 'Operational Risk'}</strong>: ${t('info_pages.risk_management.key_components.operational_risk_desc') || 'The risk of loss resulting from inadequate or failed internal processes, people, and systems'}</li>
                            <li><strong>${t('info_pages.risk_management.key_components.liquidity_risk') || 'Liquidity Risk'}</strong>: ${t('info_pages.risk_management.key_components.liquidity_risk_desc') || 'The risk that a bank cannot meet its financial obligations as they come due'}</li>
                        </ul>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.risk_management.basel_framework.title') || 'Basel Framework'}</h2>
                        <p class="text-gray-600 mb-4">${t('info_pages.risk_management.basel_framework.description') || 'The Basel Committee on Banking Supervision provides a regulatory framework for banks worldwide. Basel III, the latest framework, requires banks to maintain proper leverage ratios and meet certain minimum capital requirements.'}</p>
                        
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 my-4">
                            <p class="text-sm text-blue-700">
                                <strong>${t('info_pages.risk_management.basel_framework.example') || 'Example'}</strong>: ${t('info_pages.risk_management.basel_framework.example_desc') || 'Under Basel III, banks must maintain a minimum total capital ratio of 8% of risk-weighted assets, with at least 6% being Tier 1 capital.'}
                            </p>
                        </div>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.risk_management.best_practices.title') || 'Best Practices'}</h2>
                        <ol class="list-decimal list-inside space-y-2 text-gray-600 mb-4">
                            <li>${t('info_pages.risk_management.best_practices.item1') || 'Establish a risk management framework aligned with business objectives'}</li>
                            <li>${t('info_pages.risk_management.best_practices.item2') || 'Implement robust risk assessment and measurement tools'}</li>
                            <li>${t('info_pages.risk_management.best_practices.item3') || 'Maintain adequate capital and liquidity buffers'}</li>
                            <li>${t('info_pages.risk_management.best_practices.item4') || 'Regular stress testing and scenario analysis'}</li>
                            <li>${t('info_pages.risk_management.best_practices.item5') || 'Continuous monitoring and reporting of risk metrics'}</li>
                        </ol>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.risk_management.tools.title') || 'Common Risk Management Tools'}</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.risk_management.tools.var') || 'Value at Risk (VaR)'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.risk_management.tools.var_desc') || 'Statistical technique to measure potential loss in value of a risky asset or portfolio'}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.risk_management.tools.stress_testing') || 'Stress Testing'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.risk_management.tools.stress_testing_desc') || 'Simulation technique to evaluate how banks might cope with crisis scenarios'}</p>
                            </div>
                        </div>
                        
                                                 <h2 class="text-xl font-semibold text-gray-800 mt-8 mb-4">${t('info_pages.risk_management.detailed_models.title') || 'Detailed Risk Model Explanations'}</h2>
                         
                         <div class="space-y-6 mb-6">
                             <!-- Credit Risk Model -->
                             <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                 <h3 class="text-lg font-semibold text-blue-900 mb-3">${t('info_pages.risk_management.detailed_models.credit_risk_model.title') || 'Credit Risk Model (94.2% Accuracy)'}</h3>
                                 <div class="space-y-3 text-sm text-blue-800">
                                     <p><strong>Overview:</strong> ${t('info_pages.risk_management.detailed_models.credit_risk_model.overview') || 'Our Credit Risk Model is a sophisticated machine learning algorithm that analyzes borrower profiles to predict loan default probability.'}</p>
                                     <p><strong>How it works:</strong> ${t('info_pages.risk_management.detailed_models.credit_risk_model.how_it_works') || 'The model processes over 50 variables including credit history, income stability, debt-to-income ratios, employment history, and spending patterns to generate a risk score.'}</p>
                                     <p><strong>Accuracy:</strong> ${t('info_pages.risk_management.detailed_models.credit_risk_model.accuracy') || 'At 94.2% accuracy, this model significantly outperforms traditional credit scoring methods (typically 78-85% accuracy).'}</p>
                                     <p><strong>Input Factors:</strong> ${t('info_pages.risk_management.detailed_models.credit_risk_model.input_factors') || 'Key input factors include: FICO score, annual income, employment length, existing debt, payment history, and demographic data.'}</p>
                                     <p><strong>Business Impact:</strong> ${t('info_pages.risk_management.detailed_models.credit_risk_model.business_impact') || 'This high accuracy reduces loan defaults by 15-20% and enables more precise interest rate pricing.'}</p>
                                     <p><strong>Version Info:</strong> ${t('info_pages.risk_management.detailed_models.credit_risk_model.version_info') || 'Version 2.1 includes enhanced machine learning algorithms and expanded data sources for better prediction accuracy.'}</p>
                                 </div>
                             </div>
                             
                             <!-- Market Risk Model -->
                             <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                                 <h3 class="text-lg font-semibold text-yellow-900 mb-3">${t('info_pages.risk_management.detailed_models.market_risk_model.title') || 'Market Risk Model (87.5% Accuracy)'}</h3>
                                 <div class="space-y-3 text-sm text-yellow-800">
                                     <p><strong>Overview:</strong> ${t('info_pages.risk_management.detailed_models.market_risk_model.overview') || 'The Market Risk Model predicts potential losses from market fluctuations including interest rate changes, currency movements, and economic volatility.'}</p>
                                     <p><strong>How it works:</strong> ${t('info_pages.risk_management.detailed_models.market_risk_model.how_it_works') || 'Uses Monte Carlo simulations and historical market data to model thousands of potential scenarios and their impact on our loan portfolio.'}</p>
                                     <p><strong>Accuracy:</strong> ${t('info_pages.risk_management.detailed_models.market_risk_model.accuracy') || '87.5% accuracy is excellent for market prediction models, which are inherently more volatile than credit models.'}</p>
                                     <p><strong>Risk Factors:</strong> ${t('info_pages.risk_management.detailed_models.market_risk_model.risk_factors') || 'Monitors interest rate volatility, inflation trends, GDP growth, unemployment rates, and sector-specific economic indicators.'}</p>
                                     <p><strong>Business Impact:</strong> ${t('info_pages.risk_management.detailed_models.market_risk_model.business_impact') || 'Helps optimize portfolio allocation and hedging strategies, reducing market-related losses by 10-15%.'}</p>
                                     <p><strong>Review Status:</strong> ${t('info_pages.risk_management.detailed_models.market_risk_model.review_status') || 'Currently under review for potential updates to incorporate recent market conditions and regulatory changes.'}</p>
                                 </div>
                             </div>
                         </div>
                         
                         <h2 class="text-xl font-semibold text-gray-800 mt-8 mb-4">${t('info_pages.risk_management.detailed_scoring.title') || 'Credit Scoring System Explained'}</h2>
                         
                         <div class="space-y-6 mb-6">
                             <!-- Average Credit Score -->
                             <div class="bg-green-50 border border-green-200 rounded-lg p-6">
                                 <h3 class="text-lg font-semibold text-green-900 mb-3">${t('info_pages.risk_management.detailed_scoring.average_credit_score.title') || 'Average Credit Score: 742'}</h3>
                                 <div class="space-y-3 text-sm text-green-800">
                                     <p><strong>Explanation:</strong> ${t('info_pages.risk_management.detailed_scoring.average_credit_score.explanation') || 'Our current borrower portfolio maintains an average credit score of 742, indicating a high-quality customer base.'}</p>
                                     <p><strong>Score Ranges:</strong> ${t('info_pages.risk_management.detailed_scoring.average_credit_score.score_ranges') || 'Credit scores range from 300-850: Poor (300-579), Fair (580-669), Good (670-739), Very Good (740-799), Excellent (800-850).'}</p>
                                     <p><strong>Our Position:</strong> ${t('info_pages.risk_management.detailed_scoring.average_credit_score.our_position') || 'At 742, our average falls in the Very Good category, suggesting low default risk and high creditworthiness.'}</p>
                                     <p><strong>Calculation:</strong> ${t('info_pages.risk_management.detailed_scoring.average_credit_score.calculation') || 'Calculated as the mean score across all active borrowers, weighted by loan amounts to reflect portfolio risk.'}</p>
                                     <p><strong>Benchmark:</strong> ${t('info_pages.risk_management.detailed_scoring.average_credit_score.benchmark') || 'Industry average is typically 650-680, making our 742 score significantly above market standards.'}</p>
                                     <p><strong>Trend Analysis:</strong> ${t('info_pages.risk_management.detailed_scoring.average_credit_score.trend_analysis') || 'Score has improved 12% over the past year due to enhanced underwriting standards and economic recovery.'}</p>
                                 </div>
                             </div>
                             
                             <!-- High Risk Applications -->
                             <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                                 <h3 class="text-lg font-semibold text-red-900 mb-3">${t('info_pages.risk_management.detailed_scoring.high_risk_applications.title') || 'High Risk Applications: 12.3%'}</h3>
                                 <div class="space-y-3 text-sm text-red-800">
                                     <p><strong>Definition:</strong> ${t('info_pages.risk_management.detailed_scoring.high_risk_applications.definition') || 'Applications classified as high-risk based on our multi-factor risk assessment algorithm.'}</p>
                                     <p><strong>Threshold Criteria:</strong> ${t('info_pages.risk_management.detailed_scoring.high_risk_applications.threshold_criteria') || 'Applications with credit scores below 620, debt-to-income ratios above 45%, or unstable employment history.'}</p>
                                     <p><strong>Review Process:</strong> ${t('info_pages.risk_management.detailed_scoring.high_risk_applications.review_process') || 'These applications undergo manual review by senior underwriters and may require additional documentation or collateral.'}</p>
                                     <p><strong>Approval Rates:</strong> ${t('info_pages.risk_management.detailed_scoring.high_risk_applications.approval_rates') || 'Approximately 35% of high-risk applications are approved with modified terms (higher rates, shorter terms, additional guarantees).'}</p>
                                     <p><strong>Business Value:</strong> ${t('info_pages.risk_management.detailed_scoring.high_risk_applications.business_value') || 'This screening prevents an estimated 8-12% of potential defaults while maintaining responsible lending practices.'}</p>
                                     <p><strong>Industry Comparison:</strong> ${t('info_pages.risk_management.detailed_scoring.high_risk_applications.industry_comparison') || 'Industry average high-risk rate is 15-20%, making our 12.3% rate indicative of conservative underwriting.'}</p>
                                 </div>
                             </div>
                             
                             <!-- Score Updates -->
                             <div class="bg-purple-50 border border-purple-200 rounded-lg p-6">
                                 <h3 class="text-lg font-semibold text-purple-900 mb-3">${t('info_pages.risk_management.detailed_scoring.score_updates.title') || 'Score Updates: 1,247 Today'}</h3>
                                 <div class="space-y-3 text-sm text-purple-800">
                                     <p><strong>Explanation:</strong> ${t('info_pages.risk_management.detailed_scoring.score_updates.explanation') || 'Daily updates to borrower credit scores based on new credit bureau data and payment behavior.'}</p>
                                     <p><strong>Update Frequency:</strong> ${t('info_pages.risk_management.detailed_scoring.score_updates.update_frequency') || 'Scores are updated daily for active monitoring, with comprehensive reviews monthly.'}</p>
                                     <p><strong>Positive Changes:</strong> ${t('info_pages.risk_management.detailed_scoring.score_updates.positive_changes') || '73% of todays updates were positive, indicating improving borrower financial health.'}</p>
                                     <p><strong>Impact Assessment:</strong> ${t('info_pages.risk_management.detailed_scoring.score_updates.impact_assessment') || 'Score improvements may qualify borrowers for rate reductions or additional credit products.'}</p>
                                     <p><strong>Risk Monitoring:</strong> ${t('info_pages.risk_management.detailed_scoring.score_updates.risk_monitoring') || 'Negative score changes trigger automated alerts for portfolio risk management.'}</p>
                                     <p><strong>System Integration:</strong> ${t('info_pages.risk_management.detailed_scoring.score_updates.system_integration') || 'Updates are automatically integrated into our risk management and pricing systems for real-time decision making.'}</p>
                                 </div>
                             </div>
                         </div>
                         
                         <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4 mt-6">
                             <h3 class="font-semibold text-yellow-800 mb-2">${t('info_pages.risk_management.reference.title') || 'Learn More'}</h3>
                             <p class="text-sm text-yellow-700">${t('info_pages.risk_management.reference.description') || 'For detailed information about banking risk management standards, visit:'}</p>
                             <ul class="list-disc list-inside text-sm text-yellow-700 mt-2">
                                 <li><a href="https://www.bis.org/basel_framework/" target="_blank" class="underline">Basel Committee on Banking Supervision</a></li>
                                 <li><a href="https://www.fdic.gov/resources/bankers/risk-management/" target="_blank" class="underline">FDIC Risk Management Resources</a></li>
                             </ul>
                         </div>
                    </div>
                </div>
            `;
        }
        
        function showComplianceInfo() {
            const content = document.getElementById('risk-compliance-content');
            content.innerHTML = `
                <div class="bg-white shadow rounded-lg p-8 max-w-4xl mx-auto">
                    <button onclick="showCompliance()" class="mb-6 inline-flex items-center text-sm text-gray-500 hover:text-gray-700">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        ${t('info_pages.back_to') || 'Back to'} ${t('sub_navigation.compliance') || 'Compliance'}
                    </button>
                    
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">${t('info_pages.compliance.title') || 'Banking Compliance and Regulatory Requirements'}</h1>
                    
                    <div class="prose max-w-none">
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.compliance.what_is.title') || 'What is Banking Compliance?'}</h2>
                        <p class="text-gray-600 mb-4">${t('info_pages.compliance.what_is.description') || 'Banking compliance refers to banks adhering to laws, regulations, guidelines, and specifications relevant to their business. Compliance ensures banks operate with integrity and within legal boundaries while protecting customers and the financial system.'}</p>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.compliance.key_regulations.title') || 'Key Regulations'}</h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-600 mb-4">
                            <li><strong>${t('info_pages.compliance.key_regulations.aml') || 'Anti-Money Laundering (AML)'}</strong>: ${t('info_pages.compliance.key_regulations.aml_desc') || 'Prevents use of banking systems for money laundering activities'}</li>
                            <li><strong>${t('info_pages.compliance.key_regulations.kyc') || 'Know Your Customer (KYC)'}</strong>: ${t('info_pages.compliance.key_regulations.kyc_desc') || 'Customer identification and verification procedures'}</li>
                            <li><strong>${t('info_pages.compliance.key_regulations.gdpr') || 'Data Protection (GDPR/CCPA)'}</strong>: ${t('info_pages.compliance.key_regulations.gdpr_desc') || 'Ensures customer data privacy and protection'}</li>
                            <li><strong>${t('info_pages.compliance.key_regulations.fatca') || 'FATCA/CRS'}</strong>: ${t('info_pages.compliance.key_regulations.fatca_desc') || 'Tax compliance and reporting requirements'}</li>
                        </ul>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.compliance.compliance_program.title') || 'Compliance Program Elements'}</h2>
                        <div class="grid grid-cols-1 gap-4 mb-4">
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.compliance.compliance_program.policies') || '1. Policies and Procedures'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.compliance.compliance_program.policies_desc') || 'Written guidelines covering all aspects of regulatory requirements'}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.compliance.compliance_program.training') || '2. Training and Education'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.compliance.compliance_program.training_desc') || 'Regular staff training on compliance requirements and updates'}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.compliance.compliance_program.monitoring') || '3. Monitoring and Testing'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.compliance.compliance_program.monitoring_desc') || 'Ongoing review of compliance effectiveness and gap identification'}</p>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 my-4">
                            <p class="text-sm text-blue-700">
                                <strong>${t('info_pages.compliance.example') || 'Example'}</strong>: ${t('info_pages.compliance.example_desc') || 'A bank must file Suspicious Activity Reports (SARs) within 30 days of detecting potentially suspicious transactions, as required by the Bank Secrecy Act.'}
                            </p>
                        </div>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.compliance.consequences.title') || 'Consequences of Non-Compliance'}</h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-600 mb-4">
                            <li>${t('info_pages.compliance.consequences.fines') || 'Regulatory fines and penalties'}</li>
                            <li>${t('info_pages.compliance.consequences.reputation') || 'Reputational damage'}</li>
                            <li>${t('info_pages.compliance.consequences.license') || 'Loss of banking license'}</li>
                            <li>${t('info_pages.compliance.consequences.legal') || 'Legal action and criminal charges'}</li>
                        </ul>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4 mt-6">
                            <h3 class="font-semibold text-yellow-800 mb-2">${t('info_pages.compliance.reference.title') || 'Regulatory Resources'}</h3>
                            <ul class="list-disc list-inside text-sm text-yellow-700 mt-2">
                                <li><a href="https://www.fatf-gafi.org/" target="_blank" class="underline">Financial Action Task Force (FATF)</a></li>
                                <li><a href="https://www.ffiec.gov/" target="_blank" class="underline">Federal Financial Institutions Examination Council</a></li>
                                <li><a href="https://www.fincen.gov/" target="_blank" class="underline">Financial Crimes Enforcement Network</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function showRiskAnalyticsInfo() {
            const content = document.getElementById('risk-compliance-content');
            content.innerHTML = `
                <div class="bg-white shadow rounded-lg p-8 max-w-4xl mx-auto">
                    <button onclick="showRiskAnalytics()" class="mb-6 inline-flex items-center text-sm text-gray-500 hover:text-gray-700">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                        </svg>
                        ${t('info_pages.back_to') || 'Back to'} ${t('sub_navigation.analytics') || 'Analytics'}
                    </button>
                    
                    <h1 class="text-3xl font-bold text-gray-900 mb-6">${t('info_pages.analytics.title') || 'Risk Analytics in Modern Banking'}</h1>
                    
                    <div class="prose max-w-none">
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.analytics.what_is.title') || 'What is Risk Analytics?'}</h2>
                        <p class="text-gray-600 mb-4">${t('info_pages.analytics.what_is.description') || 'Risk analytics uses statistical models, data analysis, and machine learning to identify, measure, and predict various types of risks in banking operations. It helps banks make data-driven decisions and optimize their risk-return profile.'}</p>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.analytics.key_metrics.title') || 'Key Risk Metrics'}</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.analytics.key_metrics.pd') || 'Probability of Default (PD)'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.analytics.key_metrics.pd_desc') || 'Likelihood that a borrower will fail to repay a loan'}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.analytics.key_metrics.lgd') || 'Loss Given Default (LGD)'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.analytics.key_metrics.lgd_desc') || 'Expected loss percentage if default occurs'}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.analytics.key_metrics.ead') || 'Exposure at Default (EAD)'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.analytics.key_metrics.ead_desc') || 'Total value exposed to loss at the time of default'}</p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded">
                                <h3 class="font-semibold text-gray-800">${t('info_pages.analytics.key_metrics.el') || 'Expected Loss (EL)'}</h3>
                                <p class="text-sm text-gray-600">${t('info_pages.analytics.key_metrics.el_desc') || 'PD √ó LGD √ó EAD - Average expected loss'}</p>
                            </div>
                        </div>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.analytics.techniques.title') || 'Advanced Analytics Techniques'}</h2>
                        <ul class="list-disc list-inside space-y-2 text-gray-600 mb-4">
                            <li><strong>${t('info_pages.analytics.techniques.ml') || 'Machine Learning Models'}</strong>: ${t('info_pages.analytics.techniques.ml_desc') || 'Neural networks, random forests, and gradient boosting for credit scoring'}</li>
                            <li><strong>${t('info_pages.analytics.techniques.monte_carlo') || 'Monte Carlo Simulation'}</strong>: ${t('info_pages.analytics.techniques.monte_carlo_desc') || 'Modeling thousands of scenarios to assess portfolio risk'}</li>
                            <li><strong>${t('info_pages.analytics.techniques.behavior') || 'Behavioral Analytics'}</strong>: ${t('info_pages.analytics.techniques.behavior_desc') || 'Analyzing customer transaction patterns to detect fraud'}</li>
                            <li><strong>${t('info_pages.analytics.techniques.network') || 'Network Analysis'}</strong>: ${t('info_pages.analytics.techniques.network_desc') || 'Understanding interconnected risks in the financial system'}</li>
                        </ul>
                        
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 my-4">
                            <p class="text-sm text-blue-700">
                                <strong>${t('info_pages.analytics.example') || 'Example'}</strong>: ${t('info_pages.analytics.example_desc') || 'A bank uses machine learning to analyze 50+ variables including income, credit history, and spending patterns to predict loan default probability with 92% accuracy, compared to 78% using traditional scoring methods.'}
                            </p>
                        </div>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.analytics.implementation.title') || 'Implementation Best Practices'}</h2>
                        <ol class="list-decimal list-inside space-y-2 text-gray-600 mb-4">
                            <li>${t('info_pages.analytics.implementation.item1') || 'Ensure data quality and consistency across systems'}</li>
                            <li>${t('info_pages.analytics.implementation.item2') || 'Implement robust model validation and backtesting'}</li>
                            <li>${t('info_pages.analytics.implementation.item3') || 'Maintain model documentation and audit trails'}</li>
                            <li>${t('info_pages.analytics.implementation.item4') || 'Regular model recalibration based on new data'}</li>
                            <li>${t('info_pages.analytics.implementation.item5') || 'Balance automation with human oversight'}</li>
                        </ol>
                        
                        <h2 class="text-xl font-semibold text-gray-800 mt-6 mb-3">${t('info_pages.analytics.trends.title') || 'Future Trends'}</h2>
                        <div class="grid grid-cols-1 gap-4 mb-4">
                            <div class="bg-green-50 p-4 rounded">
                                <h3 class="font-semibold text-green-800">${t('info_pages.analytics.trends.ai') || 'AI and Deep Learning'}</h3>
                                <p class="text-sm text-green-700">${t('info_pages.analytics.trends.ai_desc') || 'Advanced AI models for real-time risk assessment and decision making'}</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded">
                                <h3 class="font-semibold text-green-800">${t('info_pages.analytics.trends.alternative_data') || 'Alternative Data Sources'}</h3>
                                <p class="text-sm text-green-700">${t('info_pages.analytics.trends.alternative_data_desc') || 'Using social media, mobile data, and IoT for enhanced risk profiling'}</p>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 border border-yellow-200 rounded-md p-4 mt-6">
                            <h3 class="font-semibold text-yellow-800 mb-2">${t('info_pages.analytics.reference.title') || 'Industry Resources'}</h3>
                            <ul class="list-disc list-inside text-sm text-yellow-700 mt-2">
                                <li><a href="https://www.garp.org/" target="_blank" class="underline">Global Association of Risk Professionals (GARP)</a></li>
                                <li><a href="https://www.rmahq.org/" target="_blank" class="underline">Risk Management Association (RMA)</a></li>
                                <li><a href="https://www.moodysanalytics.com/" target="_blank" class="underline">Moody's Analytics Risk Resources</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // Bank Configuration Functions
        async function loadBankConfigurationData() {
            try {
                const response = await fetch(`${API_BASE}/api/admin/banks`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const bankSelector = document.getElementById('bankConfigSelector');
                    bankSelector.innerHTML = `<option value="">${t('forms.select_bank_option')}</option>`;
                    
                    // Handle different possible API response structures
                    let banks = [];
                    if (data && data.data && Array.isArray(data.data)) {
                        banks = data.data; // Direct array in data.data
                    } else if (data && data.data && data.data.banks && Array.isArray(data.data.banks)) {
                        banks = data.data.banks; // Array in data.data.banks
                    } else if (data && Array.isArray(data)) {
                        banks = data; // Direct array in data
                    }
                    
                    banks.forEach(bank => {
                        const bankName = bank.name_en || bank.name || `Bank ${bank.id}`;
                        bankSelector.innerHTML += `<option value="${bank.id}">${bankName}</option>`;
                    });
                } else {
                    // Fallback to mock data if API fails
                    const bankSelector = document.getElementById('bankConfigSelector');
                    bankSelector.innerHTML = `
                        <option value="">${t('forms.select_bank_option')}</option>
                        <option value="1">Bank Hapoalim</option>
                        <option value="2">Bank Leumi</option>
                        <option value="3">Discount Bank</option>
                        <option value="4">Mizrahi Tefahot Bank</option>
                        <option value="5">First International Bank</option>
                    `;
                }
            } catch (error) {
                console.error('Error loading banks:', error);
                // Fallback to mock data on error
                const bankSelector = document.getElementById('bankConfigSelector');
                if (bankSelector) {
                    bankSelector.innerHTML = `
                        <option value="">${t('forms.select_bank_option')}</option>
                        <option value="1">Bank Hapoalim</option>
                        <option value="2">Bank Leumi</option>
                        <option value="3">Discount Bank</option>
                        <option value="4">Mizrahi Tefahot Bank</option>
                        <option value="5">First International Bank</option>
                    `;
                }
            }
        }

        async function loadSelectedBankConfig() {
            const bankId = document.getElementById('bankConfigSelector').value;
            const configPanel = document.getElementById('bankConfigPanel');
            const noSelection = document.getElementById('noBankSelected');
            
            if (bankId) {
                configPanel.classList.remove('hidden');
                noSelection.classList.add('hidden');
                showBankConfigTab('interest-rates'); // Load interest rates tab by default
                loadBankQuickStats(bankId);
                
                // Load the saved bank configuration
                await loadBankConfigurationRates(bankId);
            } else {
                configPanel.classList.add('hidden');
                noSelection.classList.remove('hidden');
                document.getElementById('bankQuickStats').classList.add('hidden');
            }
        }
        
        // New function to load bank configuration rates
        async function loadBankConfigurationRates(bankId) {
            try {
                console.log(`Loading configuration for bank ${bankId}`);
                
                const response = await fetch(`${API_BASE}/api/admin/banks/${bankId}/config`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Bank configuration loaded:', result.data);
                    
                    // Wait a moment for the DOM to be ready, then populate fields
                    setTimeout(() => {
                        const baseRateField = document.getElementById('baseRate');
                        const minRateField = document.getElementById('minRate');
                        const maxRateField = document.getElementById('maxRate');
                        
                        if (baseRateField && result.data.baseRate !== null) {
                            baseRateField.value = result.data.baseRate;
                        }
                        if (minRateField && result.data.minRate !== null) {
                            minRateField.value = result.data.minRate;
                        }
                        if (maxRateField && result.data.maxRate !== null) {
                            maxRateField.value = result.data.maxRate;
                        }
                        
                        console.log('Populated rate fields:', {
                            baseRate: result.data.baseRate,
                            minRate: result.data.minRate,
                            maxRate: result.data.maxRate
                        });
                    }, 100); // Small delay to ensure DOM is ready
                    
                } else {
                    console.log('No saved configuration found for this bank');
                }
            } catch (error) {
                console.error('Error loading bank configuration:', error);
            }
        }

        function showBankConfigTab(tabName) {
            // Update tab visibility
            document.querySelectorAll('.bank-config-tab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeTab = document.getElementById(`config-tab-${tabName}`);
            if (activeTab) {
                activeTab.classList.remove('border-transparent', 'text-gray-500');
                activeTab.classList.add('border-indigo-500', 'text-indigo-600');
            }
            
            const contentDiv = document.getElementById('bank-config-content');
            
            switch (tabName) {
                case 'configuration':
                    contentDiv.innerHTML = getBankConfigurationTabContent();
                    break;
                case 'interest-rates':
                    contentDiv.innerHTML = getInterestRatesTabContent();
                    break;
                case 'analytics':
                    contentDiv.innerHTML = getBankAnalyticsTabContent();
                    break;
            }
        }

        function getBankConfigurationTabContent() {
            return `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">${t('forms.bank_configuration.basic_info')}</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">${t('forms.bank_name')}</label>
                                <input type="text" id="bankName" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" readonly>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">${t('forms.bank_code')}</label>
                                <input type="text" id="bankCode" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">${t('forms.contact_email')}</label>
                                <input type="email" id="contactEmail" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">${t('forms.operational_settings')}</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">${t('forms.processing_fee')}</label>
                                <input type="number" id="processingFee" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">${t('forms.max_applications_per_day')}</label>
                                <input type="number" id="maxApplications" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" id="autoApproval" class="rounded border-gray-300 text-indigo-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                                <label for="autoApproval" class="ml-2 block text-sm text-gray-900">${t('forms.auto_approval')}</label>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getInterestRatesTabContent() {
            return `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">${t('forms.bank_configuration.base_rate')}</label>
                            <input type="number" step="0.01" id="baseRate" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">${t('forms.bank_configuration.min_rate')}</label>
                            <input type="number" step="0.01" id="minRate" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">${t('forms.bank_configuration.max_rate')}</label>
                            <input type="number" step="0.01" id="maxRate" class="w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="text-lg font-medium text-gray-900 mb-4">${t('forms.rate_adjustment_rules')}</h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <div class="text-sm text-gray-600 mb-4">
                                ${t('rate_rules_description')}
                            </div>
                            <button onclick="addRateRule()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-md text-sm font-medium">
                                <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                ${t('buttons.add_rule')}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function getBankAnalyticsTabContent() {
            return `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <div class="text-blue-800">
                                <h4 class="font-medium">${t('analytics.total_applications')}</h4>
                                <div class="text-2xl font-bold mt-2" id="totalApplications">-</div>
                            </div>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <div class="text-green-800">
                                <h4 class="font-medium">${t('analytics.approval_rate')}</h4>
                                <div class="text-2xl font-bold mt-2" id="approvalRate">-</div>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <div class="text-yellow-800">
                                <h4 class="font-medium">${t('analytics.avg_loan_amount')}</h4>
                                <div class="text-2xl font-bold mt-2" id="avgLoanAmount">-</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="text-gray-600">
                            üìä Advanced analytics charts and insights will be available in the next phase.
                        </div>
                    </div>
                </div>
            `;
        }

        async function loadBankQuickStats(bankId) {
            const statsDiv = document.getElementById('bankQuickStats');
            statsDiv.classList.remove('hidden');
            
            try {
                // Show loading state
                document.getElementById('activeLoanCount').textContent = '...';
                document.getElementById('avgRate').textContent = '...';
                
                // Fetch real statistics from API
                const response = await fetch(`${API_BASE}/api/admin/banks/${bankId}/stats`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch bank statistics');
                }
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    // Update active loans count
                    document.getElementById('activeLoanCount').textContent = result.data.activeLoans.toLocaleString();
                    
                    // Update average rate
                    if (result.data.avgRate !== null) {
                        document.getElementById('avgRate').textContent = `${result.data.avgRate}%`;
                    } else {
                        document.getElementById('avgRate').textContent = t('no_data') || 'No Data';
                    }
                    
                    // Add data source indicator
                    const dataSourceText = result.data.hasRealData 
                        ? `<span class="text-xs text-green-600">${t('bank_stats.real_time_data') || 'Real-time data'}</span>`
                        : `<span class="text-xs text-gray-500">${t('bank_stats.calculated_from_config') || 'Calculated from config'}</span>`;
                    
                    // Add data source indicator below stats if it doesn't exist
                    if (!document.getElementById('dataSourceIndicator')) {
                        const dataSourceDiv = document.createElement('div');
                        dataSourceDiv.id = 'dataSourceIndicator';
                        dataSourceDiv.className = 'text-center mt-2';
                        dataSourceDiv.innerHTML = dataSourceText;
                        statsDiv.appendChild(dataSourceDiv);
                    } else {
                        document.getElementById('dataSourceIndicator').innerHTML = dataSourceText;
                    }
                } else {
                    throw new Error(result.message || 'Failed to load statistics');
                }
            } catch (error) {
                console.error('Error loading bank stats:', error);
                // Fallback to static values
                document.getElementById('activeLoanCount').textContent = '0';
                document.getElementById('avgRate').textContent = 'N/A';
            }
        }

        async function saveBankConfiguration() {
            const selectedBankId = document.getElementById('bankConfigSelector').value;
            
            if (!selectedBankId) {
                alert('Please select a bank first');
                return;
            }
            
            // Collect the form data from the Interest Rates tab
            const baseRateValue = document.getElementById('baseRate')?.value;
            const minRateValue = document.getElementById('minRate')?.value;
            const maxRateValue = document.getElementById('maxRate')?.value;
            
            const configData = {
                baseRate: baseRateValue ? parseFloat(baseRateValue) : null,
                minRate: minRateValue ? parseFloat(minRateValue) : null,
                maxRate: maxRateValue ? parseFloat(maxRateValue) : null,
                lastUpdated: new Date().toISOString()
            };

            console.log('Saving bank configuration:', configData);

            try {
                // Show loading state
                const saveButton = document.querySelector('button[onclick="saveBankConfiguration()"]');
                const originalText = saveButton.innerHTML;
                saveButton.innerHTML = '<svg class="w-4 h-4 inline mr-1 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg> Saving...';
                saveButton.disabled = true;

                // Make API call to save configuration
                const response = await fetch(`${API_BASE}/api/admin/banks/${selectedBankId}/config`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify(configData)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Configuration saved successfully:', result);
                    alert('Configuration saved successfully! ‚úÖ');
                } else {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                    alert('Error saving configuration: ' + (errorData.message || 'Unknown error'));
                }
            } catch (error) {
                console.error('Network error saving configuration:', error);
                // For now, simulate successful save for development
                console.log('API not available, simulating successful save with data:', configData);
                alert('Configuration saved successfully! ‚úÖ\n(Development mode - no backend connected)');
            } finally {
                // Restore button state
                const saveButton = document.querySelector('button[onclick="saveBankConfiguration()"]');
                saveButton.innerHTML = '<svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path></svg> Save Configuration';
                saveButton.disabled = false;
            }
        }

        function addRateRule() {
            alert(t('messages.feature_coming_soon'));
        }

        // Enhanced Dashboard with Sub-tabs
        function showDashboard() {
            const content = document.getElementById('main-content');
            content.innerHTML = `
                <div class="space-y-6">
                    <!-- Header -->
                    <div class="bg-white shadow rounded-lg p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900">
                                    <svg class="w-8 h-8 inline mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    ${t('navigation.dashboard')}
                                </h1>
                                <p class="text-gray-600">${t('dashboard_subtitle')}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard Sub-navigation -->
                    <div class="bg-white shadow rounded-lg">
                        <div class="border-b border-gray-200">
                            <nav class="-mb-px flex space-x-8 px-6" aria-label="Tabs">
                                <button onclick="showDashboardSubTab('overview')" id="dashboard-subtab-overview" class="dashboard-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    ${t('tabs.overview')}
                                </button>
                                <button onclick="showDashboardSubTab('system-stats')" id="dashboard-subtab-system-stats" class="dashboard-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 00-2-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    ${t('tabs.system_stats')}
                                </button>
                                <button onclick="showDashboardSubTab('alerts')" id="dashboard-subtab-alerts" class="dashboard-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                    ${t('tabs.alerts')}
                                </button>
                                <button onclick="showDashboardSubTab('recent-activity')" id="dashboard-subtab-recent-activity" class="dashboard-subtab border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                                    <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    ${t('tabs.recent_activity')}
                                </button>
                            </nav>
                        </div>
                        
                        <!-- Dashboard Sub-tab Content -->
                        <div id="dashboard-content" class="p-6">
                            <!-- Content will be loaded here -->
                        </div>
                    </div>
                </div>
            `;
            
            // Load default sub-tab
            showDashboardSubTab('overview');
        }

        function showDashboardSubTab(subTabName) {
            // Update sub-tab visibility
            document.querySelectorAll('.dashboard-subtab').forEach(tab => {
                tab.classList.remove('border-indigo-500', 'text-indigo-600');
                tab.classList.add('border-transparent', 'text-gray-500');
            });
            
            const activeSubTab = document.getElementById(`dashboard-subtab-${subTabName}`);
            if (activeSubTab) {
                activeSubTab.classList.remove('border-transparent', 'text-gray-500');
                activeSubTab.classList.add('border-indigo-500', 'text-indigo-600');
            }
            
            const contentDiv = document.getElementById('dashboard-content');
            
            switch (subTabName) {
                case 'overview':
                    contentDiv.innerHTML = getDashboardOverviewContent();
                    break;
                case 'system-stats':
                    contentDiv.innerHTML = getDashboardSystemStatsContent();
                    break;
                case 'alerts':
                    contentDiv.innerHTML = getDashboardAlertsContent();
                    break;
                case 'recent-activity':
                    contentDiv.innerHTML = getDashboardRecentActivityContent();
                    break;
            }
        }

        function getDashboardOverviewContent() {
            return `
                <div class="space-y-6">
                    <!-- Quick Stats -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div class="bg-blue-50 p-6 rounded-lg">
                            <div class="text-blue-800">
                                <h3 class="text-lg font-medium">${t('total_clients')}</h3>
                                <p class="text-3xl font-bold mt-2">${currentStats.totalClients}</p>
                                <p class="text-sm mt-1">+12% from last month</p>
                            </div>
                        </div>
                        <div class="bg-green-50 p-6 rounded-lg">
                            <div class="text-green-800">
                                <h3 class="text-lg font-medium">${t('total_banks')}</h3>
                                <p class="text-3xl font-bold mt-2">${currentStats.totalBanks}</p>
                                <p class="text-sm mt-1">Active partnerships</p>
                            </div>
                        </div>
                        <div class="bg-yellow-50 p-6 rounded-lg">
                            <div class="text-yellow-800">
                                <h3 class="text-lg font-medium">${t('total_applications')}</h3>
                                <p class="text-3xl font-bold mt-2">${currentStats.totalApplications}</p>
                                <p class="text-sm mt-1">Processing queue</p>
                            </div>
                        </div>
                        <div class="bg-purple-50 p-6 rounded-lg">
                            <div class="text-purple-800">
                                <h3 class="text-lg font-medium">${t('total_admins')}</h3>
                                <p class="text-3xl font-bold mt-2">${currentStats.totalAdmins}</p>
                                <p class="text-sm mt-1">System administrators</p>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div class="bg-white border rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">${t('quick_actions')}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <button onclick="showMainTab('bank-operations')" class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <svg class="w-8 h-8 text-indigo-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1a2 2 0 012 2v1a2 2 0 01-2 2H9a2 2 0 01-2-2V9a2 2 0 012-2z"></path>
                                </svg>
                                <div class="text-left">
                                    <div class="font-medium">${t('manage_banks')}</div>
                                    <div class="text-sm text-gray-500">${t('configure_bank_settings')}</div>
                                </div>
                            </button>
                            <button onclick="showMainTab('applications')" class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <svg class="w-8 h-8 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                                <div class="text-left">
                                    <div class="font-medium">${t('review_applications')}</div>
                                    <div class="text-sm text-gray-500">${t('process_pending_requests')}</div>
                                </div>
                            </button>
                            <button onclick="showMainTab('user-management')" class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                <svg class="w-8 h-8 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                </svg>
                                <div class="text-left">
                                    <div class="font-medium">${t('manage_users')}</div>
                                    <div class="text-sm text-gray-500">${t('user_roles_permissions')}</div>
                                </div>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function getDashboardSystemStatsContent() {
            return `
                <div class="space-y-6">
                    <!-- System Performance -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="bg-white border rounded-lg p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">${t('system_performance')}</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm">
                                        <span>CPU Usage</span>
                                        <span>23%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                        <div class="bg-green-500 h-2 rounded-full" style="width: 23%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm">
                                        <span>Memory Usage</span>
                                        <span>67%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                        <div class="bg-yellow-500 h-2 rounded-full" style="width: 67%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm">
                                        <span>Disk Usage</span>
                                        <span>45%</span>
                                    </div>
                                    <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: 45%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white border rounded-lg p-6">
                            <h3 class="text-lg font-medium text-gray-900 mb-4">${t('database_stats')}</h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Active Connections</span>
                                    <span class="font-medium">24/100</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Query Rate</span>
                                    <span class="font-medium">1.2k/min</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Response Time</span>
                                    <span class="font-medium">85ms</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Uptime</span>
                                    <span class="font-medium">99.8%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- API Statistics -->
                    <div class="bg-white border rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">${t('api_statistics')}</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-green-600">2.4k</div>
                                <div class="text-sm text-gray-500">Successful Requests</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-red-600">12</div>
                                <div class="text-sm text-gray-500">Failed Requests</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-blue-600">156ms</div>
                                <div class="text-sm text-gray-500">Avg Response Time</div>
                            </div>
                            <div class="text-center">
                                <div class="text-2xl font-bold text-purple-600">99.5%</div>
                                <div class="text-sm text-gray-500">Uptime</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getDashboardAlertsContent() {
            return `
                <div class="space-y-6">
                    <!-- Critical Alerts -->
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6">
                        <h3 class="text-lg font-medium text-red-800 mb-4">üö® ${t('critical_alerts')}</h3>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-3">
                                <div class="w-2 h-2 bg-red-500 rounded-full mt-2"></div>
                                <div>
                                    <div class="font-medium text-red-800">High Memory Usage</div>
                                    <div class="text-sm text-red-600">Memory usage has exceeded 85% threshold</div>
                                    <div class="text-xs text-red-500 mt-1">2 minutes ago</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Warning Alerts -->
                    <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6">
                        <h3 class="text-lg font-medium text-yellow-800 mb-4">‚ö†Ô∏è ${t('warning_alerts')}</h3>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-3">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                                <div>
                                    <div class="font-medium text-yellow-800">Pending Applications</div>
                                    <div class="text-sm text-yellow-600">23 applications pending review for over 24 hours</div>
                                    <div class="text-xs text-yellow-500 mt-1">1 hour ago</div>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full mt-2"></div>
                                <div>
                                    <div class="font-medium text-yellow-800">Backup Status</div>
                                    <div class="text-sm text-yellow-600">Daily backup completed with warnings</div>
                                    <div class="text-xs text-yellow-500 mt-1">3 hours ago</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Info Alerts -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
                        <h3 class="text-lg font-medium text-blue-800 mb-4">‚ÑπÔ∏è ${t('info_alerts')}</h3>
                        <div class="space-y-3">
                            <div class="flex items-start space-x-3">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                <div>
                                    <div class="font-medium text-blue-800">System Update</div>
                                    <div class="text-sm text-blue-600">Scheduled maintenance window tonight at 2:00 AM</div>
                                    <div class="text-xs text-blue-500 mt-1">6 hours ago</div>
                                </div>
                            </div>
                            <div class="flex items-start space-x-3">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>
                                <div>
                                    <div class="font-medium text-blue-800">New Bank Partner</div>
                                    <div class="text-sm text-blue-600">FirstBank has been successfully onboarded</div>
                                    <div class="text-xs text-blue-500 mt-1">1 day ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getDashboardRecentActivityContent() {
            return `
                <div class="space-y-6">
                    <!-- Activity Timeline -->
                    <div class="bg-white border rounded-lg p-6">
                        <h3 class="text-lg font-medium text-gray-900 mb-4">${t('recent_system_activity')}</h3>
                        <div class="space-y-4">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="font-medium">Application Approved</div>
                                    <div class="text-sm text-gray-600">John Doe's mortgage application was approved by Bank Leumi</div>
                                    <div class="text-xs text-gray-500 mt-1">5 minutes ago</div>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="font-medium">New User Registration</div>
                                    <div class="text-sm text-gray-600">Sarah Cohen registered as a new customer</div>
                                    <div class="text-xs text-gray-500 mt-1">12 minutes ago</div>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="font-medium">Settings Updated</div>
                                    <div class="text-sm text-gray-600">Banking standards were updated by Admin</div>
                                    <div class="text-xs text-gray-500 mt-1">25 minutes ago</div>
                                </div>
                            </div>
                            
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center">
                                    <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.268 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                </div>
                                <div class="flex-1">
                                    <div class="font-medium">Application Rejected</div>
                                    <div class="text-sm text-gray-600">Credit application rejected due to insufficient income</div>
                                    <div class="text-xs text-gray-500 mt-1">1 hour ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize tooltip functionality
        function initializeTooltips() {
            // Create tooltip element
            const tooltip = document.createElement('div');
            tooltip.id = 'custom-tooltip';
            tooltip.style.cssText = `
                position: absolute;
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 12px;
                max-width: 300px;
                z-index: 1000;
                pointer-events: none;
                display: none;
                line-height: 1.4;
                box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            `;
            document.body.appendChild(tooltip);

            // Add tooltip event listeners to all elements with cursor-help class
            document.addEventListener('mouseover', function(e) {
                if (e.target.classList.contains('cursor-help') || e.target.closest('.cursor-help')) {
                    const element = e.target.classList.contains('cursor-help') ? e.target : e.target.closest('.cursor-help');
                    const title = element.getAttribute('title');
                    if (title) {
                        tooltip.innerHTML = title.replace(' ‚Ä¢ ', '<br/>‚Ä¢ ');
                        tooltip.style.display = 'block';
                        // Remove title to prevent default tooltip
                        element.setAttribute('data-original-title', title);
                        element.removeAttribute('title');
                    }
                }
            });

            document.addEventListener('mousemove', function(e) {
                if (tooltip.style.display === 'block') {
                    const rect = tooltip.getBoundingClientRect();
                    let left = e.pageX + 10;
                    let top = e.pageY - 30;
                    
                    // Prevent tooltip from going off-screen
                    if (left + rect.width > window.innerWidth) {
                        left = e.pageX - rect.width - 10;
                    }
                    if (top < 0) {
                        top = e.pageY + 20;
                    }
                    
                    tooltip.style.left = left + 'px';
                    tooltip.style.top = top + 'px';
                }
            });

            document.addEventListener('mouseout', function(e) {
                if (e.target.classList.contains('cursor-help') || e.target.closest('.cursor-help')) {
                    const element = e.target.classList.contains('cursor-help') ? e.target : e.target.closest('.cursor-help');
                    tooltip.style.display = 'none';
                    // Restore title attribute
                    const originalTitle = element.getAttribute('data-original-title');
                    if (originalTitle) {
                        element.setAttribute('title', originalTitle);
                        element.removeAttribute('data-original-title');
                    }
                }
            });
        }

        // Start the app - wait for i18n to be ready
        async function initApp() {
            await waitForI18n();
            checkAuth();
            initializeTooltips();
        }
        
        initApp();
    </script>
</body>
</html>