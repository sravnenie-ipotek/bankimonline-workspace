import{j as e}from"./ui-vendor-19e4e52b.js";import{k as z,f as V,r as m}from"./react-vendor-9ed0ad78.js";import{F as W,b as H,a as O,c as h,h as P}from"./form-vendor-67b0fc1d.js";import{c as Q}from"./index-40267bc7.js";import{Q as Z}from"./components-vendor-66cd084e.js";import{L as G,b as C,T as F,E as g,B as j,M as J}from"./index-0069b652.js";import{F as k}from"./FormattedInput-a21a07a2.js";import{D as K}from"./DropdownMenu-4da55dc4.js";import{b as q}from"./bankWorkerApi-8968dfd8.js";import{s as U}from"./BankWorkerRegistration.module-97297d02.js";import{u as X}from"./i18n-vendor-e8db3f4c.js";import"./state-vendor-8e443ca8.js";import"./utils-vendor-f2764326.js";import"./Control-89edf726.js";const a=Q.bind(U),Y=i=>O({fullName:h().min(2,i("validation.fullName.min")).max(100,i("validation.fullName.max")).matches(/^[\u0590-\u05FF\u0020A-Za-z\s]+$/,i("validation.fullName.format")).required(i("validation.fullName.required")),position:h().min(2,i("validation.position.min")).max(100,i("validation.position.max")).required(i("validation.position.required")),branchId:h().required(i("validation.branchId.required")),bankNumber:h().matches(/^[0-9]+$/,i("validation.bankNumber.format")).min(3,i("validation.bankNumber.min")).max(10,i("validation.bankNumber.max")).required(i("validation.bankNumber.required")),termsAccepted:P().oneOf([!0],i("validation.termsAccepted.required")).required(i("validation.termsAccepted.required"))}),be=()=>{const{token:i}=z(),N=V(),{t:s,i18n:M}=X(),[T,x]=m.useState(!0),[v,A]=m.useState(!1),[o,$]=m.useState(null),[B,L]=m.useState([]),[b,d]=m.useState(null),[S,I]=m.useState([]),[w,y]=m.useState(!1),[u,D]=m.useState(null),f=M.language||"en";m.useEffect(()=>{(async()=>{if(!i){d(s("errors.invalidToken")),x(!1);return}try{x(!0);const t=await q.getRegistrationForm(i);t.status==="success"?($(t.data.invitation),L(t.data.branches),d(null)):d(t.message||s("errors.failedToLoadForm"))}catch(t){console.error("Error loading invitation data:",t),d(t.message||s("errors.networkError"))}finally{x(!1)}})()},[i,s]);const R=async(n,{setFieldError:t,setSubmitting:p})=>{try{A(!0),I([]),d(null);const l={invitationToken:i,fullName:n.fullName.trim(),position:n.position.trim(),branchId:n.branchId,bankNumber:n.bankNumber.trim(),termsAccepted:n.termsAccepted,language:f},c=await q.completeRegistration(l);c.status==="success"?(D(c.data),y(!0),Z.success(s("registration.success.message"))):c.errors&&Array.isArray(c.errors)?(I(c.errors),c.errors.forEach(r=>{t(r.field,r.message)})):d(c.message||s("errors.registrationFailed"))}catch(l){console.error("Registration error:",l),d(l.message||s("errors.networkError"))}finally{A(!1),p(!1)}},E=()=>{y(!1),u!=null&&u.id?N(`/bank-worker/status/${u.id}`):N("/")};return T?e.jsx(G,{}):b&&!o?e.jsx(C,{children:e.jsxs("div",{className:a("errorContainer"),children:[e.jsx(F,{title:s("registration.error.title")}),e.jsx(g,{message:b}),e.jsx(j,{variant:"primary",onClick:()=>N("/"),className:a("backButton"),children:s("common.backToHome")})]})}):e.jsx(C,{children:e.jsxs("div",{className:a("registrationContainer"),children:[e.jsxs("div",{className:a("header"),children:[e.jsx(F,{title:s("registration.title"),tooltip:s("registration.tooltip")}),e.jsxs("div",{className:a("invitationInfo"),children:[e.jsx("p",{className:a("bankName"),children:o==null?void 0:o.bankName}),e.jsx("p",{className:a("email"),children:o==null?void 0:o.email})]})]}),e.jsx(W,{initialValues:{fullName:"",position:"",branchId:(o==null?void 0:o.branchId)||"",bankNumber:"",termsAccepted:!1,language:f},validationSchema:Y(s),onSubmit:R,enableReinitialize:!0,children:({values:n,errors:t,touched:p,setFieldValue:l,isSubmitting:c})=>e.jsxs(H,{className:a("form"),children:[e.jsx("div",{className:a("formField"),children:e.jsx(k,{name:"fullName",title:s("registration.fields.fullName.label"),placeholder:s("registration.fields.fullName.placeholder"),value:n.fullName,handleChange:r=>l("fullName",r),error:p.fullName&&t.fullName,tooltip:s("registration.fields.fullName.tooltip")})}),e.jsx("div",{className:a("formField"),children:e.jsx(k,{name:"position",title:s("registration.fields.position.label"),placeholder:s("registration.fields.position.placeholder"),value:n.position,handleChange:r=>l("position",r),error:p.position&&t.position,tooltip:s("registration.fields.position.tooltip")})}),e.jsx("div",{className:a("formField"),children:e.jsx(K,{name:"branchId",title:s("registration.fields.branch.label"),placeholder:s("registration.fields.branch.placeholder"),options:B.map(r=>({value:r.id,label:f==="he"?r.name_he:f==="ru"?r.name_ru:r.name_en,subtitle:`${r.branch_code} - ${r.city}`})),value:n.branchId,onChange:r=>l("branchId",r),error:p.branchId&&t.branchId,tooltip:s("registration.fields.branch.tooltip")})}),e.jsx("div",{className:a("formField"),children:e.jsx(k,{name:"bankNumber",title:s("registration.fields.bankNumber.label"),placeholder:s("registration.fields.bankNumber.placeholder"),value:n.bankNumber,handleChange:r=>l("bankNumber",r),error:p.bankNumber&&t.bankNumber,tooltip:s("registration.fields.bankNumber.tooltip")})}),e.jsxs("div",{className:a("formField","termsField"),children:[e.jsxs("label",{className:a("termsLabel"),children:[e.jsx("input",{type:"checkbox",name:"termsAccepted",checked:n.termsAccepted,onChange:r=>l("termsAccepted",r.target.checked),className:a("termsCheckbox")}),e.jsxs("span",{className:a("termsText"),children:[s("registration.fields.terms.text"),e.jsx("a",{href:"/terms",target:"_blank",className:a("termsLink"),children:s("registration.fields.terms.link")})]})]}),p.termsAccepted&&t.termsAccepted&&e.jsx(g,{message:t.termsAccepted})]}),S.length>0&&e.jsx("div",{className:a("validationErrors"),children:S.map((r,_)=>e.jsx(g,{message:r.message},_))}),b&&e.jsx("div",{className:a("errorMessage"),children:e.jsx(g,{message:b})}),e.jsx("div",{className:a("submitSection"),children:e.jsx(j,{type:"submit",variant:"primary",size:"full",disabled:v||c,className:a("submitButton"),children:s(v?"common.submitting":"registration.submit")})})]})}),e.jsx(J,{isVisible:w,title:s("registration.success.title"),onCancel:E,className:a("successModal"),children:e.jsxs("div",{className:a("successContent"),children:[e.jsx("p",{className:a("successMessage"),children:s("registration.success.description")}),e.jsxs("div",{className:a("successDetails"),children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[s("registration.success.id"),":"]})," ",u==null?void 0:u.id]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[s("registration.success.status"),":"]})," ",s("registration.success.pendingApproval")]})]}),e.jsx(j,{variant:"primary",onClick:E,className:a("successButton"),children:s("registration.success.continue")})]})})]})})};export{be as BankWorkerRegistration,be as default};
