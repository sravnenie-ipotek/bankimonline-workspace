import{j as a}from"./ui-vendor-99260b86.js";import{r as e}from"./react-vendor-21ec1e1c.js";import{a as s,c as i,f as n,F as t,b as r}from"./form-vendor-6d56d196.js";import{c as l}from"./index-bbd07903.js";import{Q as o}from"./components-vendor-62dc47c0.js";import{L as d,b as c,T as m,E as u,B as b,M as h}from"./index-062129a7.js";import{F as p}from"./FormattedInput-0a0b0810.js";import{D as v}from"./DropdownMenu-37b00287.js";import{b as _}from"./bankWorkerApi-d88e66d6.js";import{u as x}from"./i18n-vendor-18addd5f.js";import"./state-vendor-069efcec.js";import"./utils-vendor-8f040048.js";import"./Control-2a01a100.js";const j={managementContainer:"_managementContainer_63ybq_7",header:"_header_63ybq_18",tabs:"_tabs_63ybq_27",tab:"_tab_63ybq_27","tab--active":"_tab--active_63ybq_48",tabBadge:"_tabBadge_63ybq_53",tabContent:"_tabContent_63ybq_76",invitationForm:"_invitationForm_63ybq_80",form:"_form_63ybq_87",formField:"_formField_63ybq_92",fieldLabel:"_fieldLabel_63ybq_97",messageTextarea:"_messageTextarea_63ybq_102",submitButton:"_submitButton_63ybq_116",listHeader:"_listHeader_63ybq_130",refreshButton:"_refreshButton_63ybq_136",emptyState:"_emptyState_63ybq_151",invitationsTable:"_invitationsTable_63ybq_161",tableHeader:"_tableHeader_63ybq_167",tableRow:"_tableRow_63ybq_182",email:"_email_63ybq_196",bank:"_bank_63ybq_200",branch:"_branch_63ybq_203",status:"_status_63ybq_207",date:"_date_63ybq_211",statusBadge:"_statusBadge_63ybq_240","statusBadge--success":"_statusBadge--success_63ybq_249","statusBadge--warning":"_statusBadge--warning_63ybq_254","statusBadge--error":"_statusBadge--error_63ybq_259","statusBadge--neutral":"_statusBadge--neutral_63ybq_264",queueTable:"_queueTable_63ybq_270",workerCard:"_workerCard_63ybq_275",workerInfo:"_workerInfo_63ybq_289",workerName:"_workerName_63ybq_292",workerDetails:"_workerDetails_63ybq_298",workerEmail:"_workerEmail_63ybq_303",registrationDate:"_registrationDate_63ybq_308",workerActions:"_workerActions_63ybq_313",approveButton:"_approveButton_63ybq_317",rejectButton:"_rejectButton_63ybq_318",approvalModal:"_approvalModal_63ybq_338",modalContent:"_modalContent_63ybq_338",rejectionModal:"_rejectionModal_63ybq_339",modalMessage:"_modalMessage_63ybq_342",modalField:"_modalField_63ybq_349",modalTextarea:"_modalTextarea_63ybq_360",modalActions:"_modalActions_63ybq_376"},g=l.bind(j),y=({banks:e,onSubmit:l,loading:o})=>{const{t:d,i18n:c}=x(),h=s({email:i().email(d("validation.email.format")).required(d("validation.email.required")),bankId:i().required(d("validation.bankId.required")),branchId:i().required(d("validation.branchId.required")),message:i().max(500,d("validation.message.max")),expirationDays:n().min(1,d("validation.expirationDays.min")).max(30,d("validation.expirationDays.max")).required(d("validation.expirationDays.required"))});return a.jsxs("div",{className:g("invitationForm"),children:[a.jsx(m,{title:d("admin.invitation.title")}),a.jsx(t,{initialValues:{email:"",bankId:"",branchId:"",message:"",expirationDays:7},validationSchema:h,onSubmit:l,children:({values:s,errors:i,touched:n,setFieldValue:t,isSubmitting:l})=>{const m=e.find(a=>a.id===s.bankId);return a.jsxs(r,{className:g("form"),children:[a.jsx("div",{className:g("formField"),children:a.jsx(p,{name:"email",title:d("admin.invitation.fields.email.label"),placeholder:d("admin.invitation.fields.email.placeholder"),value:s.email,handleChange:a=>t("email",a),error:n.email&&i.email})}),a.jsx("div",{className:g("formField"),children:a.jsx(v,{name:"bankId",title:d("admin.invitation.fields.bank.label"),placeholder:d("admin.invitation.fields.bank.placeholder"),options:e.map(a=>({value:a.id,label:a.name})),value:s.bankId,onChange:a=>{t("bankId",a),t("branchId","")},error:n.bankId&&i.bankId})}),m&&a.jsx("div",{className:g("formField"),children:a.jsx(v,{name:"branchId",title:d("admin.invitation.fields.branch.label"),placeholder:d("admin.invitation.fields.branch.placeholder"),options:m.branches.map(a=>({value:a.id,label:"he"===c.language?a.name_he:"ru"===c.language?a.name_ru:a.name_en,subtitle:`${a.branch_code} - ${a.city}`})),value:s.branchId,onChange:a=>t("branchId",a),error:n.branchId&&i.branchId})}),a.jsx("div",{className:g("formField"),children:a.jsx(p,{name:"expirationDays",title:d("admin.invitation.fields.expirationDays.label"),placeholder:d("admin.invitation.fields.expirationDays.placeholder"),value:s.expirationDays,handleChange:a=>t("expirationDays",a),error:n.expirationDays&&i.expirationDays})}),a.jsxs("div",{className:g("formField"),children:[a.jsx("label",{className:g("fieldLabel"),children:d("admin.invitation.fields.message.label")}),a.jsx("textarea",{name:"message",placeholder:d("admin.invitation.fields.message.placeholder"),value:s.message,onChange:a=>t("message",a.target.value),className:g("messageTextarea"),rows:4}),n.message&&i.message&&a.jsx(u,{message:i.message})]}),a.jsx(b,{type:"submit",variant:"primary",size:"full",disabled:o||l,className:g("submitButton"),children:d(o?"common.sending":"admin.invitation.send")})]})}})]})},N=({invitations:e,loading:s,onRefresh:i})=>{const{t:n,i18n:t}=x(),r=e=>{const s={pending:{color:"warning",text:n("admin.status.pending")},used:{color:"success",text:n("admin.status.used")},expired:{color:"error",text:n("admin.status.expired")}}[e.toLowerCase()]||{color:"neutral",text:e};return a.jsx("span",{className:g("statusBadge",`statusBadge--${s.color}`),children:s.text})};return a.jsxs("div",{className:g("invitationsList"),children:[a.jsxs("div",{className:g("listHeader"),children:[a.jsx(m,{title:n("admin.invitations.title")}),a.jsx(b,{variant:"secondary",onClick:i,disabled:s,className:g("refreshButton"),children:n(s?"common.refreshing":"common.refresh")})]}),s?a.jsx(d,{}):0===e.length?a.jsx("div",{className:g("emptyState"),children:a.jsx("p",{children:n("admin.invitations.empty")})}):a.jsxs("div",{className:g("invitationsTable"),children:[a.jsxs("div",{className:g("tableHeader"),children:[a.jsx("span",{children:n("admin.invitations.columns.email")}),a.jsx("span",{children:n("admin.invitations.columns.bank")}),a.jsx("span",{children:n("admin.invitations.columns.status")}),a.jsx("span",{children:n("admin.invitations.columns.created")}),a.jsx("span",{children:n("admin.invitations.columns.expires")})]}),e.map(e=>a.jsxs("div",{className:g("tableRow"),children:[a.jsx("span",{className:g("email"),children:e.email}),a.jsxs("span",{className:g("bank"),children:[e.bankName,e.branchName&&a.jsxs("span",{className:g("branch"),children:[" - ",e.branchName]})]}),a.jsx("span",{className:g("status"),children:r(e.status)}),a.jsx("span",{className:g("date"),children:new Date(e.createdAt).toLocaleDateString(t.language)}),a.jsx("span",{className:g("date"),children:new Date(e.expiresAt).toLocaleDateString(t.language)})]},e.id))]})]})},f=({queue:s,loading:i,onApprove:n,onReject:t,onRefresh:r})=>{const{t:l,i18n:c}=x(),[u,p]=e.useState(null),[v,_]=e.useState(null),[j,y]=e.useState(""),[N,f]=e.useState(""),[q,k]=e.useState(!1);return a.jsxs("div",{className:g("approvalQueue"),children:[a.jsxs("div",{className:g("listHeader"),children:[a.jsx(m,{title:l("admin.approvalQueue.title")}),a.jsx(b,{variant:"secondary",onClick:r,disabled:i,className:g("refreshButton"),children:l(i?"common.refreshing":"common.refresh")})]}),i?a.jsx(d,{}):0===s.length?a.jsx("div",{className:g("emptyState"),children:a.jsx("p",{children:l("admin.approvalQueue.empty")})}):a.jsx("div",{className:g("queueTable"),children:s.map(e=>a.jsxs("div",{className:g("workerCard"),children:[a.jsxs("div",{className:g("workerInfo"),children:[a.jsx("h3",{className:g("workerName"),children:e.fullName}),a.jsxs("p",{className:g("workerDetails"),children:[e.position," • ",e.bankName," • ",e.branchName]}),a.jsx("p",{className:g("workerEmail"),children:e.email}),a.jsxs("p",{className:g("registrationDate"),children:[l("admin.approvalQueue.registeredOn"),": "," ",new Date(e.registrationDate).toLocaleDateString(c.language)]})]}),a.jsxs("div",{className:g("workerActions"),children:[a.jsx(b,{variant:"primary",onClick:()=>(async a=>{p(a),_("approve"),y("")})(e),className:g("approveButton"),children:l("admin.actions.approve")}),a.jsx(b,{variant:"secondary",onClick:()=>(async a=>{p(a),_("reject"),y(""),f("")})(e),className:g("rejectButton"),children:l("admin.actions.reject")})]})]},e.id))}),a.jsx(h,{isVisible:"approve"===v,title:l("admin.approval.title"),onCancel:()=>_(null),className:g("approvalModal"),children:a.jsxs("div",{className:g("modalContent"),children:[a.jsx("p",{className:g("modalMessage"),children:l("admin.approval.message",{name:null==u?void 0:u.fullName})}),a.jsxs("div",{className:g("modalField"),children:[a.jsxs("label",{className:g("fieldLabel"),children:[l("admin.approval.comments")," (",l("common.optional"),")"]}),a.jsx("textarea",{value:j,onChange:a=>y(a.target.value),placeholder:l("admin.approval.commentsPlaceholder"),className:g("modalTextarea"),rows:3})]}),a.jsxs("div",{className:g("modalActions"),children:[a.jsx(b,{variant:"secondary",onClick:()=>_(null),disabled:q,children:l("common.cancel")}),a.jsx(b,{variant:"primary",onClick:async()=>{if(u)try{k(!0),await n(u.id,j),_(null),p(null),o.success(l("admin.approval.success"))}catch(a){o.error(a.message||l("admin.approval.error"))}finally{k(!1)}},disabled:q,children:l(q?"common.submitting":"admin.actions.approve")})]})]})}),a.jsx(h,{isVisible:"reject"===v,title:l("admin.rejection.title"),onCancel:()=>_(null),className:g("rejectionModal"),children:a.jsxs("div",{className:g("modalContent"),children:[a.jsx("p",{className:g("modalMessage"),children:l("admin.rejection.message",{name:null==u?void 0:u.fullName})}),a.jsxs("div",{className:g("modalField"),children:[a.jsxs("label",{className:g("fieldLabel"),children:[l("admin.rejection.reason")," *"]}),a.jsx("textarea",{value:N,onChange:a=>f(a.target.value),placeholder:l("admin.rejection.reasonPlaceholder"),className:g("modalTextarea"),rows:2,required:!0})]}),a.jsxs("div",{className:g("modalField"),children:[a.jsxs("label",{className:g("fieldLabel"),children:[l("admin.rejection.comments")," (",l("common.optional"),")"]}),a.jsx("textarea",{value:j,onChange:a=>y(a.target.value),placeholder:l("admin.rejection.commentsPlaceholder"),className:g("modalTextarea"),rows:3})]}),a.jsxs("div",{className:g("modalActions"),children:[a.jsx(b,{variant:"secondary",onClick:()=>_(null),disabled:q,children:l("common.cancel")}),a.jsx(b,{variant:"primary",onClick:async()=>{if(u&&N.trim())try{k(!0),await t(u.id,N,j),_(null),p(null),o.success(l("admin.rejection.success"))}catch(a){o.error(a.message||l("admin.rejection.error"))}finally{k(!1)}},disabled:q||!N.trim(),children:l(q?"common.submitting":"admin.actions.reject")})]})]})})]})},q=()=>{const{t:s}=x(),[i,n]=e.useState("invitations"),[t,r]=e.useState([]),[l,b]=e.useState([]),[h,p]=e.useState([]),[v,j]=e.useState(!0),[q,k]=e.useState(!1),[w,C]=e.useState(!1);e.useEffect(()=>{B()},[]);const B=async()=>{try{j(!0),await Promise.all([D(),I(),S()])}catch(a){}finally{j(!1)}},D=async()=>{try{const a=await _.getBanks();"success"===a.status&&a.data&&r(a.data)}catch(a){o.error(a.message||s("errors.failedToLoadBanks"))}},I=async()=>{try{k(!0);const a=await _.getInvitations({limit:50});"success"===a.status&&a.data&&b(a.data.invitations)}catch(a){o.error(a.message||s("errors.failedToLoadInvitations"))}finally{k(!1)}},S=async()=>{try{C(!0);const a=await _.getApprovalQueue({limit:50});"success"===a.status&&a.data&&p(a.data.queue)}catch(a){o.error(a.message||s("errors.failedToLoadQueue"))}finally{C(!1)}};return v?a.jsx(d,{}):a.jsx(c,{children:a.jsxs("div",{className:g("managementContainer"),children:[a.jsx("div",{className:g("header"),children:a.jsx(m,{title:s("admin.bankWorker.title"),tooltip:s("admin.bankWorker.tooltip")})}),a.jsxs("div",{className:g("tabs"),children:[a.jsxs("button",{className:g("tab",{"tab--active":"invitations"===i}),onClick:()=>n("invitations"),children:[s("admin.tabs.invitations"),l.length>0&&a.jsx("span",{className:g("tabBadge"),children:l.length})]}),a.jsxs("button",{className:g("tab",{"tab--active":"queue"===i}),onClick:()=>n("queue"),children:[s("admin.tabs.approvalQueue"),h.length>0&&a.jsx("span",{className:g("tabBadge"),children:h.length})]})]}),a.jsx("div",{className:g("tabContent"),children:"invitations"===i?a.jsxs("div",{className:g("invitationsTab"),children:[a.jsx(y,{banks:t,onSubmit:async a=>{try{const e=await _.sendInvitation(a);if("success"!==e.status)throw new u(e.message);o.success(s("admin.invitation.success")),await I()}catch(e){throw e}},loading:q}),a.jsx(N,{invitations:l,loading:q,onRefresh:I})]}):a.jsx("div",{className:g("queueTab"),children:a.jsx(f,{queue:h,loading:w,onApprove:async(a,e)=>{await _.approveWorker(a,e),await S()},onReject:async(a,e,s)=>{await _.rejectWorker(a,e,s),await S()},onRefresh:S})})})]})})};export{q as BankWorkerManagement,q as default};
