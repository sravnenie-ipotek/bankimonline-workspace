var M=Object.defineProperty;var q=(e,r,t)=>r in e?M(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var C=(e,r,t)=>(q(e,typeof r!="symbol"?r+"":r,t),t);import{r as a}from"./react-vendor-9ed0ad78.js";import{u as F}from"./i18n-vendor-e8db3f4c.js";class G{constructor(){C(this,"cache",new Map);C(this,"TTL",5*60*1e3)}set(r,t){const d=Date.now();this.cache.set(r,{data:t,timestamp:d,expires:d+this.TTL})}get(r){const t=this.cache.get(r);return t?Date.now()>t.expires?(this.cache.delete(r),null):t.data:null}clear(){this.cache.clear()}size(){return this.cache.size}}const _=new G,X=(e,r,t="options")=>{const{i18n:d}=F(),[T,y]=a.useState(!0),[p,w]=a.useState(null),[i,g]=a.useState({options:[],placeholder:void 0,label:void 0,loading:!0,error:null}),s=a.useRef(null),v=d.language||"en",n=a.useCallback(async()=>{var c,u,D,K,P,k,x,S,m,j;try{y(!0),w(null),s.current&&s.current.abort(),s.current=new AbortController;const h=`dropdown_${e}_${v}`,E=_.get(h);let o;if(E)o=E;else{const f=await fetch(`/api/dropdowns/${e}/${v}`,{signal:s.current.signal});if(!f.ok)throw new Error(`HTTP ${f.status}: ${f.statusText}`);if(o=await f.json(),o.status!=="success")throw new Error(`API Error: ${o.status}`);_.set(h,o)}let b=`${e}_${r}`,I=`${b}_ph`,R=`${b}_label`,A=((c=o.options)==null?void 0:c[b])||[],O=((u=o.placeholders)==null?void 0:u[I])||((D=o.placeholders)==null?void 0:D[b]),z=((K=o.labels)==null?void 0:K[R])||((P=o.labels)==null?void 0:P[b]);if(A.length===0){const f=r==="field_of_activity"?"activity":r==="activity"?"field_of_activity":null;if(f){const $=`${e}_${f}`,H=`${$}_ph`,U=`${$}_label`,B=((k=o.options)==null?void 0:k[$])||[];B.length>0&&(b=$,I=H,R=U,A=B,O=((x=o.placeholders)==null?void 0:x[H])||((S=o.placeholders)==null?void 0:S[$]),z=((m=o.labels)==null?void 0:m[U])||((j=o.labels)==null?void 0:j[$]))}}g({options:A,placeholder:O,label:z,loading:!1,error:null})}catch(h){if(h.name==="AbortError")return;console.warn(`❌ Dropdown API error for ${e}/${r}:`,h);const E=h instanceof Error?h:new Error("Unknown error");w(E),g({options:[],placeholder:void 0,label:void 0,loading:!1,error:E})}finally{y(!1),s.current=null}},[e,r,v]);a.useEffect(()=>(n(),()=>{s.current&&s.current.abort()}),[n]);const l={...i,loading:T,error:p};return t==="options"&&!T&&!p?l.options:l},Y=e=>{const{i18n:r}=F(),[t,d]=a.useState(!0),[T,y]=a.useState(null),[p,w]=a.useState(null),i=a.useRef(null),g=r.language||"en",s=a.useCallback(async()=>{try{d(!0),y(null),i.current&&i.current.abort(),i.current=new AbortController;const n=`dropdown_${e}_${g}`,l=_.get(n);if(l){w(l);return}const c=await fetch(`/api/dropdowns/${e}/${g}`,{signal:i.current.signal});if(!c.ok)throw new Error(`HTTP ${c.status}: ${c.statusText}`);const u=await c.json();if(u.status!=="success")throw new Error(`API Error: ${u.status}`);_.set(n,u),w(u)}catch(n){if(n.name==="AbortError")return;console.warn(`❌ Bulk dropdown API error for ${e}:`,n);const l=n instanceof Error?n:new Error("Unknown error");y(l),w(null)}finally{d(!1),i.current=null}},[e,g]);return a.useEffect(()=>(s(),()=>{i.current&&i.current.abort()}),[s]),{data:p,loading:t,error:T,getDropdownProps:n=>{var c,u,D;if(!p)return{options:[],placeholder:void 0,label:void 0};const l=`${e}_${n}`;return{options:((c=p.options)==null?void 0:c[l])||[],placeholder:(u=p.placeholders)==null?void 0:u[l],label:(D=p.labels)==null?void 0:D[l]}},refresh:s,clearCache:()=>_.clear()}};export{X as a,Y as u};
