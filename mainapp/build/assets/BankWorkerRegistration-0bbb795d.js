import{j as e}from"./ui-vendor-99260b86.js";import{k as s,f as a,r as i}from"./react-vendor-21ec1e1c.js";import{F as r,b as t,a as n,c as l,h as o}from"./form-vendor-6d56d196.js";import{c as m}from"./index-be42ab03.js";import{Q as c}from"./components-vendor-62dc47c0.js";import{L as d,b as u,T as p,E as h,B as b,M as f}from"./index-73dd41d9.js";import{F as g}from"./FormattedInput-8631259e.js";import{D as N}from"./DropdownMenu-9b978d84.js";import{b as j}from"./bankWorkerApi-cec77c3a.js";import{s as v}from"./BankWorkerRegistration.module-bf3f0170.js";import{u as x}from"./i18n-vendor-18addd5f.js";import"./state-vendor-069efcec.js";import"./utils-vendor-8f040048.js";import"./Control-99ce6a52.js";const k=m.bind(v),A=e=>n({fullName:l().min(2,e("validation.fullName.min")).max(100,e("validation.fullName.max")).matches(/^[\u0590-\u05FF\u0020A-Za-z\s]+$/,e("validation.fullName.format")).required(e("validation.fullName.required")),position:l().min(2,e("validation.position.min")).max(100,e("validation.position.max")).required(e("validation.position.required")),branchId:l().required(e("validation.branchId.required")),bankNumber:l().matches(/^[0-9]+$/,e("validation.bankNumber.format")).min(3,e("validation.bankNumber.min")).max(10,e("validation.bankNumber.max")).required(e("validation.bankNumber.required")),termsAccepted:o().oneOf([!0],e("validation.termsAccepted.required")).required(e("validation.termsAccepted.required"))}),F=()=>{const{token:n}=s(),l=a(),{t:o,i18n:m}=x(),[v,F]=i.useState(!0),[y,C]=i.useState(!1),[I,S]=i.useState(null),[q,E]=i.useState([]),[w,B]=i.useState(null),[T,M]=i.useState([]),[$,_]=i.useState(!1),[L,R]=i.useState(null),z=m.language||"en";i.useEffect(()=>{(async()=>{if(!n)return B(o("errors.invalidToken")),void F(!1);try{F(!0);const e=await j.getRegistrationForm(n);"success"===e.status?(S(e.data.invitation),E(e.data.branches),B(null)):B(e.message||o("errors.failedToLoadForm"))}catch(e){B(e.message||o("errors.networkError"))}finally{F(!1)}})()},[n,o]);const D=()=>{_(!1),(null==L?void 0:L.id)?l(`/bank-worker/status/${L.id}`):l("/")};return v?e.jsx(d,{}):w&&!I?e.jsx(u,{children:e.jsxs("div",{className:k("errorContainer"),children:[e.jsx(p,{title:o("registration.error.title")}),e.jsx(h,{message:w}),e.jsx(b,{variant:"primary",onClick:()=>l("/"),className:k("backButton"),children:o("common.backToHome")})]})}):e.jsx(u,{children:e.jsxs("div",{className:k("registrationContainer"),children:[e.jsxs("div",{className:k("header"),children:[e.jsx(p,{title:o("registration.title"),tooltip:o("registration.tooltip")}),e.jsxs("div",{className:k("invitationInfo"),children:[e.jsx("p",{className:k("bankName"),children:null==I?void 0:I.bankName}),e.jsx("p",{className:k("email"),children:null==I?void 0:I.email})]})]}),e.jsx(r,{initialValues:{fullName:"",position:"",branchId:(null==I?void 0:I.branchId)||"",bankNumber:"",termsAccepted:!1,language:z},validationSchema:A(o),onSubmit:async(e,{setFieldError:s,setSubmitting:a})=>{try{C(!0),M([]),B(null);const a={invitationToken:n,fullName:e.fullName.trim(),position:e.position.trim(),branchId:e.branchId,bankNumber:e.bankNumber.trim(),termsAccepted:e.termsAccepted,language:z},i=await j.completeRegistration(a);"success"===i.status?(R(i.data),_(!0),c.success(o("registration.success.message"))):i.errors&&Array.isArray(i.errors)?(M(i.errors),i.errors.forEach(e=>{s(e.field,e.message)})):B(i.message||o("errors.registrationFailed"))}catch(i){B(i.message||o("errors.networkError"))}finally{C(!1),a(!1)}},enableReinitialize:!0,children:({values:s,errors:a,touched:i,setFieldValue:r,isSubmitting:n})=>e.jsxs(t,{className:k("form"),children:[e.jsx("div",{className:k("formField"),children:e.jsx(g,{name:"fullName",title:o("registration.fields.fullName.label"),placeholder:o("registration.fields.fullName.placeholder"),value:s.fullName,handleChange:e=>r("fullName",e),error:i.fullName&&a.fullName,tooltip:o("registration.fields.fullName.tooltip")})}),e.jsx("div",{className:k("formField"),children:e.jsx(g,{name:"position",title:o("registration.fields.position.label"),placeholder:o("registration.fields.position.placeholder"),value:s.position,handleChange:e=>r("position",e),error:i.position&&a.position,tooltip:o("registration.fields.position.tooltip")})}),e.jsx("div",{className:k("formField"),children:e.jsx(N,{name:"branchId",title:o("registration.fields.branch.label"),placeholder:o("registration.fields.branch.placeholder"),options:q.map(e=>({value:e.id,label:"he"===z?e.name_he:"ru"===z?e.name_ru:e.name_en,subtitle:`${e.branch_code} - ${e.city}`})),value:s.branchId,onChange:e=>r("branchId",e),error:i.branchId&&a.branchId,tooltip:o("registration.fields.branch.tooltip")})}),e.jsx("div",{className:k("formField"),children:e.jsx(g,{name:"bankNumber",title:o("registration.fields.bankNumber.label"),placeholder:o("registration.fields.bankNumber.placeholder"),value:s.bankNumber,handleChange:e=>r("bankNumber",e),error:i.bankNumber&&a.bankNumber,tooltip:o("registration.fields.bankNumber.tooltip")})}),e.jsxs("div",{className:k("formField","termsField"),children:[e.jsxs("label",{className:k("termsLabel"),children:[e.jsx("input",{type:"checkbox",name:"termsAccepted",checked:s.termsAccepted,onChange:e=>r("termsAccepted",e.target.checked),className:k("termsCheckbox")}),e.jsxs("span",{className:k("termsText"),children:[o("registration.fields.terms.text"),e.jsx("a",{href:"/terms",target:"_blank",className:k("termsLink"),children:o("registration.fields.terms.link")})]})]}),i.termsAccepted&&a.termsAccepted&&e.jsx(h,{message:a.termsAccepted})]}),T.length>0&&e.jsx("div",{className:k("validationErrors"),children:T.map((s,a)=>e.jsx(h,{message:s.message},a))}),w&&e.jsx("div",{className:k("errorMessage"),children:e.jsx(h,{message:w})}),e.jsx("div",{className:k("submitSection"),children:e.jsx(b,{type:"submit",variant:"primary",size:"full",disabled:y||n,className:k("submitButton"),children:o(y?"common.submitting":"registration.submit")})})]})}),e.jsx(f,{isVisible:$,title:o("registration.success.title"),onCancel:D,className:k("successModal"),children:e.jsxs("div",{className:k("successContent"),children:[e.jsx("p",{className:k("successMessage"),children:o("registration.success.description")}),e.jsxs("div",{className:k("successDetails"),children:[e.jsxs("p",{children:[e.jsxs("strong",{children:[o("registration.success.id"),":"]})," ",null==L?void 0:L.id]}),e.jsxs("p",{children:[e.jsxs("strong",{children:[o("registration.success.status"),":"]})," ",o("registration.success.pendingApproval")]})]}),e.jsx(b,{variant:"primary",onClick:D,className:k("successButton"),children:o("registration.success.continue")})]})})]})})};export{F as BankWorkerRegistration,F as default};
