var t=Object.defineProperty,e=(e,a,r)=>(((e,a,r)=>{a in e?t(e,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[a]=r})(e,"symbol"!=typeof a?a+"":a,r),r);import{j as a}from"./ui-vendor-99260b86.js";import{M as r}from"./AddButton-af8674b6.js";import{u as n}from"./i18n-vendor-18addd5f.js";const s=new class{constructor(){e(this,"cache",new Map),e(this,"CACHE_DURATION",3e5)}getApiBaseUrl(){return"/api"}async fetchCalculationParameters(t="mortgage"){const e=t,a=this.cache.get(e);if(a&&Date.now()<a.expiry)return a.data;try{const a=await fetch(`${this.getApiBaseUrl()}/v1/calculation-parameters?business_path=${t}`),r=await a.json();if("success"===r.status||"error"===r.status&&r.data)return this.cache.set(e,{data:r.data,expiry:Date.now()+this.CACHE_DURATION}),r.data.is_fallback,r.data;throw new Error(r.message||"Failed to fetch calculation parameters")}catch(r){return{business_path:t,current_interest_rate:t.includes("credit")?8.5:5,property_ownership_ltvs:{no_property:{ltv:75,min_down_payment:25},has_property:{ltv:50,min_down_payment:50},selling_property:{ltv:70,min_down_payment:30}},standards:{},last_updated:(new Date).toISOString(),is_fallback:!0}}}async getCurrentRate(t="mortgage"){return(await this.fetchCalculationParameters(t)).current_interest_rate}async getPropertyOwnershipLtv(t,e="mortgage"){const a=(await this.fetchCalculationParameters(e)).property_ownership_ltvs[t];return a?a.ltv:50}async getStandardValue(t,e,a="mortgage"){var r,n,s;const i=null==(s=null==(n=null==(r=(await this.fetchCalculationParameters(a)).standards)?void 0:r[t])?void 0:n[e])?void 0:s.value;if(void 0===i){const a=this.getEmergencyFallback(t,e);return null!==a?a:0}return i}async calculateMortgagePayment(t,e,a,r){return((t,e,a,r)=>{if(null===t)return 1;if(null===e)return 1;if(a<=0||t<=0||r<=0)return 0;if(e>=t)return 0;const n=t-e,s=r/12/100,i=Math.pow(1+s,12*a),c=n*s*i/(i-1);return Math.trunc(c)})(t,e,a,r||await this.getCurrentRate("mortgage"))}async calculateCreditPayment(t,e,a){return((t,e,a)=>{const r=12*e,n=a/12/100,s=n*(1+n)**r/((1+n)**r-1);return Math.ceil(t*s)})(t,e,a||await this.getCurrentRate("credit"))}async calculateRemainingMortgage(t,e,a){return((t,e,a)=>{if(null===t)return 0;if(t<=0||e<=0||a<=0)return 0;const r=t*(1+a*e/100);return Math.trunc(r)})(t,e,a||await this.getCurrentRate("mortgage"))}async calculateLoanPeriod(t,e,a,r){return((t,e,a,r)=>{if(null===t)return 1;if(null===e)return 1;const n=t-e,s=r/12/100;if(n<=0||s<=0||a<=0)return 0;const i=Math.log(a/(a-n*s))/Math.log(1+s)/12;return Math.trunc(i)})(t,e,a,r||await this.getCurrentRate("mortgage"))}getEmergencyFallback(t,e){var a;return(null==(a={ltv:{max_ltv:80,standard_ltv_max:80},dti:{max_dti:42,front_end_dti_max:28,back_end_dti_max:42},credit_score:{minimum_credit_score:620,min_credit_score:620},loan_terms:{min_years:4,max_years:30}}[t])?void 0:a[e])||null}clearCache(){this.cache.clear()}async getAllParameters(t="mortgage"){return this.fetchCalculationParameters(t)}},i=()=>{const{t:t,i18n:e}=n();return a.jsx(r,{children:t("calculate_mortgage_ctx_1")})};export{i as I,s as c};
