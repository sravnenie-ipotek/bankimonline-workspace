import{j as e}from"./ui-vendor-19e4e52b.js";import{r as F,f as K,b as ye,j as xe,k as Fe}from"./react-vendor-9ed0ad78.js";import{E as N,a as G,D as z,b as ne,A as ve,T as we,L as Ie}from"./index-3333763f.js";import{P as qe}from"./ProgressBar-f8ded9a7.js";import{c as Me,u as j,a as U,k as ie,l as T,m as Ce,d as Ee,n,p as Ne,q as Be,r as De,t as Ae,v as Le,w as Te,x as ke,y as Ye,z as Ve,A as je,B as Re,N as $e}from"./index-6e45afc9.js";import{u as te,F as ae,b as se,a as ee,f as B,c as m,g as be}from"./form-vendor-67b0fc1d.js";import{V as ze}from"./VideoPoster-36364f6b.js";import{S as ue,a as Ue,M as We,U as He,A as Ke,F as Ge,B as Je,b as Qe,c as Xe,O as Ze}from"./SourceOfIncomeModal-2f50d7a8.js";import{M as et,U as H,A as re}from"./AddButton-23292c66.js";import{u as k}from"./i18n-vendor-e8db3f4c.js";import{I as tt,c as $}from"./IncreasePayment-cbf5fc51.js";import{C as c}from"./Column-a8ef8409.js";import{R as w}from"./Row-389aebbb.js";import{D as X}from"./DropdownMenu-dc5040a3.js";import{F as rt}from"./FormattedInput-a9b4c8dd.js";import{F as le}from"./FormCaption-192297af.js";import{F as ce}from"./FormContainer-e92386a0.js";import{u as ot}from"./useDropdownData-05964376.js";import{D as he}from"./DoubleButtons-a5f374ca.js";import{R as it}from"./RowTwo-b38b6984.js";import{B as nt,P as at,A as st}from"./PartnerPayMortgage-ee8f6548.js";import{N as lt,B as ct,E as dt,A as mt,T as pt,C as ut,M as ht,I as _t,P as gt}from"./Taxes-97e3a2c4.js";import{C as ft,a as yt,H as xt}from"./HowMuchChildrens-9499306b.js";import{F as wt}from"./FamilyStatus-c8680f7f.js";import{I as jt}from"./Info-52842d63.js";import{M as bt,A as Pt,a as Ot,O as St,c as Pe,g as Ft,b as me}from"./componentsByIncomeSource-dc390bb7.js";import"./components-vendor-66cd084e.js";import"./utils-vendor-f2764326.js";import"./state-vendor-8e443ca8.js";import"./MortgageParameters-5c900b37.js";import"./PercentIcon-65a66346.js";import"./Control-ea4fbaf0.js";import"./Calendar-bb4f5a89.js";import"./ShieldCheckIcon-7bae9c5d.js";const vt="_image_1435f_1",It={image:vt,"inner-div":"_inner-div_1435f_8","bold-text":"_bold-text_1435f_16"},oe=Me.bind(It),qt=()=>{const{t,i18n:o}=k(),{values:r}=te(),a=(r.priceOfEstate-r.initialFee).toLocaleString("en-US"),p=Math.trunc((r.priceOfEstate-r.initialFee)/r.priceOfEstate*100);return e.jsxs(et,{style:{marginTop:"2px"},children:[e.jsx("span",{className:oe("margin-sides"),children:t("calc_mortrage_subtext_1")}),e.jsxs("b",{className:oe("bold-text"),children:[a," ₪"]}),e.jsx("br",{}),e.jsx("span",{className:oe("margin-sides"),children:t("calc_mortrage_subtext_3")}),e.jsxs("b",{className:oe("bold-text"),children:[isNaN(p)||p<0?0:p,"%"]})]})};function Mt(){const[t,o]=F.useState(51130),[r,a]=F.useState(2654),[p,d]=F.useState({min:4,max:30}),{t:u,i18n:h}=k(),{setFieldValue:E,values:_,errors:v}=te(),b=j(P=>P.activeField),C=U();F.useEffect(()=>{(async()=>{var g,I,y,l,f,O;try{const x=await $.getAllParameters("mortgage"),S=((y=(I=(g=x.standards)==null?void 0:g.loan_terms)==null?void 0:I.min_years)==null?void 0:y.value)||4,A=((O=(f=(l=x.standards)==null?void 0:l.loan_terms)==null?void 0:f.max_years)==null?void 0:O.value)||30;d({min:S,max:A})}catch(x){console.error("❌ Error fetching loan term limits:",x)}})()},[]);const Y=P=>{C(ie("period")),E("period",P)},D=P=>{C(ie("monthlyPayment")),E("monthlyPayment",P)};return F.useEffect(()=>{(async()=>{try{if(b==="period"){const g=await $.calculateMortgagePayment(_.priceOfEstate,_.initialFee,_.period);Number.isNaN(g)||E("monthlyPayment",g)}else{const g=await $.calculateLoanPeriod(_.priceOfEstate,_.initialFee,_.monthlyPayment);Number.isNaN(g)||E("period",g)}}catch(g){console.error("❌ Error calculating mortgage values:",g)}})()},[b,E,_.initialFee,_.monthlyPayment,_.period,_.priceOfEstate]),F.useLayoutEffect(()=>{(async()=>{var g,I,y,l,f,O;try{const x=await $.calculateMortgagePayment(_.priceOfEstate,_.initialFee,p.min),S=await $.calculateMortgagePayment(_.priceOfEstate,_.initialFee,p.max);Number.isNaN(x)||o(x),x===0&&o(1),Number.isNaN(S)||a(S)}catch(x){console.error("❌ Error calculating payment limits:",x);try{const S=await $.getAllParameters("mortgage"),A=((y=(I=(g=S.standards)==null?void 0:g.payment_limits)==null?void 0:I.default_max)==null?void 0:y.value)||51130,s=((O=(f=(l=S.standards)==null?void 0:l.payment_limits)==null?void 0:f.default_min)==null?void 0:O.value)||2654;o(A),a(s)}catch(S){console.error("❌ Even database fallback failed:",S),o(51130),a(2654)}}})()},[_.initialFee,_.priceOfEstate,p]),e.jsxs(w,{children:[e.jsxs(c,{children:[e.jsx(ue,{disableCurrency:!0,unitsMax:u("calculate_mortgage_period_units_max"),unitsMin:u("calculate_mortgage_period_units_min"),value:_.period,name:"Period",min:p.min,max:p.max,error:v.period,title:u("calculate_mortgage_period"),handleChange:Y}),v.period&&e.jsx(N,{error:v.period})]}),e.jsxs(c,{children:[e.jsx(ue,{unitsMax:"₪",unitsMin:"₪",name:"MonthlyPayment",min:r,max:t,error:v.monthlyPayment,title:u("calculate_mortgage_initial_payment"),handleChange:D,value:_.monthlyPayment}),e.jsx(tt,{}),v.monthlyPayment&&e.jsx(N,{error:v.monthlyPayment})]}),e.jsx(c,{})]})}const Ct=()=>{const{t,i18n:o}=k(),{getContent:r}=G("mortgage_step1"),a=U(),{data:p,loading:d,error:u,getDropdownProps:h}=ot("mortgage_step1"),[E,_]=F.useState([]),[v,b]=F.useState({}),[C,Y]=F.useState(!0);F.useEffect(()=>{const s=async()=>{try{const M=await(await fetch(`/api/get-cities?lang=${o.language}`)).json();if(M.status==="success"){const W=M.data.map(V=>({value:V.value,label:V.name}));_(W)}else console.error("Failed to fetch cities:",M.message)}catch(i){console.error("Error fetching cities:",i)}},q=async()=>{var i,M,W,V,_e,ge,fe;try{Y(!0);const de=window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"/api":"https://bankimonline.com/api",L=await(await fetch(`${de}/v1/calculation-parameters?business_path=mortgage`)).json();if(L.status==="success"&&L.data.property_ownership_ltvs){const R={};Object.keys(L.data.property_ownership_ltvs).forEach(Q=>{R[Q]=L.data.property_ownership_ltvs[Q].ltv/100}),b(R),console.info("✅ LTV ratios loaded from database:",R)}else if(L.status==="error"&&((i=L.data)!=null&&i.property_ownership_ltvs)){const R={};Object.keys(L.data.property_ownership_ltvs).forEach(Q=>{R[Q]=L.data.property_ownership_ltvs[Q].ltv/100}),b(R),console.info("📋 Using fallback LTV ratios (database connection issue):",R)}else throw new N("No LTV data in response")}catch(de){console.warn("⚠️ Error fetching LTV ratios from calculation parameters API:",de.message),console.info("📋 Using calculationService fallback values");try{const J=await $.getAllParameters("mortgage");b({no_property:((W=(M=J.property_ownership_ltvs)==null?void 0:M.no_property)==null?void 0:W.ltv)/100||.75,has_property:((_e=(V=J.property_ownership_ltvs)==null?void 0:V.has_property)==null?void 0:_e.ltv)/100||.5,selling_property:((fe=(ge=J.property_ownership_ltvs)==null?void 0:ge.selling_property)==null?void 0:fe.ltv)/100||.7})}catch{console.warn("🚨 CRITICAL: Even calculationService failed, using hardcoded emergency values"),b({no_property:.75,has_property:.5,selling_property:.7})}}finally{Y(!1)}};s(),q()},[o.language]);const D=h("when_needed"),P=h("type"),g=h("first_home"),I=h("property_ownership"),{setFieldValue:y,values:l,errors:f,touched:O,setFieldTouched:x}=te(),S=(s,q)=>{if(!s||s===0)return 1;const i=v[q]||v.no_property||.75;return s*i},A=(s,q)=>{if(!s||s===0)return 0;const i=S(s,q);return s-i};return F.useEffect(()=>{if(l.propertyOwnership&&l.priceOfEstate){const s=A(l.priceOfEstate,l.propertyOwnership),q=l.priceOfEstate;l.initialFee<s?(console.log("Setting initial fee to minimum:",s),y("initialFee",s)):l.initialFee>q&&(console.log("Setting initial fee to maximum:",q),y("initialFee",q))}},[l.propertyOwnership,l.priceOfEstate,l.initialFee,y]),e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(le,{title:r("mortgage_step1.header.title","calculate_mortgage_title")}),e.jsxs(w,{children:[e.jsxs(c,{children:[e.jsx(rt,{handleChange:s=>{a(ie("period")),y("priceOfEstate",s)},name:"PriceOfEstate",title:r("mortgage_step1.field.property_price","calculate_mortgage_price"),value:l.priceOfEstate,placeholder:"1,000,000",error:f.priceOfEstate,"data-testid":"property-price-input"}),f.priceOfEstate&&e.jsx(N,{error:f.priceOfEstate})]}),e.jsx(c,{children:e.jsx(X,{title:r("mortgage_step1.field.city","calculate_mortgage_city"),data:E,placeholder:r("mortgage_step1.field.city_ph","Select city"),value:l.cityWhereYouBuy,onChange:s=>y("cityWhereYouBuy",s),onBlur:()=>x("cityWhereYouBuy",!0),searchable:!0,searchPlaceholder:r("mortgage_step1.field.search_ph","Search..."),nothingFoundText:r("mortgage_step1.field.nothing_found","Nothing found"),error:O.cityWhereYouBuy&&f.cityWhereYouBuy,dataTestId:"city-dropdown"})}),e.jsxs(c,{children:[e.jsx(X,{title:D.label||r("mortgage_step1.field.when_needed","calculate_mortgage_when"),data:D.options,placeholder:D.placeholder||r("mortgage_step1.field.when_needed_ph","calculate_mortgage_when_options_ph"),value:l.whenDoYouNeedMoney,onChange:s=>y("whenDoYouNeedMoney",s),onBlur:()=>x("whenDoYouNeedMoney",!0),error:O.whenDoYouNeedMoney&&f.whenDoYouNeedMoney,dataTestId:"when-needed-dropdown",disabled:d}),u&&e.jsx(N,{error:r("error_dropdown_load_failed","Failed to load options. Please refresh the page.")})]})]}),e.jsxs(w,{children:[e.jsxs(c,{children:[e.jsx(ue,{name:"InitialFee",value:l.initialFee,min:A(l.priceOfEstate,l.propertyOwnership),max:l.priceOfEstate||1,title:r("mortgage_step1.field.initial_fee","calculate_mortgage_initial_fee"),handleChange:s=>{a(ie("period")),y("initialFee",s)},tooltip:r("mortgage_step1.field.initial_payment_tooltip","Minimum down payment depends on property ownership status"),error:f.initialFee,disableRangeValues:!0,"data-testid":"initial-fee-input"}),e.jsx(qt,{}),f.initialFee&&e.jsx(N,{error:f.initialFee})]}),e.jsxs(c,{children:[e.jsx(X,{title:P.label||r("mortgage_step1.field.type","calculate_mortgage_type"),data:P.options,placeholder:P.placeholder||r("mortgage_step1.field.type_ph","calculate_mortgage_type_ph"),value:l.typeSelect,onChange:s=>y("typeSelect",s),onBlur:()=>x("typeSelect",!0),error:O.typeSelect&&f.typeSelect,dataTestId:"property-type-dropdown",disabled:d}),u&&e.jsx(N,{error:r("error_dropdown_load_failed","Failed to load type options. Please refresh the page.")})]}),e.jsxs(c,{children:[e.jsx(X,{title:g.label||r("mortgage_step1.field.first_home","calculate_mortgage_first"),data:g.options,placeholder:g.placeholder||r("mortgage_step1.field.first_home_ph","calculate_mortgage_first_ph"),value:l.willBeYourFirst,onChange:s=>y("willBeYourFirst",s),onBlur:()=>x("willBeYourFirst",!0),error:O.willBeYourFirst&&f.willBeYourFirst,dataTestId:"first-home-dropdown",disabled:d}),u&&e.jsx(N,{error:r("error_dropdown_load_failed","Failed to load first home options. Please refresh the page.")})]})]}),e.jsxs(w,{children:[e.jsxs(c,{children:[e.jsx(X,{title:I.label||r("mortgage_step1.field.property_ownership","calculate_mortgage_property_ownership"),data:I.options,placeholder:I.placeholder||r("mortgage_step1.field.property_ownership_ph","calculate_mortgage_property_ownership_ph"),value:l.propertyOwnership,onChange:s=>y("propertyOwnership",s),onBlur:()=>x("propertyOwnership",!0),error:O.propertyOwnership&&f.propertyOwnership,dataTestId:"property-ownership-dropdown",disabled:d}),u&&e.jsx(N,{error:r("error_dropdown_load_failed","Failed to load property ownership options. Please refresh the page.")})]}),e.jsx(c,{}),e.jsx(c,{})]}),e.jsx(z,{}),e.jsx(Mt,{})]})})},Et=()=>ee().shape({priceOfEstate:B().max(1e7,n("error_max_price",'ערך הנכס המקסימלי הוא 10,000,000 ש"ח')).required(n("error_property_value_required","ערך הנכס נדרש")),cityWhereYouBuy:m().required(n("error_city_required","עיר נדרשת")),whenDoYouNeedMoney:m().required(n("error_when_need_mortgage","יש לבחור מתי תזדקק למשכנתא")),initialFee:B().test("initial-payment-percentage",n("error_initial_fee","תשלום ראשוני לא יכול לעלות על 75% מערך הנכס"),function(t){const o=this.parent.priceOfEstate||0;return Nt(o,t)}).required(n("error_initial_payment_required","תשלום ראשוני נדרש")),typeSelect:m().required(n("error_mortgage_type_required","סוג משכנתה נדרש")),willBeYourFirst:m().required(n("error_first_home_required","אנא ציין אם זה הבית הראשון שלך")),propertyOwnership:m().required(n("error_property_ownership_required","סטטוס בעלות על נכס נדרש")),period:B().min(4,n("error_min_period","תקופה מינימלית היא 4 שנים")).max(30,n("error_max_period","תקופה מקסימלית היא 30 שנה")).required(n("error_period_required","תקופת המשכנתה נדרשת")),monthlyPayment:B().min(2654,n("error_min_monthly_payment",'תשלום חודשי מינימלי הוא 2,664 ש"ח')).required(n("error_monthly_payment_required","תשלום חודשי נדרש"))});function Nt(t,o){const r=t*.25;return typeof o>"u"?!1:o>=r}const Bt=()=>{k();const{getContent:t}=G("mortgage_step1"),o=U(),r=K(),a=j(u=>u.mortgage),p=j(u=>u.login.isLogin),d={priceOfEstate:a.priceOfEstate||1e6,cityWhereYouBuy:a.cityWhereYouBuy||"",whenDoYouNeedMoney:a.whenDoYouNeedMoney||"",initialFee:a.initialFee||5e5,typeSelect:a.typeSelect||"",willBeYourFirst:a.willBeYourFirst||"",propertyOwnership:a.propertyOwnership||"",period:a.period||4,monthlyPayment:a.monthlyPayment||11514};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{initialValues:d,validationSchema:Et(),validateOnMount:!0,onSubmit:u=>{o(T(u)),p?r("/services/calculate-mortgage/2"):(o(Ce()),o(Ee("phoneVerification")))},children:e.jsxs(se,{children:[e.jsxs(ne,{children:[e.jsx(ze,{title:t("video_calculate_mortgage_title","video_calculate_mortgage_title"),text:t("show_offers","show_offers"),size:"small"}),e.jsx(Ct,{})]}),e.jsx(Ue,{})]})}),e.jsx(We,{}),e.jsx(ve,{})]})},Dt=()=>{k();const{getContent:t}=G("mortgage_step4"),o=j(a=>a.login.loginData),r=j(a=>a.mortgage);return e.jsxs(ce,{children:[e.jsx(le,{title:t("calculate_mortgage_final","calculate_mortgage_final")}),e.jsx(He,{cost:r.priceOfEstate,initialPayment:r.initialFee,period:r.period,nameSurname:o==null?void 0:o.nameSurname,phoneNumber:o==null?void 0:o.phoneNumber}),e.jsx(Ke,{text:t("calculate_mortgage_warning","calculate_mortgage_warning")}),e.jsx(w,{children:e.jsx(Ge,{})}),e.jsx(Je,{})]})},At={selectedBank:"",selectedOffer:null},Lt=ee().shape({selectedBank:m(),selectedOffer:ee().nullable()}),Tt=()=>{const t=U(),o=K();return j(r=>r.login.loginData),j(r=>r.login.isLogin),e.jsx(ae,{initialValues:At,validationSchema:Lt,validateOnMount:!0,onSubmit:r=>{t(T(r)),console.log("FourthStep validation:"),o("/services/application-submitted")},children:e.jsxs(se,{children:[e.jsx(ne,{children:e.jsx(Dt,{})}),e.jsx(he,{})]})})},kt=()=>{k();const{getContent:t}=G("mortgage_step2"),{values:o}=te(),r=j(a=>a.login.loginData);return e.jsx(e.Fragment,{children:e.jsxs(ce,{children:[e.jsx(le,{title:t("mortgage_step2_title","Personal Details")}),e.jsxs(it,{children:[e.jsx(jt,{}),e.jsx(H,{name:r==null?void 0:r.nameSurname,phone:r==null?void 0:r.phoneNumber})]}),e.jsxs(w,{children:[e.jsx(lt,{}),e.jsx(ct,{}),e.jsx(dt,{})]}),e.jsxs(w,{children:[e.jsxs(c,{style:{gap:"2rem"},children:[e.jsx(mt,{}),o.additionalCitizenships==="yes"&&e.jsx(ft,{})]}),e.jsxs(c,{style:{gap:"2rem"},children:[e.jsx(pt,{}),o.taxes==="yes"&&e.jsx(yt,{})]}),e.jsxs(c,{style:{gap:"2rem"},children:[e.jsx(ut,{}),o.childrens==="yes"&&e.jsx(xt,{})]})]}),e.jsx(z,{}),e.jsxs(w,{children:[e.jsx(ht,{}),e.jsx(_t,{}),e.jsx(gt,{})]}),e.jsx(z,{}),e.jsxs(w,{children:[e.jsx(nt,{}),e.jsx(c,{}),e.jsx(c,{})]}),e.jsx(z,{}),e.jsxs(w,{children:[e.jsx(wt,{}),e.jsx(c,{children:o.familyStatus==="option_2"&&e.jsx(at,{})}),e.jsx(c,{children:o.partnerPayMortgage==="yes"&&o.familyStatus==="option_2"&&e.jsx(st,{})})]})]})})},Se=()=>ee().shape({nameSurname:m().required(n("error_name_surname","Please enter your name and surname")),birthday:m().required(n("error_date","Please enter a valid date")),education:m().required(n("error_education_required","Education is required")),additionalCitizenships:m().required(n("error_citizenship_required","Citizenship information is required")),citizenshipsDropdown:be().when("additionalCitizenships",{is:"yes",then:t=>t.min(1,n("error_citizenship_countries_required","Please select at least one citizenship country")),otherwise:t=>t.min(0)}),taxes:m().required(n("error_taxes_required","Tax payment information is required")),countriesPayTaxes:be().when("taxes",{is:"yes",then:t=>t.min(1,n("error_tax_countries_required","Please select at least one tax country")),otherwise:t=>t.min(0)}),childrens:m().required(n("error_children_required","Children information is required")),howMuchChildrens:B().required(n("error_children_count_required","Number of children is required")),medicalInsurance:m().required(n("error_medical_insurance_required","Medical insurance information is required")),isForeigner:m().required(n("error_foreigner_required","Foreigner status is required")),publicPerson:m().required(n("error_public_person_required","Public person status is required")),borrowers:B().min(1,n("error_quantity_borrowers","At least one borrower is required")).required(n("error_quantity_borrowers","Number of borrowers is required")),familyStatus:m().required(n("error_family_status_required","Family status is required")),partnerPayMortgage:m().when("familyStatus",{is:"Married",then:t=>t.required(n("error_partner_mortgage_required","Partner mortgage information is required")),otherwise:t=>t.notRequired()})});Se();const Yt=()=>{const t=U(),o=K(),r=j(d=>d.mortgage),p={nameSurname:j(d=>d.login.loginData).nameSurname||r.nameSurname||"",birthday:r.birthday||new Date(new Date().setFullYear(new Date().getFullYear()-18)).getTime(),education:r.education||"",additionalCitizenships:r.additionalCitizenships||null,citizenshipsDropdown:r.citizenshipsDropdown||[],taxes:r.taxes||null,countriesPayTaxes:r.countriesPayTaxes||[],childrens:r.childrens||null,howMuchChildrens:r.howMuchChildrens||1,medicalInsurance:r.medicalInsurance||null,isForeigner:r.isForeigner||null,publicPerson:r.publicPerson||null,borrowers:r.borrowers||null,familyStatus:r.familyStatus||"",partnerPayMortgage:r.partnerPayMortgage||null,addPartner:r.addPartner||""};return e.jsx(ae,{initialValues:p,validationSchema:Se(),validateOnMount:!0,onSubmit:d=>{t(T(d)),o("/services/calculate-mortgage/3")},children:e.jsxs(se,{children:[e.jsx(ne,{children:e.jsx(kt,{})}),e.jsx(he,{})]})})},Oe=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="1"||o.includes("no_additional")||o.includes("no additional")||o.includes("none")},Vt=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o.includes("no_obligation")||o.includes("no obligation")||o.includes("none")},Rt=()=>{k();const{getContent:t}=G("mortgage_step3"),o=K(),{values:r}=te(),a=Ft("mortgage_step3"),{mainSourceOfIncome:p,additionalIncome:d,obligation:u}=r,h=U(),E=j(i=>i.borrowers.sourceOfIncomeModal),_=j(i=>i.borrowers.additionalIncomeModal),v=j(i=>i.borrowers.obligationModal),b=j(i=>i.otherBorrowers.otherBorrowers),C=j(i=>i.login.loginData),Y=p||"",D=u==="no_obligations"?"":u||"",P=()=>{h(T(r)),h(Ne())},g=()=>{h(T(r)),h(Be())},I=()=>{h(T(r)),h(De())},y=i=>{h(Ae({id:i}))},l=i=>{h(Le({id:i}))},f=i=>{h(Te({id:i}))},O=i=>{h(ke(i))},x=i=>{h(Ye(i))},S=i=>{h(Ve(i))},A=i=>{h(je(i));const W=!b.some(V=>V.id===i)?me(b):i;o({pathname:"/services/other-borrowers/1/",search:xe({pageId:String(W)}).toString()})},s=()=>{h(je(me(b))),h(T(r)),o({pathname:"/services/other-borrowers/1/",search:xe({pageId:me(b).toString()}).toString()})},q=i=>{h(Re(i))};return e.jsxs(ce,{children:[e.jsx(le,{title:t("mortgage_step3_title","Income & Employment Information")}),e.jsx(H,{name:C==null?void 0:C.nameSurname,phone:C==null?void 0:C.phoneNumber}),e.jsxs(w,{children:[e.jsx(bt,{}),a[Y]&&a[Y].map((i,M)=>e.jsx(ye.Fragment,{children:i},M))]}),e.jsx(w,{children:e.jsx(c,{children:p&&e.jsxs(e.Fragment,{children:[E.map(i=>e.jsx(H,{onEdit:()=>O(i.id),onDelete:()=>y(i.id),enableEdit:!0,name:`${t("source_of_income","source_of_income")}${i.id+1}`},i.id)),e.jsx(re,{onClick:P,color:"#FBE54D",value:t("add_place_to_work","add_place_to_work"),variant:"none"})]})})}),e.jsx(z,{}),e.jsxs(w,{children:[e.jsx(Pt,{}),d&&!Oe(d)&&e.jsx(Ot,{}),e.jsx(c,{})]}),d&&!Oe(d)&&e.jsx(w,{children:e.jsxs(c,{children:[_.map(i=>e.jsx(H,{onEdit:()=>x(i.id),onDelete:()=>l(i.id),enableEdit:!0,name:`${t("additional_source_of_income","additional_source_of_income")}${i.id+1}`},i.id)),e.jsx(re,{onClick:g,color:"#FBE54D",value:t("add_additional_source_of_income","add_additional_source_of_income"),variant:"none"})]})}),e.jsx(z,{}),e.jsxs(w,{children:[e.jsx(St,{}),Pe[D]&&Pe[D].map((i,M)=>e.jsx(ye.Fragment,{children:i},M)),e.jsx(c,{})]}),u&&!Vt(u)&&e.jsx(w,{children:e.jsxs(c,{children:[v.map(i=>e.jsx(H,{onEdit:()=>S(i.id),onDelete:()=>f(i.id),enableEdit:!0,name:`${t("obligation","obligation")}${i.id+1}`},i.id)),e.jsx(re,{onClick:I,color:"#FBE54D",value:t("add_obligation","add_obligation"),variant:"none"})]})}),e.jsx(z,{}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[b&&e.jsx(we,{title:t("borrower","borrower")}),e.jsxs(w,{style:{columnGap:"2rem"},children:[b.map(i=>e.jsx(c,{children:e.jsx(H,{onEdit:()=>A(i.id),onDelete:()=>q(i.id),enableEdit:!0,name:i.nameSurname},i.id)},i.id)),!b&&e.jsx(we,{title:t("borrower","borrower")}),e.jsx(c,{children:e.jsx(re,{value:t("add_borrower","add_borrower"),onClick:s,style:{height:"3.5rem",borderRadius:"0.25rem",padding:"0",width:"13.125rem"}})}),e.jsx(c,{})]})]})]})},Z=t=>{if(!t)return!1;const o=t.toLowerCase();return o.includes("unemployed")||o.includes("no_income")||o.includes("no income")||o.includes("option_5")||o.includes("option_6")||o==="app.mortgage.step3.main_source_income_option_5"||o==="app.mortgage.step3.main_source_income_option_6"||o==="other"||o==="unpaid_leave"},$t=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="1"||o.includes("no_additional")||o.includes("no additional")||o.includes("none")},pe=t=>{if(!t)return!1;const o=t.toLowerCase();return o==="option_1"||o==="no_obligations"||o.includes("no_obligation")||o.includes("no obligation")||o.includes("none")},zt=ee().shape({mainSourceOfIncome:m().required(n("error_select_answer","Please select an answer")).test("not-empty",n("error_select_answer","Please select an answer"),t=>t!=null&&t!==""),monthlyIncome:B().when("mainSourceOfIncome",{is:t=>!Z(t),then:t=>t.required(n("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),startDate:m().when("mainSourceOfIncome",{is:t=>!Z(t),then:t=>t.required(n("error_date","Please enter a valid date")),otherwise:t=>t.notRequired()}),fieldOfActivity:m().when("mainSourceOfIncome",{is:t=>t!=null&&t!==""&&!Z(t),then:t=>t.required(n("error_select_field_of_activity","Please select field of activity")),otherwise:t=>t.notRequired()}),profession:m().when("mainSourceOfIncome",{is:t=>!Z(t),then:t=>t.required(n("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),companyName:m().when("mainSourceOfIncome",{is:t=>!Z(t),then:t=>t.required(n("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),additionalIncome:m().required(n("error_select_one_of_the_options","Please select one of the options")).test("not-empty",n("error_select_one_of_the_options","Please select one of the options"),t=>t!=null&&t!==""),additionalIncomeAmount:B().when("additionalIncome",{is:t=>t!=null&&t!==""&&!$t(t),then:t=>t.required(n("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),obligation:m().required(n("error_select_one_of_the_options","Please select one of the options")),bank:m().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(n("error_select_bank","Please select a bank")),otherwise:t=>t.notRequired()}),monthlyPaymentForAnotherBank:B().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(n("error_fill_field","Please fill this field")),otherwise:t=>t.notRequired()}),endDate:m().when("obligation",{is:t=>t!=null&&t!==""&&!pe(t),then:t=>t.required(n("error_date","Please enter a valid date")),otherwise:t=>t.notRequired()})}),Ut=()=>{const t=U(),o=K(),r=j(p=>p.mortgage),a={mainSourceOfIncome:r.mainSourceOfIncome||"",monthlyIncome:r.monthlyIncome||null,startDate:r.startDate||new Date().getTime(),fieldOfActivity:r.fieldOfActivity||"",profession:r.profession||"",companyName:r.companyName||"",additionalIncome:r.additionalIncome||"",additionalIncomeAmount:r.additionalIncomeAmount||null,obligation:r.obligation||"option_1",bank:r.bank||"",monthlyPaymentForAnotherBank:r.monthlyPaymentForAnotherBank||null,endDate:r.endDate||new Date().getTime(),amountIncomeCurrentYear:r.amountIncomeCurrentYear||null,noIncome:r.noIncome||new Date().getTime()};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{initialValues:a,validationSchema:zt,validateOnMount:!0,onSubmit:p=>{t(T(p)),o("/services/calculate-mortgage/4")},children:e.jsxs(se,{children:[e.jsx(ne,{children:e.jsx(Rt,{})}),e.jsx(he,{})]})}),e.jsx(Qe,{}),e.jsx(Xe,{}),e.jsx(Ze,{})]})},Wt=()=>{const{stepNumber:t}=Fe();k();const{getContent:o}=G("mortgage_calculation"),r=K(),a=j(u=>u.login.isLogin);F.useEffect(()=>{!a&&t!=="1"&&r("/services/calculate-mortgage/1")},[a,t,r]);const p=[o("mobile_step_1","mobile_step_1"),o("mobile_step_2","mobile_step_2"),o("mobile_step_3","mobile_step_3"),o("mobile_step_4","mobile_step_4")];let d;switch(t){case"1":d=e.jsx(Bt,{});break;case"2":d=e.jsx(Yt,{});break;case"3":d=e.jsx(Ut,{});break;case"4":d=e.jsx(Tt,{});break;default:d=e.jsx($e,{type:"NOT_FOUND"});break}return e.jsxs(e.Fragment,{children:[t!=="4"&&e.jsx(qe,{progress:t,data:p}),e.jsx(F.Suspense,{fallback:e.jsx(Ie,{}),children:d})]})},vr=Wt;export{vr as CalculateMortgage};
