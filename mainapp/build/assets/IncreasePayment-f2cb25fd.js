var m=Object.defineProperty;var h=(c,t,e)=>t in c?m(c,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):c[t]=e;var l=(c,t,e)=>(h(c,typeof t!="symbol"?t+"":t,e),e);import{j as d}from"./index-3a14e4c4.js";import{M as p}from"./AddButton-100b82a8.js";import{u as f}from"./i18n-vendor-aaeace9f.js";const _=(c,t,e,a)=>{if(c===null||t===null)return 1;if(e<=0||c<=0||a<=0||t>=c)return 0;const r=c-t,n=a/12/100,s=Math.pow(1+n,e*12),o=r*n*s/(s-1);return Math.trunc(o)},g=(c,t,e)=>{const a=t*12,r=e/12/100,n=r*(1+r)**a/((1+r)**a-1);return Math.ceil(c*n)},y=(c,t,e)=>{if(c===null||c<=0||t<=0||e<=0)return 0;const a=c*(1+e*t/100);return Math.trunc(a)},w=(c,t,e,a)=>{if(c===null||t===null)return 1;const r=c-t,n=a/12/100;if(r<=0||n<=0||e<=0)return 0;const o=Math.log(e/(e-r*n))/Math.log(1+n)/12;return Math.trunc(o)};class v{constructor(){l(this,"cache",new Map);l(this,"CACHE_DURATION",5*60*1e3)}getApiBaseUrl(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://localhost:8003/api":"https://bankimonline.com/api"}async fetchCalculationParameters(t="mortgage"){const e=t,a=this.cache.get(e);if(a&&Date.now()<a.expiry)return a.data;try{const n=await(await fetch(`${this.getApiBaseUrl()}/v1/calculation-parameters?business_path=${t}`)).json();if(n.status==="success"||n.status==="error"&&n.data)return this.cache.set(e,{data:n.data,expiry:Date.now()+this.CACHE_DURATION}),n.data.is_fallback?console.info(`ðŸ“‹ Using fallback calculation parameters for ${t} (database connection issue)`):console.info(`âœ… Using database calculation parameters for ${t}`),n.data;throw new Error(n.message||"Failed to fetch calculation parameters")}catch(r){return console.warn(`âš ï¸ Failed to fetch calculation parameters for ${t}:`,r.message),console.warn("ðŸš¨ CRITICAL: Using emergency hardcoded fallback parameters - API completely unreachable"),{business_path:t,current_interest_rate:t.includes("credit")?8.5:5,property_ownership_ltvs:{no_property:{ltv:75,min_down_payment:25},has_property:{ltv:50,min_down_payment:50},selling_property:{ltv:70,min_down_payment:30}},standards:{},last_updated:new Date().toISOString(),is_fallback:!0}}}async getCurrentRate(t="mortgage"){return(await this.fetchCalculationParameters(t)).current_interest_rate}async getPropertyOwnershipLtv(t,e="mortgage"){const r=(await this.fetchCalculationParameters(e)).property_ownership_ltvs[t];return r?r.ltv:(console.warn(`âš ï¸ Property ownership LTV for ${t} not found, using default 50%`),50)}async getStandardValue(t,e,a="mortgage"){var s,o,i;const n=(i=(o=(s=(await this.fetchCalculationParameters(a)).standards)==null?void 0:s[t])==null?void 0:o[e])==null?void 0:i.value;if(n===void 0){console.warn(`âš ï¸ Standard ${t}.${e} not found for ${a}`);const u=this.getEmergencyFallback(t,e);return u!==null?u:0}return n}async calculateMortgagePayment(t,e,a,r){const n=r||await this.getCurrentRate("mortgage");return _(t,e,a,n)}async calculateCreditPayment(t,e,a){const r=a||await this.getCurrentRate("credit");return g(t,e,r)}async calculateRemainingMortgage(t,e,a){const r=a||await this.getCurrentRate("mortgage");return y(t,e,r)}async calculateLoanPeriod(t,e,a,r){const n=r||await this.getCurrentRate("mortgage");return w(t,e,a,n)}getEmergencyFallback(t,e){var r;return((r={ltv:{max_ltv:80,standard_ltv_max:80},dti:{max_dti:42,front_end_dti_max:28,back_end_dti_max:42},credit_score:{minimum_credit_score:620,min_credit_score:620},loan_terms:{min_years:4,max_years:30}}[t])==null?void 0:r[e])||null}clearCache(){this.cache.clear()}async getAllParameters(t="mortgage"){return this.fetchCalculationParameters(t)}}const b=new v,k=()=>{const{t:c,i18n:t}=f();return d.jsxDEV(p,{children:c("calculate_mortgage_ctx_1")},void 0,!1,{fileName:"/Users/michaelmishayev/Projects/bankDev2_standalone/mainapp/src/components/ui/ContextButtons/InvceasePayment/IncreasePayment.tsx",lineNumber:9,columnNumber:10},globalThis)};export{k as I,b as c};
