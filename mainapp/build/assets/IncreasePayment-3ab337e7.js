var m=Object.defineProperty;var p=(c,t,a)=>t in c?m(c,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[t]=a;var l=(c,t,a)=>(p(c,typeof t!="symbol"?t+"":t,a),a);import{j as d}from"./index-0f4c7356.js";import{M as h}from"./AddButton-f038a16f.js";import{u as f}from"./i18n-vendor-aaeace9f.js";const _=(c,t,a,e)=>{if(c===null||t===null)return 1;if(a<=0||c<=0||e<=0||t>=c)return 0;const r=c-t,n=e/12/100,s=Math.pow(1+n,a*12),o=r*n*s/(s-1);return Math.trunc(o)},g=(c,t,a)=>{const e=t*12,r=a/12/100,n=r*(1+r)**e/((1+r)**e-1);return Math.ceil(c*n)},y=(c,t,a)=>{if(c===null||c<=0||t<=0||a<=0)return 0;const e=c*(1+a*t/100);return Math.trunc(e)},w=(c,t,a,e)=>{if(c===null||t===null)return 1;const r=c-t,n=e/12/100;if(r<=0||n<=0||a<=0)return 0;const o=Math.log(a/(a-r*n))/Math.log(1+n)/12;return Math.trunc(o)};class v{constructor(){l(this,"cache",new Map);l(this,"CACHE_DURATION",5*60*1e3)}getApiBaseUrl(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"?"http://localhost:8003/api":"https://bankdev2standalone-production.up.railway.app/api"}async fetchCalculationParameters(t="mortgage"){const a=t,e=this.cache.get(a);if(e&&Date.now()<e.expiry)return e.data;try{const n=await(await fetch(`${this.getApiBaseUrl()}/v1/calculation-parameters?business_path=${t}`)).json();if(n.status==="success"||n.status==="error"&&n.data)return this.cache.set(a,{data:n.data,expiry:Date.now()+this.CACHE_DURATION}),n.data.is_fallback?console.info(`ðŸ“‹ Using fallback calculation parameters for ${t} (database connection issue)`):console.info(`âœ… Using database calculation parameters for ${t}`),n.data;throw new Error(n.message||"Failed to fetch calculation parameters")}catch(r){return console.warn(`âš ï¸ Failed to fetch calculation parameters for ${t}:`,r.message),console.warn("ðŸš¨ CRITICAL: Using emergency hardcoded fallback parameters - API completely unreachable"),{business_path:t,current_interest_rate:t.includes("credit")?8.5:5,property_ownership_ltvs:{no_property:{ltv:75,min_down_payment:25},has_property:{ltv:50,min_down_payment:50},selling_property:{ltv:70,min_down_payment:30}},standards:{},last_updated:new Date().toISOString(),is_fallback:!0}}}async getCurrentRate(t="mortgage"){return(await this.fetchCalculationParameters(t)).current_interest_rate}async getPropertyOwnershipLtv(t,a="mortgage"){const r=(await this.fetchCalculationParameters(a)).property_ownership_ltvs[t];return r?r.ltv:(console.warn(`âš ï¸ Property ownership LTV for ${t} not found, using default 50%`),50)}async getStandardValue(t,a,e="mortgage"){var s,o,i;const n=(i=(o=(s=(await this.fetchCalculationParameters(e)).standards)==null?void 0:s[t])==null?void 0:o[a])==null?void 0:i.value;if(n===void 0){console.warn(`âš ï¸ Standard ${t}.${a} not found for ${e}`);const u=this.getEmergencyFallback(t,a);return u!==null?u:0}return n}async calculateMortgagePayment(t,a,e,r){const n=r||await this.getCurrentRate("mortgage");return _(t,a,e,n)}async calculateCreditPayment(t,a,e){const r=e||await this.getCurrentRate("credit");return g(t,a,r)}async calculateRemainingMortgage(t,a,e){const r=e||await this.getCurrentRate("mortgage");return y(t,a,r)}async calculateLoanPeriod(t,a,e,r){const n=r||await this.getCurrentRate("mortgage");return w(t,a,e,n)}getEmergencyFallback(t,a){var r;return((r={ltv:{max_ltv:80,standard_ltv_max:80},dti:{max_dti:42,front_end_dti_max:28,back_end_dti_max:42},credit_score:{minimum_credit_score:620,min_credit_score:620},loan_terms:{min_years:4,max_years:30}}[t])==null?void 0:r[a])||null}clearCache(){this.cache.clear()}async getAllParameters(t="mortgage"){return this.fetchCalculationParameters(t)}}const b=new v,k=()=>{const{t:c,i18n:t}=f();return d.jsxDEV(h,{children:c("calculate_mortgage_ctx_1")},void 0,!1,{fileName:"/Users/michaelmishayev/Projects/bankDev2_standalone/mainapp/src/components/ui/ContextButtons/InvceasePayment/IncreasePayment.tsx",lineNumber:9,columnNumber:10},globalThis)};export{k as I,b as c};
